'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[8],{1516:function(D,I,c){c.r(I);c.d(I,"RtcUtils",function(){return k});D=c(0);var l=c(7),f=c(1546),a=c(34);class k{static s6e(x,y=f.RealtimeChannel.NNf){let m;try{m=a.c(x)}catch(r){throw x=String.format("Failed to JSON-serialize payload : {0}",r),l.ULS.sendTraceTag(18637072,500,10,x),Error.argument("payload",x);}if(m.length>y)throw x=String.format("Payload exceeds maximum length: {0} > {1}.",m.length,y),l.ULS.sendTraceTag(18637074,
500,10,x),Error.argument("payload",x);return m}static deserialize(x,y,m){if(!x)return null;if(Object.getType(x)!==String){var r=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",y,Object.getType(x).getName(),m);l.ULS.sendTraceTag(18637075,500,10,r);return null}r=null;try{r=a.a(x)}catch(z){x=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",y,z,m),l.ULS.sendTraceTag(18637077,
500,10,x)}return r}static Ufc(x){if(!x)return"";if("string"===typeof x)return x.toString();try{return a.c(x)}catch(y){return x.toString()}}static vyl(x){let y,m,r;y=0;r=m=null;if(!x)return{Yni:y,$ni:m,exception:r};try{const z=x.source;z&&Object.getType(z)===String&&(r=z);const v=x.context;v&&(x=v,y=x.status?x.status:0,m=x.statusText?x.statusText:null)}catch(z){}return{Yni:y,$ni:m,exception:r}}}Object(D.a)(k,"RtcUtils",null,[])},1536:function(D,I,c){c.r(I);D=c(0);var l=c(7),f=c(54),a=c(85),k;(function(r){r[r.SendNotification=
0]="SendNotification";r[r.SendPersistentState=1]="SendPersistentState";r[r.FindSession=2]="FindSession";r[r.Last=3]="Last"})(k||(k={}));Object(D.b)("ApiType",k);var x;(function(r){r[r.AttemptCount=0]="AttemptCount";r[r.SuccessCount=1]="SuccessCount";r[r.DropCount=2]="DropCount";r[r.FailedCount=3]="FailedCount";r[r.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";r[r.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";r[r.ThrottledCount=6]="ThrottledCount";r[r.Last=7]="Last"})(x||(x=
{}));Object(D.b)("EventCountType",x);var y=c(1638);c.d(I,"FrequentLoggingMetrics",function(){return m});class m{constructor(r){this.HGh=this.VZh=null;this.nMi=this.Q1h=0;this.au=null;this.K4g=this.cJe=0;this.Wf=r;this.kzm();this.Uze=this.mUg=this.MJe=!1;this.iyc=0}get Oxl(){return this.Uze}bAo(r){this.K4g=r;window.setInterval(Object(f.a)(this,this.bMf,"logMetricsBatchAndReset"),r);this.cJe=(new Date).getTime()}qP(r,z){this.Moo(r)&&!this.mUg||this.Oxl||!window.navigator.onLine||this.Wf.WQa||(this.au[r][z]++,
this.MJe=!0)}kzm(){this.au=Array(3);for(let r=0;3>r;r++){this.au[r]=Array(7);for(let z=0;7>z;z++)this.au[r][z]=0}}sMk(){const r={};for(let z=0;3>z;z++)for(let v=0;7>v;v++)this.SUm(z,v)&&(r[k[z]+x[v]]=this.au[z][v]);r.FSDomain=this.VZh;r.ConnectionDomain=this.HGh;r.FSRetryInterval=this.Q1h;r.MaxPayloadSize=this.nMi;r.LogNumber=this.iyc;1===this.iyc&&(r.FSLatencies=y.a.instance.aWl(),r.ConLatencies=y.a.instance.CQl());return r}SUm(r,z){return 2===r&&3!==z&&0!==z?!1:!0}Moo(r){return 2===r?!1:!0}bMf(){if(this.MJe){this.iyc++;
if((new Date).getTime()-this.cJe<5E3+this.K4g){var r=a.a.toJSON(this.sMk());l.ULS.sendTraceTag(50644352,500,15,r)}this.cJe=(new Date).getTime();for(r=0;3>r;r++)for(let z=0;7>z;z++)this.au[r][z]=0;this.MJe=!1}}s8m(){this.mUg=!0}static get instance(){return m._instance}static create(r){m.instance||(m._instance=new m(r));return m.instance}}m._instance=null;Object(D.a)(m,"FrequentLoggingMetrics",null,[881])},1546:function(D,I,c){c.r(I);D=c(0);var l=c(7),f=c(54),a=c(462),k=c(883),x=c(82),y=c(2);class m{constructor(za,
Ca){this.status=za;this.hec=Ca}}Object(D.a)(m,"UserStatusInfo",null,[]);var r=c(45),z=c(1638);class v{constructor(za,Ca){this.data=za;this.timeStamp=Ca}}Object(D.a)(v,"PresenceData",null,[]);class G{constructor(za){this.sCa=!1;this.qzb=0;this.Tve=!1;this.setTimeout=G.Ncf;this.clearTimeout=G.Gcf;this.O5m=Object(f.a)(this,this.T4m,"logRtcConnectingUsageStatement");this.$v=za}nkn(){this.sCa||(this.qzb=this.setTimeout(()=>{this.sCa=!1;this.IJi()},8E3),this.sCa=!0,this.Tve=!1)}hln(){this.L_()}jsn(){this.IJi()}IJi(){this.L_();
this.Tve||(this.Tve=!0,this.O5m())}T4m(){l.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",this.$v)}L_(){this.sCa&&this.clearTimeout(this.qzb);this.qzb=0;this.sCa=!1}static Ncf(za,Ca){return window.setTimeout(za,Ca)}static Gcf(za){window.clearTimeout(za)}}Object(D.a)(G,"ConnectedUsageKpiLogger",null,[903]);class F{constructor(){this.l6i=this.K4f;this.o6i=this.N4f;this.n6i=this.M4f;this.s6i=this.P4f;this.r6i=this.O4f;this.$4f=this.a5f;this.i5c=this.Y4f;this.eOb=
this.W4f;this.fOb=this.X4f;this.m6i=this.L4f;this.r5a=this.LRf;this.tLb=this.MRf}K4f(){}N4f(){}M4f(){}P4f(){}O4f(){}Y4f(){}X4f(){}W4f(){}a5f(){}L4f(){}LRf(){}MRf(){}}Object(D.a)(F,"NoopRealtimeChannelMetrics",null,[892,244]);class H{}H.ycd="presenceUpdated";H.updateNotification="updateNotification";H.q0i="persistentStateCleared";H.updatePersistentState="persistentStateUpdated";Object(D.a)(H,"RtcClientMethodNames",null,[]);class L{}L.Rtm="realtimeChannelHub";L.ycd="UpdatePresence";L.pN="SendUpdateNotification";
L.Qnf="GetCompletePersistentStateWithMetadata";L.updatePersistentState="UpdatePersistentState";L.krb="UpdateClientInfo";Object(D.a)(L,"RtcHubMethodNames",null,[]);class J{constructor(za){this.fw=za}WUn(za){this.fw.on(H.ycd,za)}QVn(za){this.fw.on(H.updateNotification,za)}VUn(za){this.fw.on(H.updatePersistentState,za)}UUn(za){this.fw.on(H.q0i,za)}kQo(za){this.fw.off(H.ycd,za)}uQo(za){this.fw.off(H.updateNotification,za)}jQo(za){this.fw.off(H.updatePersistentState,za)}iQo(za){this.fw.off(H.q0i,za)}ycd(za){return this.fw.invoke(L.ycd,
za)}krb(za){return this.fw.invoke(L.krb,za)}pN(za,Ca){return this.fw.invoke(L.pN,za,Ca)}Qnf(za){return this.fw.invoke(L.Qnf,za)}updatePersistentState(za,Ca){return this.fw.invoke(L.updatePersistentState,za,Ca)}}Object(D.a)(J,"RealtimeChannelProxy",null,[900,901,902]);class M{constructor(){this.pte=this.bLg=!1;this.nte=0;this.ive=this.JRe=this.IRe=this.pse=!1;this.uAe=0;this.Vch=!1;this.Uch=this.Tch=0;this.cQe=!1;this.jQe=this.hQe=this.lQe=this.dQe=0;this.iQe=!1}get zHk(){return this.pte}get yHk(){return this.nte}get Uzk(){return this.pse}get pqo(){return this.IRe}get qqo(){return this.JRe}get UXk(){return this.ive}get KNd(){return this.uAe}get x7n(){return this.Vch}get yej(){return this.Tch}get w7n(){return this.Uch}get s7n(){return this.cQe}get t7n(){return this.dQe}get Eej(){return this.lQe}get zej(){return this.hQe}get Bej(){return this.jQe}get Aej(){return this.iQe}static createInstance(za){const {RealtimeChannel:Ca}=
c(1546);return za?Object.assign(new M,{bLg:za.$("AwayStatusManagerIsEnabled"),pte:za.$("AwayStatusOneMinuteTimeoutIsEnabled"),nte:za.lc("AwayCoauthorThresholdMs",9E5),pse:za.$("RtcAllowCrossDomainAccessEnabled"),IRe:za.$("ShouldLogOnContentNotification"),JRe:za.$("ShouldLogOnHostSubscriptionNotification"),ive:za.$("RtcClientMetricsEnabled"),uAe:za.lc("RtcFindSessionRequestTimeoutInMS",6E4),Vch:za.$("RtcJsClientFrequentlyLogsMetrics"),Tch:za.lc("RtcJsClientFrequentMetricsLatencyThresholdInMS",1E3),
Uch:za.lc("RtcJsClientFrequentMetricsLogIntervalInMS",3E5),cQe:za.$("RtcClientMessageTelemetryEnabled"),dQe:za.lc("RtcClientMessageTelemetrySampleSize",5),lQe:za.lc("RtcSendTelemetryMessageIntervalInMS",3E5),hQe:za.lc("RtcLogClientMessageMetricsTimeOutInMs",2E4),jQe:za.lc("RtcMaxPayloadSizeInCharactersOverride",Ca.NNf),iQe:za.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RTCLogSignalrHeartBeatMessages",!1)}):Object.assign(new M,{bLg:!1,pte:!1,nte:9E5,pse:!1,IRe:!1,JRe:!0,ive:!1,uAe:9E4,cQe:!1,
dQe:5,lQe:3E5,hQe:2E4,jQe:Ca.NNf,iQe:!1})}}Object(D.a)(M,"RealtimeChannelSettings",null,[899]);var P=c(1769),N=c(69),K=c(149);class O{constructor(za){this.EDc=null;this.CTa=0;this.gEb=!1;this.vm=za;this.vm.xua(Object(f.a)(this,this.Mia,"onConnectionStateChanged"))}Mia(za,Ca){this.CTa=Ca.newState}Qsn(){l.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.vm.Mbe()}Fxm(za){this.EDc.init(za)}}Object(D.a)(O,"ARtcMessageHandler",null,[]);var V=c(353);class W{constructor(){this.Presence=
null;this.TimeStamp=0}}Object(D.a)(W,"PresenceDataEntryForClients",null,[]);var T=c(85);class Y{constructor(za,Ca=""){this.Kgk=za;this.ota=Ca}send(){return this.Kgk()}get messageId(){return this.ota}}Object(D.a)(Y,"MessageHandler",null,[907]);var ba=c(1665);class Z extends Sys.EventArgs{constructor(za,Ca,ua,ib){super();this.l8f=za;this.reconnectDelay=Ca;this.reason=ua;this.Cag=ib}}Object(D.a)(Z,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);var ea=c(1720);class ha{constructor(){this.bTe=this.fi=
null}get li(){return this.fi?this.bTe?this.bTe.getTime()-this.fi.getTime():(new Date).getTime()-this.fi.getTime():0}start(){this.fi=new Date}stop(){this.bTe=new Date}}Object(D.a)(ha,"SimpleStopwatch",null,[]);var la=c(1721),ia;(function(za){za[za.contentUpdate=0]="contentUpdate";za[za.editorsTableUpdate=1]="editorsTableUpdate";za[za.fileNameUpdate=2]="fileNameUpdate";za[za.wetContentUpdate=3]="wetContentUpdate";za[za.persistedContentUpdate=4]="persistedContentUpdate";za[za.clientRtcReconnectRequest=
5]="clientRtcReconnectRequest";za[za.replicationTelemetry=6]="replicationTelemetry";za[za.lockUpdate=7]="lockUpdate";za[za.collabServiceContentUpdate=8]="collabServiceContentUpdate";za[za.trackChangeSettingUpdate=9]="trackChangeSettingUpdate";za[za.saveTargetUpdate=10]="saveTargetUpdate";za[za.uploadToOcsUpdate=11]="uploadToOcsUpdate";za[za.labelUpdate=12]="labelUpdate";za[za.hostNotificationSubscriptionStatus=13]="hostNotificationSubscriptionStatus";za[za.subscribeOrExtend=14]="subscribeOrExtend";
za[za.elapsedBootTelemetry=15]="elapsedBootTelemetry";za[za.clientToClientTelemetryMessage=16]="clientToClientTelemetryMessage";za[za.clientToClientResponseMessage=17]="clientToClientResponseMessage";za[za.verifyNotificationPipeline=18]="verifyNotificationPipeline";za[za.hostNotificationHeartbeat=19]="hostNotificationHeartbeat";za[za.secondaryMetadataUpdate=20]="secondaryMetadataUpdate";za[za.last=21]="last"})(ia||(ia={}));Object(D.b)("UpdateNotificationType",ia);var sa=c(762),Oa=c(601),Ra=c(602);
class Na extends O{constructor(za,Ca,ua,ib,bb,mb,yb,ab,Ga,Za){super(yb);this.fw=null;this.y4g=this.A4g=!1;this.ota=0;this.gNe=new K.a;this.s8j=Na.dRl();this.oMe=y.AFrameworkApplication.K.kb("OwningFeatureCrewForRtcNotificationKpis");this.Sf=za;this.i7g=this.h7g=0;this.EDc=Ca;this.EDc.pBd(Object(f.a)(this,this.Qsn,"onTooManyUndeliveredMessages"));this._clientId=ua;this.nek=bb;this.vm.mxk(Object(f.a)(this,this.nqn,"onRefreshProxyRequired"));this.vm.kxk(Object(f.a)(this,this.lqn,"onRefreshAllPersistentStateRequest"));
this.vm.uxk(Object(f.a)(this,this.pN,"sendUpdateNotification"));this.vm.ivk(Object(f.a)(this,this.tnn,"onInternalPresenceUpdated"));this.vm.jvk(Object(f.a)(this,this.unn,"onInternalUpdateNotificationReceived"));this.vm.hvk(Object(f.a)(this,this.snn,"onInternalPersistentStateUpdated"));this.vm.gvk(Object(f.a)(this,this.rnn,"onInternalPersistentStateCleared"));this.vm.sxk(Object(f.a)(this,this.Yjc,"sendPersistentState"));this.vm.Ixk(Object(f.a)(this,this.krb,"updateClientInfo"));this.he=mb;this.$v=
ib;this.au=ab;this.lW=Ga;this.Fyc=Za;this.Hea=Object(N.a)(String,y.AFrameworkApplication.sessionStartInfoSettings.Application)||""}nqn(za,Ca){this.fw=this.nek(Ca.hubConnection);this.EDc.reset();this.fw.WUn(Object(f.a)(this,this.h5,"onPresenceUpdated"));this.fw.VUn(Object(f.a)(this,this.rSa,"onPersistentStateUpdated"));this.fw.UUn(Object(f.a)(this,this.qgc,"onPersistentStateCleared"));this.fw.QVn(Object(f.a)(this,this.b1,"onUpdateNotificationReceived"))}Mia(za,Ca){this.CTa=Ca.newState;2===Ca.newState&&
this.Kbo()}Kbo(){for(let za of this.gNe)this.pN(null,new ea.a(za.key,za.value,!1,new a.a));this.gNe=new K.a}lqn(za,Ca){Ca.Y6e();for(za=0;3>za;++za)this.lbo(za,Ca)}lbo(za,Ca){try{this.fw.Qnf(za).done(ua=>{Ca.Eoc(Ca.S8e,"GetCompletePresenceSuccess")&&(Ca.y2k.jsn(),l.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}] of type [{1}]",this.$v,za),this.vm.lMn(),this.vpn(za,ua),this.vm.BLn(ua),Ca.AXh.nb(za)&&this.vm.i5i(za,Ca.AXh.J(za),new a.a))}).fail(ua=>{const {RtcUtils:ib}=
c(1516);Ca.Eoc(Ca.S8e,"GetCompletePresenceFail")&&(l.ULS.sendTraceTag(3249541,500,15,"Failed to retrieve complete session state : {0} for [{1}] of type [{2}]",ib.Ufc(ua),this.$v,za),this.vm.Mbe())}).always(()=>{Ca.YA&&Ca.YA.stop()})}catch(ua){l.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",Ca.S8e,ua.message)}}Yjc(za,Ca){var {RtcUtils:ua}=c(1516);za=Ca.presence;
let ib;const bb=Ca.o8a;this.lW.qP(1,0);try{ib=ua.s6e(za,this.Fyc)}catch(yb){this.lW.qP(1,3);l.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",yb.message);bb.setException(yb);return}ua=new x.a;ua.Z(this._clientId,Object.assign(new W,{Presence:za,TimeStamp:(new Date).getTime()}));this.vm.p5i(Ca.type,ua);if(2!==this.CTa)this.au.eOb(),this.lW.qP(1,2),bb.Ag(null);else{var mb=this.ota.toString();++this.ota;za=new Y(()=>this.Mbo(Ca.type,ib,
mb),mb);za=this.Axj(0,Ca.type).add(za);za.$6d(yb=>{2===yb&&this.lW.qP(1,6);bb.Ag(null)});za.Z6d(()=>{})}}Mbo(za,Ca,ua){let ib=null;const bb=new ha,mb=new ba.a;l.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}] of type [{1}]",this.$v,za);if(2!==this.CTa)return this.au.eOb(),this.lW.qP(1,2),l.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}] of type [{1}]",this.$v,za),mb.yNf(),mb;this.he&&20>this.h7g&&(ib=this.he.Vf("WebServiceCall","Send Presence Message"),
this.h7g++);bb.start();mb.l_c(1);try{this.fw.updatePersistentState(za,Ca).done(()=>{this.au.i5c();this.lW.qP(1,1);l.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}] of type [{2}]",ua,this.$v,za);mb.jmb(1);bb&&(bb.stop(),bb.li>this.Sf.yej?this.lW.qP(1,4):this.lW.qP(1,5))}).fail(yb=>{const {RtcUtils:ab}=c(1516);this.gEb||(this.au.eOb(),this.lW.qP(1,3),l.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",
ua,ab.Ufc(yb),this.$v));mb.jmb(2)}).always(()=>{ib&&ib.stop()})}catch(yb){l.ULS.sendTraceTag(593072906,500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",yb.message),this.lW.qP(1,3),mb.jmb(2)}return mb}krb(za,Ca){({RtcUtils:za}=c(1516));const ua=Ca.TXk,ib=Ca.o8a;let bb;try{bb=za.s6e(ua,this.Fyc)}catch(mb){l.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",mb.message);ib.setException(mb);return}try{this.fw.krb(bb).done(()=>
{l.ULS.sendTraceTag(544319E3,500,50,"Successfully delivered clientInfo.")}).fail(mb=>{const {RtcUtils:yb}=c(1516);this.gEb||l.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",yb.Ufc(mb));ib.Ag(null)})}catch(mb){l.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",mb.message),ib.Ag(null)}}pN(za,Ca){({RtcUtils:za}=c(1516));const ua=Ca.type,ib=Ca.LL,bb=Ca.wjl,mb=Ca.o8a;let yb;this.lW.qP(0,0);try{yb=za.s6e(ib,this.Fyc)}catch(Ga){this.lW.qP(0,
3);l.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",Ga.message);mb.setException(Ga);return}if(2!==this.CTa)bb?this.gNe.Z(ua,ib):(this.au.eOb(),this.lW.qP(0,2)),mb.Ag(null);else{var ab=this.ota.toString();++this.ota;Ca=new Y(()=>this.Bco(ua,yb,ab),ab);Ca=this.Axj(1,ua).add(Ca);Ca.$6d(Ga=>{2===Ga&&this.lW.qP(0,6);mb.Ag(null)});Ca.Z6d(()=>{})}}Bco(za,Ca,ua){let ib=null;const bb=new ha,mb=new ba.a;l.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}] of type [{1}]",
this.$v,za);if(2!==this.CTa)return this.au.eOb(),this.lW.qP(0,2),l.ULS.sendTraceTag(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",this.$v),mb.yNf(),mb;this.he&&3===za&&20>this.i7g&&(ib=this.he.Vf("WebServiceCall","Send WetContent Update"),this.i7g++);bb.start();mb.l_c(1);this.fw.pN(za,Ca).done(()=>{this.au.i5c();this.lW.qP(0,1);l.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}] of type [{2}]",ua,this.$v,za);mb.jmb(1);
bb&&(bb.stop(),bb.li>this.Sf.yej?this.lW.qP(0,4):this.lW.qP(0,5))}).fail(yb=>{const {RtcUtils:ab}=c(1516);this.gEb||(this.au.eOb(),this.lW.qP(0,3),l.ULS.sendTraceTag(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",ua,ab.Ufc(yb),this.$v));mb.jmb(2)}).always(()=>{ib&&ib.stop()});return mb}f6(){this.fw.kQo(Object(f.a)(this,this.h5,"onPresenceUpdated"));this.fw.jQo(Object(f.a)(this,this.rSa,"onPersistentStateUpdated"));this.fw.iQo(Object(f.a)(this,this.qgc,
"onPersistentStateCleared"));this.fw.uQo(Object(f.a)(this,this.b1,"onUpdateNotificationReceived"))}tnn(za,Ca){this.h5(Ca.Ora,Ca.rKd)}h5(za){this.au.fOb();this.rSa(0,za)}snn(za,Ca){this.rSa(Ca.type,Ca.Ora)}vpn(za,Ca){const ua={};for(let ib in Ca)ua[ib]=Ca[ib].Presence;this.rVi(za,ua,Ca)}rSa(za,Ca){this.au.fOb();this.rVi(za,Ca)}rVi(za,Ca,ua=null){var {RtcUtils:ib}=c(1516);if(l.ULS.F$(500,100))for(var bb in Ca);delete Ca[this._clientId];if(!T.a.isEmpty(Ca)){for(var mb in Ca)bb=mb,Ca[bb]=ib.deserialize(Ca[mb],
"Presence",bb,!1,this.Fyc);ib=new x.a;mb=(new Date).getTime();for(let yb in Ca){bb=Ca[yb];let ab=yb,Ga;ua?(Ga=ua[ab],Ga.Presence=bb):Ga=Object.assign(new W,{Presence:bb,TimeStamp:mb});ib.Z(ab,Ga)}this.vm.p5i(za,ib);switch(za){case 0:this.A4g||(l.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this.$v),this.A4g=!0,y.AFrameworkApplication.Kg&&y.AFrameworkApplication.Kg.l8m());this.vm.b5i(Ca,[]);break;case 2:this.y4g||(l.ULS.sendTraceTag(508867081,500,50,"Raising first live meeting update notification for [{0}]",
this.$v),this.y4g=!0);this.vm.$4i(za,Ca);break;default:this.vm.$4i(za,Ca)}}}rnn(za,Ca){this.qgc(Ca.zFd)}qgc(za){this.au.fOb();if(l.ULS.F$(500,100))for(let Ca=0;Ca<za.length;++Ca);za.length&&(this.vm.BMn(za),this.vm.bMn(za),this.vm.b5i({},za))}unn(za,Ca){this.b1(Ca.type,Ca.LL)}b1(za,Ca=null){this.Sf.pqo&&0===za&&l.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");if(0===za&&this.oMe&&0<this.oMe.length){var ua=Object.assign(new sa.a,{topLevelKpiName:"ContentUpdateNotificationReceived",
featureName:"RtcNotification",crewAlias:this.oMe,vetoPillar:"RealTimeCoauth"});(ua=V.a.getInstance(ua))&&ua.logKpiUsage(this.s8j)}this.Sf.qqo&&13===za&&l.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",Ca||"<none>"));this.au.fOb();5===za?(Ca=(za=this.Iyn(Ca))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",za.reason,za.reconnectDelay):"Received client reconnection request from the server without params.",
l.ULS.sendTraceTag(18637071,500,50,Ca),this.vm.Mbe(za)):(Ca=c(1516).RtcUtils.deserialize(Ca,String.format("UpdateNotification-{0}",ia[za]),null,!1,this.Fyc),this.vm.AMn(za,Ca))}Iyn(za){try{if(!za||""===za)return null;const Ca=JSON.parse(za);return new Z(Ca[la.a.n$f],Ca[la.a.r7n],Ca[la.a.v7n],Ca[la.a.Cag])}catch(Ca){return l.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",Ca.message),null}}Axj(za,Ca){return this.EDc.Jfm(this.Kfm(za,Ca))}Kfm(za,Ca){return za+","+Ca}static dRl(){var za=
new Map;za.set("SkipAria","True");za=Object.assign(new Oa.a,{extendedProperties:za});return Object.assign(new Ra.a,{kpiName:"ContentUpdateNotificationReceived",kpiType:0,optionalProperties:za,blockFutureEmissionDurationInMs:3E5})}}Object(D.a)(Na,"RtcMessageHandler",O,[]);class Da{iLh(za,Ca=""){const {MaxOutstandingThrottler:ua}=c(1717);return ua.createInstance(za,Ca)}hal(za,Ca=""){const {MaxRateThrottler:ua}=c(1719);return ua.createInstance(za,Ca)}}Object(D.a)(Da,"ThrottlerFactory",null,[893]);var ra=
c(80),xa=c(1722);class fa{constructor(za){this.Sf=null;this.Xh=!1;this.sa=new ra.a;this.xJe=new x.a;this.vJe=new x.a;this.EUe=za;this.TWb=this.EUe.iLh(Ca=>Ca.send(),"GlobalMaxOustandingThrottler");this.TWb.pBd(()=>{this.sa.raiseEvent("TMUDM")})}init(za){this.Xh||(this.Sf=za,this.TWb.init(this.Sf.Nqb,this.Sf.akm),this.Xh=!0)}Jfm(za){var {MaxRateThrottler:Ca}=c(1719),{MaxOutstandingThrottler:ua}=c(1717);this.Xh||this.init(new xa.a(Ca.EOh,ua.gPh,ua.OOh,fa.T9m));({value:Ca}=this.xJe.Fc(za)).returnValue||
(({value:Ca}=this.vJe.Fc(za)).returnValue||(Ca="MaxOutstandingThrottler-"+za,Ca=this.EUe.iLh(Object(f.a)(this.TWb,this.TWb.add,"add"),Ca),Ca.init(this.Sf.Nqb,this.Sf.S9m),Ca.pBd(()=>{this.sa.raiseEvent("TMUDM")}),this.vJe.add(za,Ca)),ua="MaxRateThrottler-"+za,Ca=this.EUe.hal(Object(f.a)(Ca,Ca.add,"add"),ua),Ca.init(this.Sf.Tan),this.xJe.add(za,Ca));return Ca}reset(){for(let za of this.xJe)za.value.Z4f();for(let za of this.vJe)za.value.Z4f(),za.value.reset();this.TWb.Z4f();this.TWb.reset()}pBd(za){this.sa.addHandler("TMUDM",
za)}}fa.T9m=1E3;Object(D.a)(fa,"ThrottlerManager",null,[894]);var oa;(function(za){za[za.unspecified=0]="unspecified";za[za.word=1]="word";za[za.excel=2]="excel";za[za.powerPoint=3]="powerPoint";za[za.test=4]="test";za[za.wacFrontEnd=5]="wacFrontEnd";za[za.oneNote=6]="oneNote";za[za.visio=7]="visio";za[za.officeMobile=8]="officeMobile";za[za.cosmosDBChangefeed=9]="cosmosDBChangefeed";za[za.last=10]="last"})(oa||(oa={}));Object(D.b)("RtcClientAppName",oa);const ta=(za,Ca,ua,ib,bb,mb,yb,ab,Ga=null,
Za=null,Ub=null,Xb=null)=>{const zb=M.createInstance(y.AFrameworkApplication.K),Ib=y.AFrameworkApplication.buildVersion?y.AFrameworkApplication.buildVersion:"1.0",$a=Ka(za,Ca,yb,Ib),Hb=zb.UXk?c(1882).RealtimeChannelMetrics.createInstance($a):new F;var Ya=c(1536).FrequentLoggingMetrics.create(bb);zb.x7n&&Ya.bAo(zb.w7n);var Sa="";Sa=Ga&&""!==Ga?Ga:"/rtc2/";Ya.VZh=r.a.OX(Sa);const Eb=Sa+"signalr";Ga=Sa+"findsession";const Jb=L.Rtm;Sa=new Da;Ub=Ub||P.a.getInstance();l.ULS.shipAssertTag(556867617,500,
zb.Bej<=c(1546).RealtimeChannel.oMi,"Client attempting to override max payload size beyond absolute limit");const vb=Math.min(zb.Bej,c(1546).RealtimeChannel.oMi);Ya.nMi=vb;Ya=new Na(zb,new fa(Sa),za,$a,ac=>new J(ac.createHubProxy(Jb)),ab,Ub,Hb,Ya,vb);Za||(Za=c(1773).FindSessionStrategy.createInstance(Ca,bb,Ga,ab,Ib,yb,za,$a,Ub,mb,ib,Xb));Za.KNd=zb.KNd;Ca=new G($a);ua=ua?ua.split(","):null;za=new (c(1546).RealtimeChannel)(za,ua,$a,ab,()=>$.hubConnection(Eb),Za,Ya,Ca,Ub,Hb,zb,bb);za.init();return za},
Ka=(za,Ca,ua)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",za,va(oa[ua]),va("browser"),Ca),va=za=>za?za.charAt(0).toLocaleUpperCase()+za.substring(1,za.length):za;c.d(I,"RealtimeChannel",function(){return La});class La{constructor(za,Ca,ua,ib,bb,mb,yb,ab,Ga,Za,Ub,Xb){this.$Se=!1;this.C6=null;this.i3=new x.a;this.bsc=1;this.Qea=null;this.fm=!1;this.zHe=(new Date(0)).getTime();this.vfh=0;this._clientId=za;this.Cyd=Ca;this.iaa=0;this.he=ib;this.Sve=ab;this.kgk=yb;this.LSj=Ga;
this.$Xj=bb;this.X9a=mb;this.$v=ua;this.au=Za;this.Sf=Ub;this.Wf=Xb;this.mik=1>100*Math.random()}get LRa(){return this.X9a.LRa}set LRa(za){this.X9a.LRa=za}get Pob(){return this.kgk}get vm(){return this.LSj}init(){this.vm.lxk(Object(f.a)(this,this.qKd,"disconnectAndCreateNewConnection"));this.vm.Lxk(Object(f.a)(this,this.ktn,"onUpdatePersistentStateRequestReceivedInternal"));this.vm.Kxk(Object(f.a)(this,this.jtn,"onUpdatePersistentStateClearedRequestReceived"));this.Wf.S1b(this.au);y.AFrameworkApplication.lI(()=>
{const {FrequentLoggingMetrics:za}=c(1536);this.au.$4f();za.instance&&za.instance.bMf()});this.BLh();this.Gml();this.vm.wxk(Object(f.a)(this,this.vSo,"updateConnectionQueryString"))}Gml(){try{const ua=$.signalR;if(!ua)throw Error.invalidOperation("Failed to retrieve Signalr object");const ib=ua.version;if(!ib)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===ib){var za=ua.transports;if(!za)throw Error.invalidOperation("Failed to retrieve transports object");
var Ca=za.longPolling;if(!Ca)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!Ca.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");Ca.supportsKeepAlive=this.Dcl()}}catch(ua){l.ULS.sendTraceTag(6432339,500,15,"Failed to disable longPolling KeepAlives: {0}",ua.message)}}Dcl(){return()=>!1}BLh(){const za=++this.bsc;this.zHe=(new Date(0)).getTime();this.Qea=this.$Xj();this.vm.iMn(this.Qea);this.Qea.stateChanged(Ca=>
{this.rkn(Ca,za)});this.Qea.connectionSlow(Object(f.a)(this,this.asn,"onSlowConnection"));this.Qea.error(Object(f.a)(this,this.Trn,"onSignalRError"));this.Qea.log=Object(f.a)(this,this.Urn,"onSignalRLog")}Eoc(za,Ca){return za!==this.bsc?(l.ULS.sendTraceTag(4309017,500,50,"ConnectionToken verification failed for {0}",Ca),!1):!0}connect(){2!==this.iaa&&1!==this.iaa&&(l.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.$v),this.Sve.nkn(),z.a.instance.cAo(),this.Mia(1,
this.iaa),this.xtj())}xtj(){const za=this.bsc;this.$Se=!1;this.au.l6i();this.X9a.pam(Object(f.a)(this,this.w2k,"connectSignalrConnection"),Object(f.a)(this,this.xTi,"onFailureToConnect"),Object(f.a)(this.Pob,this.Pob.Fxm,"initThrottlerManager"),Object(f.a)(this,this.Eoc,"verifyConnectionToken"),za)}xTi(za=null){this.au.n6i();let Ca=null;!za||"documentsessiondeleted"!==(Ca=za.toLowerCase())&&"documentsessionexpired"!==Ca?this.qKd():(l.ULS.sendTraceTag(41788292,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",
this.$v,za),this.disconnect())}qKd(za,Ca=null){l.ULS.sendTraceTag(4309018,500,50,"Disconnecting the connection [{0}]",this.C6);za=(za=2===this.iaa||1===this.iaa)&&!this.Pob.gEb;let ua=!0,ib=0;Ca&&Object.getType(Ca)!==Object.getType(Sys.EventArgs.Empty)&&Ca.l8f&&""!==Ca.l8f&&(za=!0,this.X9a.xko(Ca.l8f),ua=Ca.Cag,ib=Ca.reconnectDelay);za&&this.Mia(1,this.iaa);++this.bsc;this.Pob.f6();this.qBo(ua);this.X9a.hol();this.BLh();za&&window.setTimeout(Object(f.a)(this,this.xtj,"startConnecting"),Math.min(ib,
3E4))}vSo(){let za=null;const Ca=({correlationId:za}=this.X9a.q8h()).returnValue;this.Qea.qs=Ca;l.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.$v,za)}w2k(za){const {FrequentLoggingMetrics:Ca}=c(1536);this.zHe=(new Date).getTime();let ua=null;this.Qea.qs=({correlationId:ua}=this.X9a.q8h()).returnValue;this.Sf.Uzk&&(this.Qea.url=za,Ca.instance&&(Ca.instance.HGh=r.a.OX(za)));let ib=null;this.he&&(ib=this.he.Vf("WebServiceCall","ConnectToServer"));
l.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",this.$v);za={};this.Cyd&&(za.transport=1===this.Cyd.length?this.Cyd[0]:this.Cyd);za.pingInterval=null;z.a.instance.h5c(1,0);za.waitForPageLoad=!1;this.Qea.start(za,null).done(bb=>{this.au.o6i();z.a.instance.h5c(1,1,!0);l.ULS.sendTraceTag(3457857,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",bb.id,ua)}).fail(bb=>{l.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1},  ClientDetails: [{2}]",
this.X9a.rX,ua,this.$v);this.xTi();this.au.m6i(bb);z.a.instance.h5c(1,1,!1);this.vm.f5i(0,{["CorrelationId"]:ua,["ErrorDetails"]:bb,["ConnectionState"]:k.a[this.iaa]})}).always(()=>{const {FrequentLoggingMetrics:bb}=c(1536);ib&&ib.stop();bb.instance&&(bb.instance.Uze=!1)})}disconnect(){const {FrequentLoggingMetrics:za}=c(1536);0===this.iaa?l.ULS.sendTraceTag(36545632,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.$v):(this.au.r6i(),za.instance&&(za.instance.Uze=
!0),l.ULS.sendTraceTag(36545633,500,50,"Starting explicit disconnect for [{0}]",this.$v),this.Pob.gEb=!0,this.Sve.hln(),this.Mia(0,this.iaa),this.qKd(),this.Pob.gEb=!1)}qBo(za){const Ca=this.hQk(),ua=this.Qea,ib=this.C6,bb=()=>{if(this.$Se)l.ULS.sendTraceTag(591692192,500,15,"Stop connection was called twice, possibly on the same connection.");else try{this.$Se=!0,ua.stop(!0,za)}catch(mb){l.ULS.sendTraceTag(591692191,500,15,"Stopping connection failed: {0}",mb.message)}};0<Ca?(l.ULS.sendTraceTag(4309020,
500,50,"Waiting to stop connection [{0}]: [{1}] ms.",ib,Ca),window.setTimeout(bb,Ca)):(l.ULS.sendTraceTag(36804372,500,50,"Stopping connection [{0}].",ib),bb())}hQk(){let za=0;0===this.Qea.state&&(za=this.zHe+La.o1o-(new Date).getTime(),0>za&&(za=0));return za}get connectionState(){return this.iaa}xua(za){this.vm.xua(za)}Lic(za){this.vm.Lic(za)}Lhj(za){this.Yjc(0,za)}Yjc(za,Ca){const ua=new a.a;this.vm.i5i(za,Ca,ua);return ua.task}b_a(za){this.vm.b_a(za)}AOb(za){this.vm.AOb(za)}tFc(za){this.vm.tFc(za)}d6c(za){this.vm.d6c(za)}mBd(za){this.vm.mBd(za)}Sce(za){this.vm.Sce(za)}rRc(za){return this.Fhm(za)}ZEb(){return this.z8b(0)}z8b(za){const Ca=
{};for(let ua of this.i3)ua.value.nb(za)&&(Ca[ua.key]=ua.value.J(za).data);return Ca}Fhm(za){return this.i3.nb(za)&&this.i3.J(za).nb(0)?this.i3.J(za).J(0).data:null}ktn(za,Ca){for(let ua of Ca.pYo)this.i3.nb(ua.key)||this.i3.Z(ua.key,new K.a),za=ua.value,this.i3.J(ua.key).Z(Ca.type,new v(za.Presence,new Date(za.TimeStamp))),ua.key===this._clientId&&0===Ca.type&&this.vm.OLn(za.Presence)}jtn(za,Ca){for(const ua of Ca.zFd)this.i3.remove(ua)}eLl(){const za=new K.a;if(!this.i3.nb(this._clientId))return za;
for(let Ca of this.i3.J(this._clientId))za.Z(Ca.key,Ca.value.data);return za}pN(za,Ca=null,ua=!1){const ib=new a.a;this.vm.h4f(za,Ca,ua,ib);return ib.task}G3(za){this.vm.G3(za)}BOb(za){this.vm.BOb(za)}bjb(za){let Ca,ua;return({value:Ca}=this.i3.Fc(za)).returnValue&&({value:ua}=Ca.Fc(0)).returnValue?new m(this.Khm(ua),ua.timeStamp):null}HOc(){const za={};for(let Ca of this.i3)Ca.value.Fc(0).returnValue&&(za[Ca.key]=this.bjb(Ca.key));return za}krb(za){const Ca=new a.a;this.vm.o5i(za,Ca);return Ca.task}get clientId(){return this._clientId}get qwo(){return this.mik}dispose(){const {FrequentLoggingMetrics:za}=
c(1536);this.fm||(this.Pob.f6(),this.Wf.M6f(this.au),this.au.$4f(),za.instance&&za.instance.bMf(),this.fm=!0)}rkn(za,Ca){this.Eoc(Ca,"StateChangedSignalR")&&this.Mia(this.sIh(za.newState),this.sIh(za.oldState))}Mia(za,Ca){var {FrequentLoggingMetrics:ua}=c(1536),{ClientToClientMessageTelemetry:ib}=c(1785);if((1!==this.iaa||0!==Ca||1!==za)&&this.iaa!==Ca){const bb=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.iaa,
Ca,za]));l.ULS.sendTraceTag(3290053,500,10,bb)}if(this.iaa!==za){switch(za){case 2:ua.instance&&ua.instance.s8m();this.C6=this.Qea.id;l.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.C6,this.$v);this.z5m(this.Qea);l.ULS.sendTraceTag(4298369,500,50,"Retrieving complete session state");ua=null;this.he&&(ua=this.he.Vf("WebServiceCall","Receive First Presence"));ib=this.bsc;this.vm.hMn(Object(f.a)(this,this.Eoc,"verifyConnectionToken"),ib,this.Sve,Object(f.a)(this,
this.Y6e,"clearExistingPersistentState"),this.eLl(),ua);this.Sf.s7n&&(ua=100*Math.random()<=this.Sf.t7n,c(1785).ClientToClientMessageTelemetry.K9b(this.vm,this.Sf,ua).start());break;case 1:2===Ca&&l.ULS.sendTraceTag(4298644,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.C6);break;case 0:if(ib.instance&&ib.instance.stop(),this.Pob.gEb)l.ULS.sendTraceTag(3249543,500,50,"Connection [{0}] has been explicitly closed",this.C6);else{1===Ca&&(l.ULS.sendTraceTag(7672737,500,
50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this.C6),this.au.s6i());2===Ca&&l.ULS.sendTraceTag(36574532,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.C6);this.qKd();return}}this.iaa=za;this.vm.lLn(za,Ca)}}z5m(za){if(za&&za.transport&&za.transport.name){za=za.transport.name;var Ca=za.toLowerCase();
"websockets"===Ca?l.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",za,this.$v):"serversentevents"===Ca?l.ULS.sendTraceTag(4290752,500,50,"Transport name - {0} for [{1}]",za,this.$v):"foreverframe"===Ca?l.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",za,this.$v):"longpolling"===Ca?l.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",za,this.$v):"mocktransport"!==Ca&&l.ULS.sendTraceTag(4290755,500,15,"Unknown transport protocol encountered - '{0}'",
za)}else l.ULS.sendTraceTag(4290722,500,10,"Transport protocol name is missing")}asn(){if(this.Sf.Aej){const za=r.a.iP(this.LRa,"mid");l.ULS.sendTraceTag(3249544,500,15,"Detected that the connection [{0}] is slow for target machine [{1}]",this.C6,za)}else l.ULS.sendTraceTag(522716053,500,50,"Detected that the connection [{0}] is slow",this.C6)}Trn(){l.ULS.sendTraceTag(3249545,600,15,"SignalR ERROR for connection [{0}];",this.C6)}Urn(za){za=c(1516).RtcUtils.Ufc(za);if(this.Sf.Aej&&za.startsWith("Keep alive timed out.")){const Ca=
r.a.iP(this.LRa,"mid");l.ULS.sendTraceTag(522716054,500,15,"SignalR lib: {0}. Target Machine: {1}",za,Ca)}else this.qwo&&2E3>this.vfh&&!za.startsWith("Invok")&&!za.startsWith("Trigger")&&(l.ULS.sendTraceTag(578950464,500,50,"SignalR lib: {0}",za),this.vfh++)}Y6e(){let za;const Ca=[];({value:za}=this.i3.Fc(this._clientId)).returnValue&&this.i3.remove(this._clientId);for(let ua of this.i3.keys)Array.add(Ca,ua);for(const ua of Ca)this.i3.remove(ua);za&&this.i3.Z(this._clientId,za);this.vm.ILn(Ca)}sIh(za){switch(za){case 0:return 1;
case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",za,"Unknown SignalR state");}}Khm(za){return za&&za.timeStamp?(new Date).getTime()-za.timeStamp.getTime()>(this.Sf.zHk?6E4:this.Sf.yHk)?2:1:1}static createInstance(za,Ca,ua,ib,bb,mb,yb,ab=null,Ga=null,Za=null,Ub=null,Xb=null,zb=null){return ta(za,Ca,ua,zb,ib,bb,mb,yb,ab,Ga,Za,Xb,Ub)}}La.oMi=31E3;La.NNf=8E3;La.o1o=15E3;Object(D.a)(La,"RealtimeChannel",null,[864,865])},1638:function(D,I,c){c.d(I,"a",function(){return l});
D=c(0);class l{constructor(){this.ygh=!1;this.Pxb=null;this.vPg=0;this.sAe=this.VMh();this.uhd=this.VMh();this.btb=this.NWb=0;this.jq=()=>new Date}get HCo(){return this.ygh}VMh(){const f=Array(6);for(let a=0;a<f.length;a++)f[a]=0;return f}aWl(){return this.sAe.toString()}CQl(){return this.uhd.toString()}cAo(){this.Pxb=this.jq()}h5c(f,a,k=!1){this.HCo||(k&&(this.ygh=!0),k=this.jq(),0===f&&5<this.NWb||1===f&&5<this.btb||(this.vPg<f?(1===this.NWb%2&&(this.sAe[this.NWb]=-1,this.NWb++),this.vPg=f,1===
a&&(this.uhd[this.btb]=-1,this.btb++),this.uhd[this.btb]=this.cig(k),this.btb++):0===f?(this.sAe[this.NWb]=this.cig(k),this.NWb++):(this.uhd[this.btb]=this.cig(k),this.btb++)))}cig(f){const a=f.getTime()-this.Pxb.getTime();this.Pxb=f;return a}static get instance(){l._instance||(l._instance=new l);return l._instance}static set instance(f){l._instance=f}}l._instance=null;Object(D.a)(l,"LatencyMetrics",null,[])},1665:function(D,I,c){D=c(0);class l{constructor(){this.lMg=this.Mve=!1;this.callback=null}f1c(a){this.callback=
a;this.Gzj()}GLi(a){this.Mve||(this.Mve=!0,this.SXj=a,this.Gzj())}Gzj(){this.Mve&&this.callback&&!this.lMg&&(this.lMg=!0,this.callback(this.SXj))}}Object(D.a)(l,"CompletionTask",null,[]);c.d(I,"a",function(){return f});class f{constructor(){this.L5g=new l;this.J5g=new l}$6d(a){this.L5g.f1c(a)}Z6d(a){this.J5g.f1c(a)}l_c(a){this.L5g.GLi(a)}jmb(a){this.J5g.GLi(a)}yNf(){this.l_c(2);this.jmb(2)}}Object(D.a)(f,"MessageStatus",null,[908])},1717:function(D,I,c){c.r(I);c.d(I,"MaxOutstandingThrottler",function(){return k});
D=c(0);var l=c(54),f=c(80);I=c(1718);var a=c(1665);class k extends I.a{constructor(x,y=""){super(x,y);this.dfc=this.Nqb=0;this.sa=new f.a;this.VXb=!1;this.krd=this.Xhd=this.vhd=this.DUe=0;this.y3=[];this.clearTimeout=k.Gcf}add(x){this.WXb||this.init(k.gPh,k.OOh);this.uzb++;const y=new a.a;this.Hcc?this.Wge(x,y):this.krd<this.dfc?this.b8c(x,y):(this.Wge(x,y),this.VXb=!1);return y}b8c(x,y){x=this.Sdh(x);const m=this.setTimeout(Object(l.a)(this,this.oon,"onMessageWaitTimeExpired"),this.Nqb);++this.krd;
Array.add(this.y3,m);const r=this.vhd;x.$6d(z=>{y.l_c(z)});x.Z6d(z=>{this.vhd===r&&(this.non(r,m),y.jmb(z))})}non(x,y){this.vhd===x&&(--this.krd,this.clearTimeout(y),Array.remove(this.y3,y),this.Hcc&&this.oco())}oco(){this.Hcc&&!this.VXb&&(this.DUe=this.setTimeout(Object(l.a)(this,this.pco,"sendThrottledMessageFromTimer"),0),this.VXb=!0)}pco(){this.VXb=!1;if(this.Hcc){const x=this.Zxd,y=this.w0b;this.ZHc(!1);this.b8c(x,y)}}oon(){++this.Xhd;this.Xhd>Math.floor(this.dfc/2)&&(this.Xhd=-1E9,this.sa.raiseEvent("TMUDM"))}pBd(x){this.sa.addHandler("TMUDM",
x)}reset(){this.uzb=this.DDc=this.Rtc=this.Xhd=0;++this.vhd;for(const x of this.y3)this.clearTimeout(x);this.krd=0;this.y3=[];this.ZHc(!0);this.VXb&&(this.clearTimeout(this.DUe),this.DUe=0,this.VXb=!1)}init(x,y){this.WXb||(this.Nqb=x,this.dfc=y,this.WXb=!0)}static createInstance(x,y=""){return new k(x,y)}static Gcf(x){window.clearTimeout(x)}}k.gPh=15E3;k.OOh=5;Object(D.a)(k,"MaxOutstandingThrottler",I.a,[906,905])},1718:function(D,I,c){c.d(I,"a",function(){return f});D=c(0);var l=c(7);class f{constructor(a,
k=""){this.Rtc=this.DDc=0;this.zFe=!1;this.w0b=this.Zxd=null;this.WXb=!1;this.Sdh=a;this.Bxj=k;this.setTimeout=f.Ncf;this.uzb=this.DDc=this.Rtc=0}Z4f(){0<this.uzb&&0<this.Rtc&&l.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.Bxj,this.Rtc,this.uzb);0<this.uzb&&0<this.DDc&&l.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.Bxj,this.DDc,this.uzb)}get Hcc(){return this.zFe}Wge(a,k){this.DDc++;this.ZHc(!0);this.zFe=
!0;this.Zxd=a;this.w0b=k}ZHc(a){this.zFe=!1;this.w0b&&a&&(this.Rtc++,this.w0b.yNf());this.w0b=this.Zxd=null}static Ncf(a,k){return window.setTimeout(a,k)}}Object(D.a)(f,"ThrottlerBase",null,[])},1719:function(D,I,c){c.r(I);c.d(I,"MaxRateThrottler",function(){return a});D=c(0);var l=c(54);I=c(1718);var f=c(1665);class a extends I.a{constructor(k,x=""){super(k,x);this.lfc=0;this.Lxc=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(k){this.WXb||(this.lfc=k,this.WXb=!0)}add(k){this.WXb||
this.init(a.EOh);this.uzb++;const x=this.currentTime(),y=new f.a;this.Lxc>x&&(this.Lxc=x);this.Hcc?(this.ZHc(!0),this.Wge(k,y)):this.Lxc+this.lfc<=x?this.b8c(k,y):(this.Wge(k,y),this.setTimeout(Object(l.a)(this,this.nco,"sendThrottledMessage"),this.Lxc+this.lfc-x));return y}nco(){if(this.Hcc){const k=this.Zxd,x=this.w0b;this.ZHc(!1);this.b8c(k,x)}}b8c(k,x){this.Lxc=this.currentTime();k=this.Sdh(k);k.$6d(y=>{x.l_c(y)});k.Z6d(y=>{x.jmb(y)})}static createInstance(k,x=""){return new a(k,x)}}a.EOh=200;
Object(D.a)(a,"MaxRateThrottler",I.a,[904,905])},1720:function(D,I,c){c.d(I,"a",function(){return l});D=c(0);class l extends Sys.EventArgs{constructor(f,a,k,x){super();this.type=f;this.LL=a;this.wjl=k;this.o8a=x}}Object(D.a)(l,"SendUpdateNotificationEventArgs",Sys.EventArgs,[])},1721:function(D,I,c){c.d(I,"a",function(){return l});D=c(0);class l{}l.n$f="rr";l.v7n="rd";l.r7n="rbp";l.Cag="sa";Object(D.a)(l,"RtcReconnectParams",null,[])},1722:function(D,I,c){c.d(I,"a",function(){return l});D=c(0);class l{constructor(f,
a,k,x){this.Tan=f;this.Nqb=a;this.S9m=k;this.akm=x}}Object(D.a)(l,"ThrottlerManagerSettings",null,[])},1769:function(D,I,c){D=c(0);class l extends Sys.EventArgs{constructor(K,O){super();this.newState=K;this.oldState=O}}Object(D.a)(l,"ChangedConnectionStateEventArgs",Sys.EventArgs,[]);class f extends Sys.EventArgs{constructor(K,O){super();this.TXk=K;this.o8a=O}}Object(D.a)(f,"ClientInfoEventArgs",Sys.EventArgs,[]);class a extends Sys.EventArgs{constructor(K){super();this.presence=K}}Object(D.a)(a,
"MyPresenceUpdatedEventArgs",Sys.EventArgs,[]);var k=c(1884),x=c(1883),y=c(1881);class m extends Sys.EventArgs{constructor(K,O=null){super();this.Zj=K;this.Slk=O}get type(){return this.Zj}get LL(){return this.Slk}}Object(D.a)(m,"UpdateNotificationEventArgs",Sys.EventArgs,[]);class r extends Sys.EventArgs{constructor(){super()}}Object(D.a)(r,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class z extends Sys.EventArgs{constructor(K,O,V,W,T,Y){super();this.Eoc=K;this.S8e=O;this.y2k=
V;this.AXh=T;this.Y6e=W;this.YA=Y}}Object(D.a)(z,"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class v extends Sys.EventArgs{constructor(K){super();this.hubConnection=K}}Object(D.a)(v,"RefreshProxyEventArgs",Sys.EventArgs,[]);class G extends Sys.EventArgs{constructor(K,O){super();this.fha=K;this.errorMessage=O}}Object(D.a)(G,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class F extends Sys.EventArgs{constructor(K,O,V){super();this.type=K;this.presence=O;this.o8a=V}}Object(D.a)(F,"SendPersistentStateEventArgs",
Sys.EventArgs,[]);var H=c(1720);class L extends Sys.EventArgs{constructor(){super()}}Object(D.a)(L,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class J extends Sys.EventArgs{constructor(K){super();this.zFd=K}}Object(D.a)(J,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class M extends Sys.EventArgs{constructor(K,O){super();this.type=K;this.pYo=O}}Object(D.a)(M,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var P=c(80);c.d(I,"a",function(){return N});class N{constructor(){this.sa=
new P.a}lLn(K,O){this.sa.raiseEvent("CSC",new l(K,O))}iMn(K){this.sa.raiseEvent("RP",new v(K))}Mbe(K){this.sa.raiseEvent("RC",K)}lMn(){this.sa.raiseEvent("RMID")}hMn(K,O,V,W,T,Y){this.sa.raiseEvent("RPS",new z(K,O,V,W,T,Y))}p5i(K,O){this.sa.raiseEvent("UPSR",new M(K,O))}b5i(K,O){this.sa.raiseEvent("PU",new y.a(K,O))}OLn(K){this.sa.raiseEvent("MPU",new a(K))}h4f(K,O,V,W){this.sa.raiseEvent("SUN",new H.a(K,O,V,W))}AMn(K,O){this.sa.raiseEvent("UNR",new m(K,O))}i5i(K,O,V){this.sa.raiseEvent("SP",new F(K,
O,V))}$4i(K,O){this.sa.raiseEvent("PSU",new x.a(K,O))}bMn(K){this.sa.raiseEvent("PSC",new k.a(K))}ILn(K){this.sa.raiseEvent("IPSC",new k.a(K))}BMn(K){this.sa.raiseEvent("UPSC",new J(K))}nMn(K,O){this.sa.raiseEvent("SPC",new L(K,O))}f5i(K,O){this.sa.raiseEvent("RCF",new G(K,O))}BLn(K){this.sa.raiseEvent("CPSWM",new r(K))}o5i(K,O){this.sa.raiseEvent("UCI",new f(K,O))}xua(K){this.sa.addHandler("CSC",K)}Lic(K){this.sa.removeHandler("CSC",K)}mxk(K){this.sa.addHandler("RP",K)}lxk(K){this.sa.addHandler("RC",
K)}pxk(K){this.sa.addHandler("RMID",K)}kxk(K){this.sa.addHandler("RPS",K)}Lxk(K){this.sa.addHandler("UPSR",K)}b_a(K){this.sa.addHandler("PU",K)}AOb(K){this.sa.removeHandler("PU",K)}ivk(K){this.sa.addHandler("IPU",K)}Ixk(K){this.sa.addHandler("UCI",K)}uxk(K){this.sa.addHandler("SUN",K)}jvk(K){this.sa.addHandler("IUNR",K)}G3(K){this.sa.addHandler("UNR",K)}BOb(K){this.sa.removeHandler("UNR",K)}tFc(K){this.sa.addHandler("PSU",K)}d6c(K){this.sa.removeHandler("PSU",K)}hvk(K){this.sa.addHandler("IPSU",K)}mBd(K){this.sa.addHandler("PSC",
K)}Sce(K){this.sa.removeHandler("PSC",K)}gvk(K){this.sa.addHandler("IPSC",K)}Kxk(K){this.sa.addHandler("UPSC",K)}sxk(K){this.sa.addHandler("SP",K)}wxk(K){this.sa.addHandler("SPC",K)}static getInstance(){return N._instance||(N._instance=new N)}}N._instance=null;Object(D.a)(N,"RtcEventHub",null,[895])},1773:function(D,I,c){c.r(I);D=c(0);var l=c(7),f=c(54),a=c(75),k=c(883);class x{}x.lfc="throttling_messageDelay";x.UWc="enabled";x.Nqb="throttling_timeToWaitForResponse";x.dfc="throttling_maxNumberOfOutstandingMessages";
x.yji="throttling_globalMaxNumberOfOutstandingMessages";x.errorMessage="errorMessage";x.Irj="url";x.GHa="queryString";x.rX="connectionString";Object(D.a)(x,"RtcFindSessionOutputFieldNameConstants",null,[]);var y=c(2),m=c(45),r=c(39),z=c(312),v=c(1385),G=c(85),F=c(19),H=c(135);class L{constructor(){this.zji=this.lMi=this.mMi=this.rMi=0;this.K_d=!1;this.correlationId=this.rX=this.GHa=this.T8e=this.errorMessage=null}get u1k(){return this.T8e+"?"+this.GHa}}Object(D.a)(L,"FindSessionResponse",null,[]);
var J=c(592);class M{constructor(Z,ea,ha,la,ia,sa){this.zYa=null;const {FindSessionStrategy:Oa}=c(1773);this.wek=Z;Z=String.format("{0}={1}",J.a.clientId,F.a.Dj(la));Z=String.format("{0}&{1}={2}",Z,J.a.userSessionId,F.a.Dj(ia));Z=String.format("{0}&{1}={2}",Z,J.a.kHj,F.a.Dj(ha.toString()));Z=String.format("{0}&{1}={2}",Z,J.a.userType,F.a.Dj("1"));Z=String.format("{0}&{1}={2}",Z,J.a.uHj,F.a.Dj(ea));Z=String.format("{0}&{1}={2}",Z,J.a.NDh,F.a.Dj(Oa.VXk));(ea=M.Umf(ha,sa))&&(Z=String.format("{0}&{1}",
Z,ea));this.bYj=Z}p7i(){this.zYa=this.wek()}generate(){this.zYa&&""!==this.zYa||(this.p7i(),l.ULS.sendTraceTag(575784194,500,this.zYa&&""!==this.zYa?50:15,"Query signature delegate called for refresh returned: {0} ",this.zYa));const Z=String.format("{0}={1}",J.a.TNb,F.a.Dj(this.zYa));return String.format("{0}&{1}",Z,this.bYj)}static Umf(Z,ea){return 4===Z?String.format("{0}={1}",J.a.OPi,"1"):ea?ea.wii():null}}Object(D.a)(M,"FindSessionQueryStringGenerator",null,[]);var P=c(1536),N=c(1638),K=c(1516),
O=c(1722);class V{}V.RCl="FSType";Object(D.a)(V,"RtcFindSessionRequestHeaders",null,[]);class W{}W.yNn="polling";Object(D.a)(W,"RtcFindSessionTypes",null,[]);var T=c(1721);class Y{}Y.b0o="RTC-TokenProofkey";Y.lVm="RTC-IsWacJsBootFsRequest";Object(D.a)(Y,"RtcRequestHeaders",null,[]);c.d(I,"FindSessionStrategy",function(){return ba});class ba{constructor(Z,ea,ha,la,ia,sa,Oa,Ra,Na,Da,ra,xa,fa=null){this.F2g=(new Date(0)).getTime();this.S4g=0;this.bqd=!1;this.eeh=null;this.p5f=36E5;this.gVb=ba.$pi;this.ruc=
0;this.OOb=null;this.CTa=0;this.zjc=this.JGh=null;this.Afk=[x.UWc,x.errorMessage,x.Irj,x.rX,x.GHa,x.yji,x.dfc,x.Nqb,x.lfc];this.zfk=[x.UWc,x.errorMessage];this.rX=this.LRa=null;this.eUg=new M(ra?ra:()=>y.AFrameworkApplication.km,ia,sa,Oa,Z,ea);this.rrc=xa;this.he=la;this.Wf=ea;this.wAe=ha;this.$v=Ra;this.vm=Na;this.Luc=fa;this.fUg=!1;this.KNd=9E4;Da&&Da.execute(oa=>{oa.ZZa(()=>{l.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.$v);this.eUg.p7i()})});
2>=100*Math.random()&&(this.p5f=3E5);P.FrequentLoggingMetrics.instance&&(P.FrequentLoggingMetrics.instance.Q1h=this.p5f)}xko(Z){this.zjc=Z}init(){this.vm.pxk(Object(f.a)(this,this.E3n,"resetGetMachineIdDelay"));this.vm.xua(Object(f.a)(this,this.Mia,"onConnectionStateChanged"))}Mia(Z,ea){this.CTa=ea.newState;2===ea.newState&&(this.ruc=0)}q8h(){let Z;Z=this.OOb.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.OOb.GHa,ba.fJh,F.a.Dj(Z)),correlationId:Z}}pam(Z,ea,ha,la,ia){this.jbo(()=>
{la(ia,"GetMachineIdSuccess")&&(l.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",this.rX,this.$v),Z(this.eeh),ha(this.Lfm()))},sa=>{la(ia,"GetMachineIdFailure")&&(l.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.$v),ea(sa))},la,ia)}hol(){this.tDh();this.$vm()}jbo(Z,ea,ha,la){l.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",this.rX);if(this.rX)Z();
else{var ia=this.nPk();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(Z,ea,ha,la)},ia)}}sendFindSessionRequestToServerInternal(Z,ea,ha,la){ha(la,"RequestMachineId")&&(this.F2g=(new Date).getTime(),ha=r.a.We(),this.NQd(ia=>{const sa=r.a.We();this.a_i(ia);this.Ecg();Z();ia=r.a.We()-sa;l.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",ia)},ia=>{const sa=r.a.We();this.tDh();P.FrequentLoggingMetrics.instance&&P.FrequentLoggingMetrics.instance.qP(2,3);ea(ia);ia=
r.a.We()-sa;l.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",ia)},!1),ha=r.a.We()-ha,l.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",ha))}$vm(){this.gVb+=ba.Z1l;this.gVb=Math.min(this.gVb,ba.C9m)}nPk(){var Z=(new Date).getTime();Z=this.F2g+this.gVb-Z;0>Z&&(Z=0);return Z}a_i(Z){try{this.OOb=Z,this.LRa=Z.u1k,this.rX=Z.rX,this.JGh=Z.GHa,this.eeh=Z.T8e}catch(ea){l.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",
ea.toString())}}tDh(){this.rX=null;this.uDh()}Ecg(){this.uDh();this.bqd=!0;this.S4g=window.setTimeout(Object(f.a)(this,this.GRn,"refreshMachineId"),this.p5f)}uDh(){this.bqd&&(window.clearTimeout(this.S4g),this.bqd=!1)}GRn(){this.bqd=!1;this.NQd(Z=>{const ea=this.JGh!==Z.GHa,ha=this.rX!==Z.rX,la=this.rX;this.a_i(Z);0!==this.CTa&&(ha?(l.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",la||"null",Z.rX),this.vm.Mbe()):(this.vm.nMn(ea,ha),this.Ecg()))},
()=>{P.FrequentLoggingMetrics.instance&&P.FrequentLoggingMetrics.instance.qP(2,3);this.Ecg()},!0)}E3n(){this.gVb=ba.$pi}Lfm(){return new O.a(this.OOb.rMi,this.OOb.mMi,this.OOb.lMi,this.OOb.zji)}ZKo(Z){if(Object.getType(Z)!==Object)return null;for(let ea in Z);return this.u9k(Z)}u9k(Z){if(!(x.UWc in Z))return null;const ea=Z[x.UWc];var ha=ea?this.Afk:this.zfk;for(const la of ha)if(!(la in Z))return null;ha=Object.assign(new L,{K_d:Z[x.UWc],errorMessage:Z[x.errorMessage],correlationId:H.a.create().toString()});
ea&&(ha.T8e=Z[x.Irj],ha.GHa=Z[x.GHa],ha.rX=Z[x.rX],ha.zji=Z[x.yji],ha.lMi=Z[x.dfc],ha.mMi=Z[x.Nqb],ha.rMi=Z[x.lfc]);return ha}bWl(Z,ea){l.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");this.Luc.WZh.continueWith(()=>{this.Luc.WZh.result?(l.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),Z(this.Luc.XZh)):(l.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),ea(this.Luc.XZh))})}fcj(Z,ea,ha,la,ia=
!1){return sa=>{N.a.instance.h5c(0,1);Z&&Z.stop();this.rrc=this.zjc=null;this.FJi(sa.data,!0,ea);var Oa=K.RtcUtils.deserialize(sa.data.se,"FindSession",null);if(Oa)if(Oa=this.ZKo(Oa)){if(Oa.K_d&&Oa.GHa&&Oa.rX){l.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",this.$v);this.m2m(sa.data);ha(Oa);return}ea.FindSessionFailureReason="FindSessionInvalidResponse";ea.IsRtcEnabled=Oa.K_d;ea.IsQueryStringEmpty=!Oa.GHa;ea.IsConnectionStringEmpty=!Oa.rX;l.ULS.sendTraceTag(4290720,
500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",this.$v,Oa.K_d,!Oa.GHa,!Oa.rX)}else ea.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",l.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.$v);else ea.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",l.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",
this.$v);this.g5i(ea,ia);la(null)}}$bj(Z,ea,ha,la=!1){return ia=>{N.a.instance.h5c(0,1);Z&&Z.stop();this.rrc=this.zjc=null;this.FJi(ia.data,!1,ea);let sa=null;var Oa="unknown";let Ra="unknown";ia.data&&((Oa=ia.data.Aj)&&ba.q7c in Oa&&(sa=Oa[ba.q7c].toString()),Oa=v.a[ia.data.status],Ra=ia.data.Qe.toString());ea.FindSessionFailureReason="FindSessionRequestFailed";ea.HttpErrorCode=Ra;ea.HttpErrorStatus=Oa;ea[ba.q7c]=sa;l.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",
Oa,Ra,this.$v,sa,la);this.g5i(ea,la);ha(Ra)}}NQd(Z,ea,ha=!1){let la=null;l.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.$v);const ia={};var sa=this.eUg.generate();ia[z.a.VQ]=H.a.create().toString();this.zjc&&""!==this.zjc?sa=String.format("{0}&{1}={2}",sa,T.a.n$f,this.zjc):this.rrc&&""!==this.rrc&&(sa=String.format("{0}&{1}={2}",sa,T.a.n$f,this.rrc),ia[Y.b0o]="True",ia[Y.lVm]="True");sa=this.wAe+"?"+sa;ha&&(ia[V.RCl]=W.yNn);const Oa={};Oa.IsNetworkOfflineBeforeSendRequest=
this.Wf.WQa;Oa.HasAvailableConnectionsBeforeSendRequest=this.Wf.eVd;Oa.MaxConnectionsAllowed=this.Wf.afc;Oa.IsRefreshMachineId=ha;this.Luc&&!this.fUg?(this.bWl(this.fcj(null,Oa,Z,ea,ha),this.$bj(null,Oa,ea,ha)),this.fUg=!0):(this.he&&(la=this.he.Vf("WebServiceCall","GetMachineIdFromTheServer")),P.FrequentLoggingMetrics.instance&&P.FrequentLoggingMetrics.instance.qP(2,0),0>this.Wf.oAb(sa,1,null,ia,[ba.MHd,ba.q7c,ba.N0c,ba.m$f,ba.MOi,ba.qRi,ba.pRi],1,this.fcj(la,Oa,Z,ea,ha),this.$bj(la,Oa,ea,ha),null,
!1,null,this.KNd,"3",null,!0)&&(5<this.ruc&&200>this.ruc&&l.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",this.ruc),window.setTimeout(()=>{this.ruc++;ea("-1")},1E3)))}FJi(Z,ea,ha){ha||(ha={});ha.IsNetworkOfflineAfterRequestComplete=this.Wf.WQa;ha.IsRequestSucceeded=ea;Z&&(ha.EnqueueTime=Z.QOa,ha.InvokedTime=Z.RH,ha.CompletedTime=Z.PT,Z.Aj&&(ba.MHd in Z.Aj&&(ha.CorrelationId=Z.Aj[ba.MHd]),ba.N0c in Z.Aj&&(ha[ba.N0c]=
Z.Aj[ba.N0c])));l.ULS.sendTraceTag(38633565,500,ea?50:15,K.RtcUtils.Ufc(ha))}g5i(Z,ea){Z||(Z={});Z.ConnectionState=k.a[this.CTa];ea||this.vm.f5i(1,Z)}m2m(Z){try{var ea=!1,ha=!1,la=Z.Aj,ia=m.a.OX(Z.request.get_url());if(la&&ba.m$f in la){const Da=la[ba.m$f].toString().toLocaleLowerCase();ha="true"===Da;ea="false"===Da}la=!1;const Na=0<=ia.toLocaleLowerCase().indexOf("collab");ha&&!Na?la=!0:ea&&Na&&(la=!0);if(la){ea={};ea.HostName=ia;ea.Status=v.a[Z.status];ea.HttpStatus=Z.Qe.toString();var sa=Z.request.get_headers();
for(let Da in sa){var Oa=sa[Da];(ia=Da)&&0<ia.length&&(ha=0,Oa&&(ha=Oa.toString().length),ea["r_"+ia]=ha)}if(Z.Aj){const Da=new a.a;Da.add(ba.MHd);Da.add(ba.N0c);Da.add(ba.q7c);Da.add(ba.qRi);Da.add(ba.pRi);Da.add(ba.MOi);ba.Qsk(ea,Z.Aj,Da)}ba.Bsk(Z.request.get_url(),ea);var Ra=G.a.toJSON(ea);l.ULS.sendTraceTag(559437006,500,15,Ra)}}catch(Na){l.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",Na.toString())}}static createInstance(Z,ea,ha,la,ia,sa,Oa,Ra,Na,Da,ra,xa=null){return ba.w$k(Z,
ea,ha,la,ia,sa,Oa,Ra,Na,Da,ra,xa)}static w$k(Z,ea,ha,la,ia,sa,Oa,Ra,Na,Da,ra,xa=null){Z=Z||H.a.create().toString();Z=new ba(Z,ea,ha,la,ia,sa,Oa,Ra,Na,Da,null,ra,xa);Z.init();return Z}static Qsk(Z,ea,ha){for(let la of ha)la in ea&&(Z[la]=ea[la])}static Bsk(Z,ea){if(Z){var ha=Z.indexOf("?");if(-1!==ha)for(Z=Z.substr(ha+1).split("&"),ha=0;ha<Z.length;++ha){var la=Z[ha].split("=");if(2===la.length){const ia=la[0];if(ia&&0<ia.length){let sa=0;if(la=la[1])sa=la.length;ea["q_"+ia]=sa}}}}}}ba.Z1l=3E3;ba.C9m=
3E5;ba.VXk="1.0";ba.$pi=1E3;ba.MHd="X-CorrelationId";ba.fJh="corrid";ba.q7c="RtcErrorCode";ba.N0c="X-OfficeCluster";ba.m$f="X-NewEnv";ba.MOi="X-MSEdge-Ref";ba.pRi="X-OFFICEFD";ba.qRi="X-OfficeFE";Object(D.a)(ba,"FindSessionStrategy",null,[891])},1785:function(D,I,c){c.r(I);D=c(0);var l=c(7),f=c(54),a=c(462),k=c(60),x=c(75);class y{constructor(r){this.messageId=r;this.rco=(new Date).getTime();this.RIf=new x.a}}Object(D.a)(y,"MessageLatencyDetails",null,[]);c.d(I,"ClientToClientMessageTelemetry",function(){return m});
class m{constructor(r,z,v){this.ULa=null;this.dJe=this.fRe=0;this.Sf=z;this.M5g=v;this.sCc=!1;this.vm=r;this.vm.G3(Object(f.a)(this,this.XNn,"receiveMessage"))}start(){if(this.M5g&&!this.sCc){const r=this.Sf.Eej;this.dJe=this.Sf.zej;r<=this.dJe?(l.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",this.Sf.Eej,this.Sf.zej),this.M5g=!1):
(this.sCc=!0,this.fRe=window.setInterval(Object(f.a)(this,this.sendMessage,"sendMessage"),r))}}sendMessage(){if(this.sCc){const r=k.a.create().toString();this.ULa=new y(r);this.vm.h4f(16,r,!1,new a.a);window.setTimeout(()=>{this.Z3m(r)},this.dJe)}}Z3m(r){this.ULa&&this.ULa.messageId===r&&(0<this.ULa.RIf.count?(r=this.ULa.RIf.toArray().join(","),l.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",r)):l.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),this.ULa=
null)}stop(){this.fRe&&(window.clearInterval(this.fRe),this.sCc=!1)}XNn(r,z){16===z.type?this.vm.h4f(17,z.LL,!1,new a.a):17===z.type&&this.sCc&&z.LL&&this.processMessage(z.LL)}processMessage(r){r&&this.ULa&&r.toString()===this.ULa.messageId&&(r=(new Date).getTime()-this.ULa.rco,this.ULa.RIf.add(r))}static get instance(){return m._instance}static K9b(r,z,v){return m.instance||(m._instance=new m(r,z,v))}}m._instance=null;Object(D.a)(m,"ClientToClientMessageTelemetry",null,[])},1881:function(D,I,c){c.d(I,
"a",function(){return l});D=c(0);class l extends Sys.EventArgs{constructor(f,a){super();this.Ora=f;this.rKd=a}}Object(D.a)(l,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1882:function(D,I,c){c.r(I);c.d(I,"RealtimeChannelMetrics",function(){return x});D=c(0);var l=c(7),f=c(199),a=c(85),k=c(1516);class x{constructor(){this.s7g=this.t7g=this.u7g=this.o7g=this.n7g=this.p7g=this.ozc=this.RKe=0;this.aLa=this.ZHe=this.Nxc=this.LHe=this.BXa=this.yHe=this.Jbb=this.yxc=this.eYb=this.xHe=this.Dkd=this.AWb=
null;this.pJe=this.Eyc=this.ceh=this.sNg=0;this.N5g=!1;this.l6i=this.K4f;this.o6i=this.N4f;this.n6i=this.M4f;this.s6i=this.P4f;this.r6i=this.O4f;this.$4f=this.a5f;this.i5c=this.Y4f;this.eOb=this.W4f;this.fOb=this.X4f;this.m6i=this.L4f;this.r5a=this.LRf;this.tLb=this.MRf}K4f(){this.RKe++;this.xHe=new Date;this.AWb||(this.AWb=new Date)}N4f(){this.ozc++;this.Jbb=new Date;this.Dkd||(this.Dkd=this.Jbb);this.Nxc=this.Jbb;this.N1k()}M4f(){this.p7g++;this.yHe=new Date}P4f(){this.n7g++;this.eYb=new Date}O4f(){this.o7g++;
this.yxc=new Date}Y4f(){this.BXa=new Date;this.u7g++}X4f(){this.aLa||(this.aLa=new Date);this.t7g++}W4f(){this.LHe=new Date;this.s7g++}a5f(){!this.N5g&&this.RKe&&(l.ULS.sendTraceTag(39321871,500,15,a.a.toJSON(this.HZk())),this.N5g=!0)}L4f(y){let m,r;({Yni:y,$ni:m,exception:r}=k.RtcUtils.vyl(y));y&&y!==f.a.$y&&(l.ULS.sendTraceTag(40157596,500,15,a.a.toJSON({["HttpErrorCode"]:y,["HttpErrorStatus"]:m,["Exception"]:r})),f.a.tCf(y)&&this.sNg++,f.a.xGf(y)&&this.ceh++)}LRf(){this.ZHe=new Date}MRf(){this.eYb=
this.Nxc=new Date}HZk(){return{["numberOfConnectionAttempts"]:this.RKe,["numberOfSuccessfulConnections"]:this.ozc,["numberOfFailedConnections"]:this.p7g,["numberOfDisconnectedConnections"]:this.n7g,["numberOfExplicitDisconnectedConnections"]:this.o7g,["numberOfSentMessages"]:this.u7g,["numberOfReceivedMessages"]:this.t7g,["numberOfLostMessages"]:this.s7g,["firstConnectionAttempt"]:this.AWb?this.AWb:null,["firstMessageReceived"]:this.aLa?this.aLa:null,["firstConnectionSuccess"]:this.Dkd?this.Dkd:null,
["lastConnectionAttempt"]:this.xHe?this.xHe:null,["lastConnectionSuccess"]:this.Jbb?this.Jbb:null,["lastConnectionFailure"]:this.yHe?this.yHe:null,["lastMessageSent"]:this.BXa?this.BXa:null,["lastMessageLost"]:this.LHe?this.LHe:null,["lastDisconnect"]:this.eYb?this.eYb:null,["lastExplicitDisconnect"]:this.yxc?this.yxc:null,["lastTimeOnline"]:this.Nxc?this.Nxc:null,["lastTimeOffline"]:this.ZHe?this.ZHe:null,["maxDisconnectedTimeMs"]:this.Eyc,["maxExplicitDisconnectedTimeMs"]:this.pJe,["clientConnectionErrors"]:this.sNg,
["serverConnectionErrors"]:this.ceh}}N1k(){this.AWb&&1===this.ozc&&(this.Eyc=Math.max(this.Eyc,this.Jbb.getTime()-this.AWb.getTime()));this.eYb&&1<this.ozc&&(this.Eyc=Math.max(this.Eyc,this.Jbb.getTime()-this.eYb.getTime()));this.yxc&&1<this.ozc&&(this.pJe=Math.max(this.pJe,this.Jbb.getTime()-this.yxc.getTime()))}static createInstance(y){x._instance||(x._instance=new x,l.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",y));return x._instance}}x._instance=null;Object(D.a)(x,
"RealtimeChannelMetrics",null,[892,244])},1883:function(D,I,c){c.d(I,"a",function(){return l});D=c(0);class l extends Sys.EventArgs{constructor(f,a){super();this.type=f;this.Ora=a}}Object(D.a)(l,"PersistentStateUpdateEventArgs",Sys.EventArgs,[])},1884:function(D,I,c){c.d(I,"a",function(){return l});D=c(0);class l extends Sys.EventArgs{constructor(f){super();this.zFd=f}}Object(D.a)(l,"PersistentStateClearedEventArgs",Sys.EventArgs,[])},2079:function(D,I,c){c.r(I);var l=c(0),f=c(54);class a{constructor(Aa,
Ab){this.Gfa=null;this.xAc=Aa;this.udk=Ab}init(){this.xAc.continueWith(()=>{this.Gfa=this.xAc.result;this.Gfa.h2b(Object(f.a)(this,this.xda,"onUsersUpdated"))})}xda(){a.L1e(this.Gfa.I1a())&&(this.Gfa.A7f(Object(f.a)(this,this.xda,"onUsersUpdated")),this.udk.IsRealCoauthSession=!0)}get IQm(){return this.Gfa?a.L1e(this.Gfa.I1a()):!1}static L1e(Aa){let Ab=null;for(const nc of Aa)if(nc)if(Aa=nc.isAnonymous||!nc.email?nc.clientId:nc.email.toUpperCase(),!Ab)Ab=Aa;else if(Ab!==Aa)return!0;return!1}}Object(l.a)(a,
"CoauthTelemetry",null,[786]);var k=c(7),x=c(462),y=c(69),m=c(2),r;(function(Aa){Aa[Aa.badStatePreventedTelemetry=0]="badStatePreventedTelemetry";Aa[Aa.notImplemented=1]="notImplemented";Aa[Aa.renderHandled=2]="renderHandled";Aa[Aa.renderHandledWithVeto=3]="renderHandledWithVeto"})(r||(r={}));Object(l.b)("CoauthorGalleryTelemetryEndResult",r);var z=c(86),v=c(85),G=c(129);class F{constructor(Aa,Ab,nc,Kc,hd,Rd,kc,ff,bd){this.s$g=this.NNg=this.zD=null;this.n6=Aa;this.Mwd=new x.a;this.Ga=nc;this.wve=
Ab;this.sZ=Kc;this.Rf=hd;this.kNe=Rd;this.Bcb=kc;this.xUj=ff;this.VWg=this.OWg=!1;this.fyd=0;this.LNg=1;this.Jsb=bd;this.oEc=this.Ga.$("PeoplesWellExtraButtonInfoIsEnabled");this.Hea=Object(y.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get buj(){return this.Mwd.task}init(){G.Task.WAA.call(null,this.Bcb,this.wve,this.kNe).continueWith(()=>{this.zD=this.Bcb.result;this.NNg=this.wve.result;this.s$g=this.kNe.result;G.Task.WAA.call(null,this.wve.result.p4b,this.kNe.result.Kxj).continueWith(()=>
{this.LNg=this.NNg.p4b.result;this.fyd=this.s$g.Kxj.result;this.zD.h2b(Object(f.a)(this,this.g8d,"onUsersUpdatedEventListener"));this.zD.I1a().length&&this.xda()})})}g8d(){this.xda()}xda(){this.xUj(this.zD.I1a())?(this.zD.A7f(Object(f.a)(this,this.g8d,"onUsersUpdatedEventListener")),this.Sln(this.OWg)):this.Mwd.rS(1);this.OWg=!0}Sln(Aa){this.VWg?this.buj.continueWith(()=>{k.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",r[this.buj.result])}):(this.VWg=
!0,this.pHn(0===this.LNg&&!Aa))}pHn(Aa){Aa?this.sZ.lk(4,Object(f.a)(this,this.KVf,"onInteractiveReady")):this.Mwd.rS(1)}KVf(){const Aa=this.Rf.jF("AppInitStatus_interactivityReady");k.ULS.shipAssertTag(42259235,325,!!this.fyd);const Ab=this.fyd-Aa,nc={};nc.InteractiveTime=Aa;nc.ReactRenderComplete=this.fyd;nc.HadTabSwitch=this.Jsb();nc.IsModernGallery=this.oEc;k.ULS.sendTraceTag(594883104,325,50,v.a.toJSON(nc));this.oEc?(k.ULS.sendTraceTag(42062997,325,15,Ab.toString()),this.Mwd.rS(this.z0o(Ab)?3:
2)):k.ULS.sendTraceTag(594883103,325,15,Ab.toString())}z0o(Aa){const Ab=Aa>this.Ga.lc("CoauthorGalleryTimeToRenderDurationMs",1E4),nc="Word"===this.Hea;if(this.Jsb())return k.ULS.sendTraceTag(50455714,325,50,Ab.toString()),!1;nc&&z.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);Ab&&(nc&&z.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null),k.ULS.sendTraceTag(42062998,325,15,Aa.toString()));
return Ab}}Object(l.a)(F,"CoauthorGalleryTelemetry",null,[785]);class H{constructor(Aa){this.zD=null;this.chd={};this.Psd={};this.kwc=null;this.Bcb=Aa}SSd(Aa){const Ab=new x.a;this.init().continueWith(()=>{Aa in this.chd?Ab.rS(this.chd[Aa]):this.Psd[Aa]=Ab});return Ab.task}init(){if(this.kwc)return this.kwc.task;this.kwc=new x.a;this.Bcb.continueWith(()=>{this.zD=this.Bcb.result;this.zD.h2b(Object(f.a)(this,this.xda,"onUsersUpdated"));this.FFj();this.kwc.Ag(null)});return this.kwc.task}FFj(){const Aa=
this.zD.I1a();Aa.sort(Object(f.a)(this,this.m1k,"comparePresenceUsers"));this.chd={};for(let Ab=0;Ab<Aa.length&&Aa[Ab]&&Aa[Ab].rRa;Ab++)this.tsk(this.chd,Aa[Ab].clientId,Ab)}tsk(Aa,Ab,nc){Aa[Ab]=nc;Ab in this.Psd&&(this.Psd[Ab].rS(nc),delete this.Psd[Ab])}xda(){this.FFj()}m1k(Aa,Ab){return Aa.rRa>Ab.rRa?1:Aa.rRa<Ab.rRa?-1:0}}Object(l.a)(H,"CoauthorPositionFinder",null,[784]);var L=c(593),J=c(355),M=c(503),P=c(75),N=c(135);class K{constructor(){this.zCa=null;this.brc=Array(32)}xor(Aa){if(!Aa)throw Error.argumentNull("Guid argument cannot be null");
const Ab=new K,nc=new Sys.StringBuilder;for(let Kc=0;Kc<Aa.brc.length;Kc++){const hd=this.brc[Kc]^Aa.brc[Kc];Ab.brc[Kc]=hd;nc.append(hd.toString(16));7!==Kc&&11!==Kc&&15!==Kc&&19!==Kc||nc.append("-")}Ab.zCa=N.a.Ff(nc.toString());return Ab}toString(){return this.zCa.toString()}equals(Aa){if(!Aa)throw Error.argumentNull("Guid argument cannot be null");return this.zCa.equals(Aa.zCa)}static q8b(Aa){if(!Aa)throw Error.argumentNull("String input cannot be null");const Ab=new K;Ab.zCa=N.a.Ff(Aa);const nc=
Ab.zCa.toString();let Kc=0;for(let Rd=0;Rd<nc.length;Rd++){var hd=Aa.charAt(Rd);if(K.HLm(hd))hd=K.Trm(hd,Aa.charCodeAt(Rd)),Ab.brc[Kc++]=hd;else if(!K.dLm(hd))throw Error.argument("String contains characters not valid in Guids");}return Ab}static HLm(Aa){return"0"<=Aa&&"9">=Aa||"A"<=Aa&&"F">=Aa||"a"<=Aa&&"f">=Aa}static dLm(Aa){return"{"===Aa||"}"===Aa||"-"===Aa}static Trm(Aa,Ab){if("0"<=Aa&&"9">=Aa)return Ab-48;if("A"<=Aa&&"F">=Aa)return Ab-65+10;if("a"<=Aa&&"f">=Aa)return Ab-97+10;throw Error.argument("Char is not valid hex digit");
}}Object(l.a)(K,"Guid",null,[]);class O{constructor(Aa,Ab,nc,Kc){this.Gfa=null;this.fQg=this.t6g=!1;this.t3g=0;this.xAc=Aa;this.KTe=Ab;this.Ga=nc;this.NYb=Kc;this.STj=m.AFrameworkApplication.MSb||m.AFrameworkApplication.Ppa;this.C4g=new L.a(J.a.jh())}get Ybf(){return this.Ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1)}init(){this.xAc.continueWith(()=>{this.Gfa=this.xAc.result;this.Gfa.h2b(Object(f.a)(this,this.xda,"onUsersUpdated"))})}xda(){this.EZk(this.Gfa.I1a())}EZk(Aa){var Ab=
0;const nc=new M.a(J.a.jh());for(const Kc of Aa)if(Kc&&Kc.isAnonymous){m.AFrameworkApplication.le("70eb6120;2gfeb930");if(nc.nb(Kc.userName))nc.J(Kc.userName).add(Kc.clientId);else{let hd;nc.add(Kc.userName,(hd=new P.a,hd.add(Kc.clientId),hd))}Kc.clientId!==this.NYb?(Ab++,2<=Ab&&!this.t6g&&this.d4m()):!this.fQg&&this.Ybf&&"Guest"===Kc.userName&&(k.ULS.sendTraceTag(509726851,302,50,"User was assigned 'Guest' name"),this.fQg=!0)}if(this.Ybf&&this.t3g!==Ab){k.ULS.sendTraceTag(512553562,302,50,"Total guests updated to: {0}",
Ab+(this.STj?1:0));this.t3g=Ab;for(let Kc of nc.keys)2<=nc.J(Kc).count&&(Aa=this.oUl(nc.J(Kc)),this.C4g.contains(Aa)||(Ab={},Ab.guestsWithSameName=nc.J(Kc).count,Ab.identifier=Aa,k.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected: {0}",Ab),this.C4g.add(Aa)))}}d4m(){k.ULS.sendTraceTag(525112603,302,50,"Multiple guests simultaneously coauthoring");this.t6g=!0;this.Ybf&&this.KTe&&this.KTe.continueWith(()=>{window.setTimeout(()=>{this.KTe.result.logActivity("MultipleGuestsCoauthoring",
null)},15E3)})}oUl(Aa){if(!Aa||1>=Aa.count)return"";let Ab=K.q8b(Aa.J(0));for(let nc=1;nc<Aa.count;nc++)Ab=Ab.xor(K.q8b(Aa.J(nc)));return Ab.toString()}}Object(l.a)(O,"GuestCoauthTelemetry",null,[]);var V=c(247);class W{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(l.a)(W,"PL",null,[]);var T=c(34);class Y{constructor(){this.ct=this.vt=this.d=0}static aij(Aa,Ab,nc){const Kc=new Y;Kc.d=Aa;Kc.vt=Ab;Kc.ct=nc;return T.c(Kc)}}Object(l.a)(Y,"VD",null,
[]);var ba=c(115);class Z{constructor(Aa,Ab,nc,Kc,hd,Rd,kc,ff,bd,Sf,Te){this.leh=!1;this._id=Aa;this.fi=Ab;this.Xfh=nc;this.ps=Kc;this.jKe=hd;this.AUe=Rd;this.Nzb=kc;this.ztb=ff;this.eXj=bd;this.Jsb=Sf;this.wjh=Te;this.Hea=Object(y.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}qoe(Aa){const Ab=[this.jKe,this.AUe];this.wjh&&Ab.push(this.Xfh);G.Task.WAA.apply(null,Ab).continueWith(()=>{if(this.jKe.result<=this.AUe.result)Aa.rS(!1);else{this.wjh&&(this.fi=this.Xfh.result);
var nc=this.ps-this.fi,Kc=new W;Kc.id=this._id;Kc.et=this.ps;Kc.st=this.fi;Kc.d=this.ps-this.fi;Kc.mp=this.jKe.result;Kc.tp=this.AUe.result;Kc.ct=this.uPl(this.eXj);Kc.vc=this.Jsb();var hd=T.c(Kc),Rd="Word"===this.Hea,kc="PowerPoint"===this.Hea;k.ULS.sendTraceTag(42078597,302,15,hd);if(Rd){const ff=new Map;ff.set("data",hd);z.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",ff)}nc>this.Nzb.value&&!this.leh&&!Kc.vc&&(this.leh=!0,Aa.rS(!0),Kc=Object.assign(new ba.a,{inStaging:!0,
extendedProperties:new Map}),Kc.extendedProperties.set("data",hd),Rd&&z.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",!1,!0,Kc),nc<this.ztb.value&&(k.ULS.sendTraceTag(42078598,302,15,Y.aij(nc,this.Nzb.value,this.ztb.value)),nc=m.AFrameworkApplication.K.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientThumbnailPresenceRenderLatencyQoSError"),kc&&nc&&z.Health.instance.recordQosError("PresenceRenderDurationIsTooLong",["PresenceExperienceDegraded"],
!1,!0,!0,!1,Kc)));Aa.task.isCompleted||Aa.rS(!1)}})}uPl(Aa){switch(Aa){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(l.a)(Z,"PresenceLatencyActivityLogger",null,[]);class ea{constructor(Aa,Ab,nc){this.CMg=this.JNg=this.Jgd=this.bhd=this.TTb=0;this._id=Aa;this.Nzb=Ab;this.ztb=nc;this.Hea=Object(y.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get Iqh(){return this.TTb}set Iqh(Aa){this.TTb=Aa;this.r6e()}get rEh(){return this.bhd}set rEh(Aa){this.bhd=
Aa;this.r6e()}get vAh(){return this.Jgd}set vAh(Aa){this.Jgd=Aa;this.r6e()}get sEh(){return 0!==this.JNg}get wAh(){return 0!==this.CMg}r6e(){!this.sEh&&this.TTb&&this.bhd&&(this.JNg=this.qoe(this.bhd,"CoauthGalleryLightupDurationTooLong"));!this.wAh&&this.TTb&&this.Jgd&&(this.CMg=this.qoe(this.Jgd,"CanvasPresenceLightupDurationTooLong"))}qoe(Aa,Ab){const nc=Aa-this.TTb;var Kc=new W;Kc.id=this._id;Kc.et=Aa;Kc.st=this.TTb;Kc.d=nc;var hd=T.c(Kc),Rd="Word"===this.Hea;Aa="PowerPoint"===this.Hea;Kc="CanvasPresenceLightupDurationTooLong"===
Ab?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===Ab?k.ULS.sendTraceTag(572289499,302,15,hd):k.ULS.sendTraceTag(571524118,302,15,hd);if(Rd){var kc=new Map;kc.set("data",hd);z.Health.instance.recordKpiUsage(Kc,0,"wordcollabrel",kc)}return nc>this.Nzb.value?(kc=Object.assign(new ba.a,{inStaging:!0,extendedProperties:new Map}),kc.extendedProperties.set("data",hd),hd=nc<this.ztb.value,kc.extendedProperties.set("cash",hd?"true":"false"),Rd&&z.Health.instance.recordKpiFailure(Kc,
Ab,!1,!0,kc),Rd=m.AFrameworkApplication.K.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientRenderLatencyQoSError"),Aa&&Rd&&z.Health.instance.recordQosError(Ab,[Kc],!1,!0,!0,!1,kc),k.ULS.sendTraceTag(572289500,302,15,Y.aij(nc,this.Nzb.value,this.ztb.value)),hd?2:1):3}}Object(l.a)(ea,"PresenceLightupLatencyLogger",null,[]);var ha=c(49),la=c(167);class ia{constructor(Aa,Ab,nc,Kc,hd,Rd,kc,ff=null,bd=null,Sf=null){this.zah={};this.vve={};this.Y1g=new P.a;this.rgd=this.lwc=this.zD=
this.fj=null;this.QSe=this.NSe=0;this.Nzb=new V.a(()=>ff.oU("PresenceBootLatencyThreshold",1E4));this.ztb=new V.a(()=>ff.oU("PresenceBootLatencyCutoffThreshold",6E4));this.Jmk=new V.a(()=>ff.oU("PresenceLightupLatencyThreshold",2E3));this.iZj=new V.a(()=>ff.oU("PresenceLightupLatencyCutoffThreshold",1E4));this.sZ=Kc;this.Ga=ff;this.Bdk=hd;this.MNg=Aa;this.Ych=Ab;this.Bcb=nc;this.Rf=Rd;this.NYb=bd;this.Jsb=kc;this.cXg=Sf;this.Ite=!1;this.init()}sMc(Aa,Ab,nc=null,Kc=0){nc&&(k.ULS.shipAssertTag(42274970,
302,!this.NYb||this.NYb===nc,"_myClientId is already set and you are trying to update it to something different"),this.NYb=nc);const hd=new x.a;this.init().continueWith(()=>{this.Mpn(Aa);this.Mtl(hd,Aa,Ab,Kc)})}get vRf(){return this.NYb||"{"+m.AFrameworkApplication.userSessionId+"}"}init(){if(this.lwc)return this.lwc.task;this.lwc=new x.a;this.Jsb()&&k.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.MNg.continueWith(()=>{const Aa=this.MNg.result,Ab=Aa.p4b,nc=Aa.icn;nc.continueWith(()=>
{Ab.continueWith(()=>{this.cXg&&this.cXg.addQosPillar("RealTimeCoauth");this.Ohg(Ab.result,nc.result);this.lwc.Ag(null)})})});this.Ych.continueWith(()=>{this.fj=this.Ych.result;this.fj.xua(Object(f.a)(this,this.arn,"onRtcConnection"));this.fj.G3(Object(f.a)(this,this.Rjn,"onCoauthorBootReceived"))});this.Bcb.continueWith(()=>{this.zD=this.Bcb.result;this.zD.h2b(Object(f.a)(this,this.g8d,"onUsersUpdatedEventListener"));0<this.zD.I1a().length&&this.xda()});return this.lwc.task}t5h(){return this.Rf.Cga(ha.a.c9a)?
this.Rf.jF(ha.a.c9a):la.a.bfb?window.performance.timing.fetchStart:-1}z$h(){this.rgd||(this.rgd=new x.a,this.sZ.lk(4,()=>{this.rgd.rS(this.Rf.jF("AppInitStatus_interactivityReady"))}));return this.rgd.task}arn(Aa,Ab){if(!this.Ite&&2===Ab.newState)if(this.Pne){const nc=this.z$h();nc.continueWith(()=>{var Kc=nc.result;Kc=Date.now()-Kc;const hd={};hd.clientId=this.vRf;hd.bootTime=Kc;this.Ite=!0;this.fj.pN(15,hd)})}else Aa=this.t5h(),Aa=Date.now()-Aa,Ab={},Ab.clientId=this.vRf,Ab.bootTime=Aa,this.Ite=
!0,this.fj.pN(15,Ab)}Rjn(Aa,Ab){if(15===Ab.type){Aa=Date.now();Ab=Ab.LL;var nc=Ab.bootTime;this.Gqf(Ab.clientId).Iqh=Aa-nc}}g8d(){this.xda()}xda(){const Aa=Date.now();var Ab=this.zD.I1a();const nc=new P.a;for(const Kc of Ab)this.Y1g.contains(Kc.clientId)||(this.Y1g.add(Kc.clientId),nc.add(Kc.clientId));if(0<nc.count)for(let Kc of nc)Ab=this.Gqf(Kc),Ab.sEh||(Ab.rEh=Aa)}Mpn(Aa){Aa=this.Gqf(Aa);Aa.wAh||(Aa.vAh=Date.now())}Gqf(Aa){return Aa in this.vve?this.vve[Aa]:this.vve[Aa]=new ea(Aa,this.Jmk,this.iZj)}Ohg(Aa,
Ab=0){this.NSe=Aa;this.QSe=Ab?Ab:(new Date).getTime()}Mtl(Aa,Ab,nc,Kc){nc=nc?nc.getTime():(new Date).getTime();if(Ab in this.zah)Aa.mka();else{const hd=this.Pne?0:this.Ucm(),Rd=this.Pne?this.Vcm():null;Kc=new Z(Ab,hd,Rd,nc,this.SSd(this.vRf),this.SSd(Ab),this.Nzb,this.ztb,Kc,this.Jsb,this.Pne);this.zah[Ab]=Kc;Kc.qoe(Aa)}}Ucm(){return 1===this.NSe?this.QSe:this.t5h()}Vcm(){return 1===this.NSe?G.Task.o4(this.QSe):this.z$h()}SSd(Aa){return this.Bdk.SSd(Aa)}get Pne(){return this.Ga.$("UseAppInteractiveBootTimeForPresenceTelemetry")}}
Object(l.a)(ia,"PresenceBootTelemetry",null,[783]);var sa=c(131),Oa=c(181),Ra=c(234),Na=c(22),Da=c(633);class ra{get name(){return"Common.App.CoauthTelemetry"}wc(Aa){Aa.register(a,"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").ha().Sd(()=>new a(Da.a.Bp(Aa.Ta("Common.IPeopleInfoProvider")),m.AFrameworkApplication.Kg));Aa.register(F,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").ha().Sd(()=>new F(m.AFrameworkApplication.va,
Da.a.Bp(Aa.Ta("Common.ICoauthoringTelemeryInfoProvider")),m.AFrameworkApplication.K,sa.a.get_instance(),Ra.a.instance,Da.a.Bp(Aa.Ta("Common.IPeoplesWell")),Da.a.Bp(Aa.Ta("Common.IPeopleInfoProvider")),a.L1e,()=>this.lxh()));Aa.register(ia,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").ha().Sd(()=>new ia(Da.a.Bp(Aa.Ta("Common.ICoauthoringTelemeryInfoProvider")),Da.a.Bp(Aa.Ta("Common.IRealtimeChannelBasic")),Da.a.Bp(Aa.Ta("Common.IPeopleInfoProvider")),
sa.a.get_instance(),Aa.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),Ra.a.instance,()=>this.lxh(),m.AFrameworkApplication.K,null,z.Health.instance));Aa.register(H,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").ha().Sd(()=>new H(Da.a.Bp(Aa.Ta("Common.IPeopleInfoProvider"))));Aa.register(O,"Common.App.CoauthTelemetry.GuestCoauthTelemetry").ha().Sd(()=>new O(Da.a.Bp(Aa.Ta("Common.IPeopleInfoProvider")),Da.a.Bp(Aa.Ta("Common.ISystemInitiatedFeedback")),
m.AFrameworkApplication.K,"{"+m.AFrameworkApplication.userSessionId+"}"))}init(){m.AFrameworkApplication.K.Hn(()=>{Na.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();Na.a.instance.resolve("Common.App.CoauthTelemetry.GuestCoauthTelemetry").init();m.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&Na.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();m.AFrameworkApplication.K.$("CashTelemetryIsEnabled")&&(Na.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),
Na.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}lxh(){return la.a.bfb&&Ra.a.instance.Cga(ha.a.bdd)?0<Ra.a.instance.jF(ha.a.bdd)[ha.a.AIj]:!1}static main(){Oa.a.instance.Gc(new ra)}}Object(l.a)(ra,"CoauthTelemetryPackage",null,[1,2]);class xa extends Sys.EventArgs{constructor(){super()}}Object(l.a)(xa,"RtcHostNotificationEventArgs",Sys.EventArgs,[]);var fa;(function(Aa){Aa[Aa.notYetStarted=0]="notYetStarted";Aa[Aa.polling=1]="polling";Aa[Aa.subscribed=2]="subscribed";
Aa[Aa.blocked=3]="blocked";Aa[Aa.permanentlyStopped=4]="permanentlyStopped"})(fa||(fa={}));Object(l.b)("RtcHostNotificationSubscriptionState",fa);var oa=c(92),ta=c(1419),Ka=c(80);class va{constructor(Aa,Ab,nc,Kc,hd,Rd,kc,ff,bd){this.Mh=!1;this.aba=this.NZb=this.Ufa=this.LYa=null;this.gDc=va.pre;this.sa=new Ka.a;this.zdb=new ta.a(0);this.zdb.q_e(Object(f.a)(this,this.fsn,"onStateMachineChanged"));this.jgk=Aa;this.cvd=Ab;this.igk=nc;this.fQe=Kc;this.Ib=hd;this.kf=Rd;kc.execute(Sf=>{this.Mh||(this.NZb=
Sf,this.NZb.G3(Object(f.a)(this,this.b1,"onUpdateNotificationReceived")),this.start())});ff.execute(Sf=>{this.Mh||(this.aba=Sf,Sf.ZZa(Object(f.a)(this,this.Ria,"onTokenRefreshed")))});this.cyd=bd}get amc(){return this.zdb.currentState}get dBi(){return!this.kf||this.kf.Lxa}get yBi(){return 2===this.amc&&this.cyd()<this.gDc}start(){0!==this.amc?k.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",fa[this.amc]):(this.zdb.event(1),this.Uag(null))}Uag(){this.LYa=
null;if(this.dBi){k.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",fa[this.amc]);let Aa=null;this.fQe&&this.fQe.length&&(Aa={},Aa.etts=this.fQe);this.NZb.pN(14,Aa,!0);this.Tfj(this.jgk)}else this.zdb.event(3)}Tfj(Aa){this.LYa=oa.a.r8(1E3*Aa,Object(f.a)(this,this.Uag,"sendSubscribeEvent"),this.cvd,192,"RtcHostNotificationSubscribe");this.Ib.Xb(this.LYa)}M9n(Aa){Aa=1E3*(Aa+this.igk);const Ab=this.cyd().getTime()+Aa;this.gDc=new Date(Ab);Aa-=this.cvd;
this.Ufa?this.Ib.o1(this.Ufa,Aa):(this.Ufa=oa.a.r8(Aa,Object(f.a)(this,this.SKo,"transitionToPollingEvent"),this.cvd/2,194,"RtcHostNotificationTransitionToPolling"),this.Ib.Xb(this.Ufa))}SKo(){this.Ufa=null;2===this.amc&&(this.zdb.event(1),k.ULS.shipAssertTag(573100185,502,!!this.LYa,"Missing task to ensure that we re-subscribe."))}Ria(){this.Elm()}Elm(){3===this.amc&&this.dBi&&(this.zdb.event(this.yBi?2:1),this.Uag(null))}b1(Aa,Ab){if(13===Ab.type&&(Aa=Ab.LL,k.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",
{["SerializableHostNotificationSubscription"]:Aa,["DurationBeforeExpirationToResubscribeInSec"]:this.cvd}),Ab=Aa.cts,!this.CNo(Ab))){if(Aa.sb){var nc=2;this.M9n(Aa.cts)}else nc=1,this.gDc=va.pre,this.Ufa&&(this.Ib.Ze(this.Ufa),this.Ufa=null);this.zdb.event(nc);this.LYa?this.Ib.o1(this.LYa,1E3*Ab):this.Tfj(Ab)}}CNo(Aa){if(!isNaN(Aa)&&isFinite(Aa)&&0<Aa)return!1;this.quj(!1);return!0}quj(Aa){this.LYa&&(this.Ib.Ze(this.LYa),this.LYa=null);this.Ufa&&(this.Ib.Ze(this.Ufa),this.Ufa=null);this.NZb&&(this.NZb.BOb(Object(f.a)(this,
this.b1,"onUpdateNotificationReceived")),this.NZb=null);this.aba&&(this.aba.zOb(Object(f.a)(this,this.Ria,"onTokenRefreshed")),this.aba=null);Aa||this.zdb.event(4)}fsn(Aa,Ab){Aa=Ab.newState;const nc=Ab.j1f,Kc={};Kc.NewState=fa[Aa];Kc.PreviousState=fa[nc];Kc.PreviousStateHits=Ab.k1f;Kc.PreviousStateTransitionTime=Ab.l1f.toISOString();Kc.IsSubscribed=this.yBi;this.gDc!==va.pre&&(Kc.SubscriptionExpiringTime=this.gDc.toISOString());k.ULS.sendTraceTag(572346515,502,4===Aa?15:50,"HostNotificationChanged: {0}",
Kc);this.sa.raiseEvent("HN",new xa(nc,Aa))}dispose(){this.Mh||(this.Mh=!0,this.quj(!0),this.Ufa&&(this.Ib.Ze(this.Ufa),this.Ufa=null))}}va.pre=new Date(0);Object(l.a)(va,"RtcHostNotificationSubscriptionManager",null,[781,10]);var La=c(397);class za{constructor(){this.Xh=this.Mh=!1}get name(){return"RtcHostNotificationSubscription"}wc(Aa){Aa.register(va,"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").ha().Sd(()=>
{const Ab=m.AFrameworkApplication.K;return new va(Ab.lc("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),Ab.lc("RtcHostNotificationRetryIntervalBufferInSeconds",120),Ab.lc("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.Gam(Ab),m.AFrameworkApplication.oc,La.SessionStatusManager.instance,Aa.Ta("Common.IRealtimeChannelBasic"),Aa.Ta("Common.ISessionExpirationManager"),()=>new Date)})}init(){m.AFrameworkApplication.K.Hn(()=>{!this.Mh&&m.AFrameworkApplication.K.$("RtcHostNotificationEnabled")&&
(this.Xh=!0,Na.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.Mh||(this.Mh=!0,this.Xh&&Na.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}Gam(Aa){return Aa.ow("RtcEventTypesToSubscribe")?Aa.BB("RtcEventTypesToSubscribe"):null}static main(){Oa.a.instance.Gc(new za)}}Object(l.a)(za,"RtcHostNotificationSubscriptionPackage",null,[1,2]);var Ca=c(470),ua=c(646);
class ib{constructor(Aa,Ab,nc,Kc,hd,Rd,kc,ff,bd,Sf,Te){this.clientId=Aa;this.SkypeChatThreadId=nc;this.chatThreadDiscoveryUri=Kc;this.inChat=hd;this.localColbaltSessionId=Ab;this.capabilities=Rd;this.email=kc;this.isReadOnly=ff;this.userName=bd;this.isAnonymous=Sf;this.presenceStatus=Te}}Object(l.a)(ib,"SerializablePresenceUserData",null,[]);class bb extends Ca.a{constructor(Aa,Ab,nc,Kc,hd=null,Rd=null,kc=null,ff=null,bd=null,Sf=!1,Te=!1,bi=!1,Si=null){super(Aa,Ab,nc,Kc,Rd,kc,ff,bd,Sf,Te,bi);this.wP=
hd;this.presenceStatus=Si}getData(){return new ib(this.clientId,this.wP,this.BHc,this.chatThreadDiscoveryUri,this.inChat,this.capabilities.capabilities,this.email,this.isReadOnly,this.userName,this.isAnonymous,this.presenceStatus)}TSd(Aa){return(Aa=Aa.value)?Aa.user:null}clone(){return new bb(this.clientId,this.userName,this.color,this.capabilities.clone(),this.wP,this.BHc,this.email,this.client,this.chatThreadDiscoveryUri,this.isAnonymous,this.inChat,this.isReadOnly,this.presenceStatus)}static BCb(Aa){return Aa.clientId?
new bb(Aa.clientId,Aa.userName,null,new ua.a(void 0===Aa.capabilities?0:Aa.capabilities),Aa.localColbaltSessionId,Aa.SkypeChatThreadId,Aa.email,null,Aa.chatThreadDiscoveryUri,Aa.isAnonymous,Aa.inChat,Aa.isReadOnly,Aa.presenceStatus):null}static DKh(Aa,Ab,nc,Kc=null,hd=null,Rd=null,kc=null,ff=null,bd=!1,Sf=!1,Te=!1,bi=null){return Aa?new bb(Aa,Ab,null,new ua.a(void 0===nc?0:nc),Kc,hd,Rd,kc,ff,Te,bd,Sf,bi):null}}Object(l.a)(bb,"PresenceUser",Ca.a,[1196,1197,25]);class mb extends bb{constructor(){super();
this.Lhc=this.nLf=null}q3l(){const Aa=m.AFrameworkApplication.userName,Ab=m.AFrameworkApplication.K.kb("UserPrincipalName"),nc=this.nLf?this.nLf.wP:null,Kc=m.AFrameworkApplication.MSb||m.AFrameworkApplication.Ppa,hd=this.Lhc?this.Lhc.getStatus():null;return new bb(this.clientId,Aa,this.color,this.capabilities,nc,this.BHc,Ab,this.client,this.chatThreadDiscoveryUri,Kc,this.inChat,this.isReadOnly,hd)}}Object(l.a)(mb,"MyPresenceUser",bb,[1252,25]);var yb=c(218);class ab{constructor(Aa,Ab,nc,Kc,hd){this.Sf=
Aa;this._clientId=Ab;this.k_j=hd;this.e3j=nc||(()=>null);this.f3j=Kc||(()=>null)}get id(){return this.Sf.id}get Zzd(){return this.Sf.Zzd}get cAd(){return this.Sf.cAd}get bAd(){return this.Sf.bAd}get aAd(){return this.Sf.aAd}get $zd(){return this.Sf.$zd}get eAd(){return this.Sf.eAd}get PXe(){return this.Sf.PXe}get Clc(){return this.Sf.Clc}get Rie(){return this.Sf.Rie}get G4d(){return this.Sf.G4d}get clientId(){return this._clientId}get rRc(){return this.e3j}get bjb(){return this.f3j}get Qnl(){return this.k_j}static createInstance(Aa,
Ab,nc,Kc,hd=!1){return new ab(Aa,Ab,nc,Kc,hd)}}Object(l.a)(ab,"PeoplesWellSettings",null,[]);var Ga=c(9),Za=c(67),Ub=c(173),Xb=c(107),zb=c(207),Ib=c(162),$a=c(399),Hb=c(336);class Ya extends zb.a{constructor(){super();this.JoinTimeInMS=0;this.IsAnonymous=!1;this.ImageUrl=null;this.CanJump=this.ActiveStatus=!1;this.Upn=null}get ControlType(){return 5}}Object(l.a)(Ya,"PeopleButtonProps",zb.a,[]);var Sa=c(412),Eb=c(416),Jb=c(19),vb=c(82);class ac{constructor(Aa){this.cdd=new vb.a;this.Xbf=null;this.clientId=
Aa}Amo(Aa){this.NWn();this.Veo(Aa);for(const Ab of Aa)Ab.clientId!==this.clientId&&this.Joh(Ab)}get Bpg(){const Aa=[];for(let Ab of this.cdd.values){const nc=this.Lgj(Ab);Array.add(Aa,nc)}return Aa}get Omb(){return this.cdd.count}GZe(Aa,Ab){Aa=Aa.toUpperCase();let nc;({value:nc}=this.cdd.Fc(Aa)).returnValue||(nc=[],this.cdd.Z(Aa,nc));Array.add(nc,Ab)}NWn(){this.cdd=new vb.a}Veo(Aa){for(const Ab of Aa)if(Ab.clientId===this.clientId){this.Xbf=Ab;break}}}Object(l.a)(ac,"UserTracker",null,[992]);class dc extends ac{constructor(Aa,
Ab){super(Aa);this.g3j=Ab}Joh(Aa){Aa.isAnonymous||!Aa.email?this.GZe(Aa.clientId,Aa):this.Xbf&&J.a.jh().equals(this.Xbf.email,Aa.email)||this.GZe(Aa.email,Aa)}Lgj(Aa){let Ab=new Date(0),nc=0<Aa.length?Aa[0]:null;for(const Kc of Aa)(Aa=this.g3j(Kc.clientId))&&Ab.getTime()<Aa.hec.getTime()&&(Ab=Aa.hec,nc=Kc);return nc}}Object(l.a)(dc,"UniqueUserTracker",ac,[]);class Cc extends ac{constructor(Aa){super(Aa)}Joh(Aa){this.GZe(Aa.clientId,Aa)}Lgj(Aa){return Aa[0]}}Object(l.a)(Cc,"UserInstanceTracker",ac,
[]);const Ec=(Aa,Ab,nc)=>nc?new dc(Aa,Ab):new Cc(Aa);var rc=c(70),hb=c(606),fb=c(13);class Nb{constructor(Aa,Ab=null,nc=null){this.zD=null;this.JUe=new x.a;this.Sf=Aa;this.K9d=Ab;nc&&nc.continueWith(()=>{this.zD=nc.result;this.zD.h2b(Object(f.a)(this,this.xda,"onUsersUpdated"));this.gce()});new Ca.a(this.settings.clientId,"Anonymous user","#cccccc",new ua.a(7));this.jZd=this.AGe=!0;this.qCe=this.jNe=!1;this.cAa=Ec(this.settings.clientId,this.settings.bjb,Aa.Qnl)}get settings(){return this.Sf}get lHm(){return m.AFrameworkApplication.K?
m.AFrameworkApplication.K.$("ColorPresenceHashIsEnabled"):!1}get zui(){return m.AFrameworkApplication.K?m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"):!1}sRl(){let Aa;let Ab,nc,Kc,hd;var Rd=this.tRl();this.cAa.Omb?1===this.cAa.Omb?(Ab=!0,nc=this.settings.Clc.cluster,Kc=this.settings.Clc.MId,hd=this.cAa.Bpg[0].color):(Ab=!0,nc=this.settings.G4d.cluster,Kc=this.settings.G4d.MId,hd=""):(Ab=!1,hd=Kc=nc="");Aa=Rd[0];Rd=Rd.slice(1);return{tvn:Aa,uvn:Rd,pvn:Ab,imp:nc,rvn:Kc,qvn:hd}}tRl(){if(2<=
this.cAa.Omb)return[String.format(CommonUIStrings.l_PeoplesWellStateNumberOfOtherPeopleEditingHere,this.cAa.Omb)];if(1===this.cAa.Omb){const Aa=this.cAa.Bpg[0],Ab=this.settings.bjb(Aa.clientId);return Ab&&2===Ab.status?[CommonUIStrings.l_PeoplesWellStateUserIsInactive,Aa.userName]:[Aa.isReadOnly?CommonUIStrings.l_PeoplesWellStateUserIsAlsoViewing:CommonUIStrings.l_PeoplesWellStateUserIsAlsoEditing,Aa.userName]}return[CommonUIStrings.l_PeoplesWellStateYouAreAllByYourself]}Lhm(Aa){return this.Mhm(Aa)}Yzh(Aa,
Ab,nc){return Ab?this.fRk(Ab)?(Aa=this.settings.bjb(Aa))&&2===Aa.status?!1:!0:(nc&&k.ULS.sendTraceTag(4482394,325,50,"User has presence data but app can't use it"),!1):(nc&&k.ULS.sendTraceTag(4482393,325,50,"User does not have any presence data"),!1)}bdm(Aa){return Aa.isReadOnly?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOffline:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}Mhm(Aa){if(!Aa.capabilities.qFa(1))return this.bdm(Aa);const Ab=Aa.isReadOnly,nc=this.settings.bjb(Aa.clientId);
Aa=this.settings.rRc(Aa.clientId);if(!nc)return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;switch(nc.status){case 1:return Aa?Ab?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOnline:this.M5k(Aa)||CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;case 2:return CommonUIStrings.l_PeoplesWellUserStatusIsInactive;default:return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}}DZl(Aa){if(this.K9d.ZXc)return this.K9d.RCb(Aa.email,
"O365",m.AFrameworkApplication.km,0)}whm(Aa){Aa=this.settings.bjb(Aa.clientId);return!Aa||Aa&&1===Aa.status?!0:!1}zhm(Aa){var Ab=String.format("buttonPeoplesWellUser-{0}",Aa.clientId),nc=Aa.clientId,Kc=this.Lhm(Aa);const hd=Aa.userName,Rd=Aa.color;var kc=Object,ff=kc.assign,bd=new Ya,Sf=this.settings.eAd.toString(),Te=this.settings.Rie.cluster,bi=this.settings.Rie.MId,Si=this.u7h(),li=Aa.isAnonymous,yi;if(yi=[hd],yi.length){var lm=new Sys.StringBuilder("STRARRY@");for(const bh of yi)lm.append(bh?
bh.length:0),lm.append(","),lm.append(bh),lm.append(",");yi=lm.toString().slice(0,-1)}else yi=null;Ab=ff.call(kc,bd,{Id:Ab,Command:Sf,LabelText:"{0}",Image32by32:Te,Image32by32Class:bi,MenuItemId:nc,CommandValueId:nc,Alt:hd,DisplayMode:Si,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word",Description:Kc,ImageBackColor:Rd,IsAnonymous:li,LabelTextUserGeneratedPlaceholderReplacements:yi,Upn:Aa.email});m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
this.K9d&&(nc=this.DZl(Aa),Kc=this.whm(Aa),Ab.ImageUrl=nc,Ab.ActiveStatus=Kc,Ab.JoinTimeInMS=Aa.rRa,Aa=this.Yzh(Aa.clientId,this.settings.rRc(Aa.clientId),!1),Ab.CanJump=Aa,""===nc&&k.ULS.sendTraceTag(40969413,302,50,"ImageURL collection failed"));return Ab}QXl(){return Object.assign(new zb.a,{Id:"BasicChat",Command:"2288458806",LabelText:CommonUIStrings.l_StartGroupChat,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word"})}u7h(){return this.lHm?"Initials":
"Menu32"}Ahm(Aa){const Ab=[];for(const nc of Aa)Aa=this.zhm(nc),Array.add(Ab,Aa);return Ab}IYd(){return 0<this.cAa.Omb}AKn(Aa){if(!this.AGe)return!0;this.jZd||(Aa[hb.a.Visible]=!0);let Ab,nc,Kc,hd,Rd;({tvn:Ab,uvn:nc,pvn:Kc,rvn:hd,qvn:Rd}=this.sRl());Aa[hb.a.LabelText]=Ab;nc&&nc.length&&(Aa[hb.a.LabelTextUserGeneratedPlaceholderReplacements]=nc);Aa[hb.a.ImageIsVisible]=Kc;Aa[hb.a.Image16by16Class]=hd;Aa[hb.a.ImageBackColor]=Rd;this.AGe=!1;return!0}VBn(Aa){if(0>=this.cAa.Omb)return!1;var Ab=this.Mxo(this.cAa.Bpg),
nc=this.Ahm(Ab);Ab=Object.assign(new $a.a,{Id:"menuCoauthors",MaxWidth:"220px",MenuSectionList:[]});nc=Object.assign(new Hb.a,{Id:"msCoauthors",ControlsId:"msCoauthorsControls",DisplayMode:this.u7h(),ControlList:nc});m.AFrameworkApplication.K.$("WordEditorDisplayPeoplesWellLabelIsEnabled")&&this.K9d&&(nc.Title=CommonUIStrings.l_PeoplesWellFlyoutLabel,nc.TitleId="menuCoauthorsTitle",nc.Theme="Light");Array.add(Ab.MenuSectionList,nc);m.AFrameworkApplication.K.$("DocChatIsEnabled")&&m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
m.AFrameworkApplication.ua&&m.AFrameworkApplication.ua.Lb.Er&&(nc=[],Array.add(nc,this.QXl()),nc=Object.assign(new Hb.a,{Id:"msGroupChat",ControlsId:"msGroupChatControl",ControlList:nc}),Array.add(Ab.MenuSectionList,nc));m.AFrameworkApplication.ua&&m.AFrameworkApplication.ua.Lb.Er?Aa.MenuItems=Ab:Aa.PopulationXML=Ib.o(Ab);return!0}ypg(Aa){k.ULS.sendTraceTag(4482395,325,50,"PeoplesWell: Received user button click");Aa=Aa.MenuItemId;if(!Aa)return!1;const Ab=this.settings.rRc(Aa);if(!this.Yzh(Aa,Ab,
!0))return!1;this.rWm(Ab);return!0}xRn(){const Aa=this.zLl();this.cAa.Amo(Aa);this.jZd&&1<=this.cAa.Omb&&(k.ULS.sendTraceTag(6092429,325,50,"PeoplesWell: User is no longer forever alone."),this.jZd=!1);this.AGe=!0}xda(){this.qCe||(window.setTimeout(()=>{this.gce();this.qCe=!1},3E3),this.qCe=!0)}zLl(){let Aa;Aa=this.yLl()||[];for(const Ab of Aa)this.r8n(Ab);return Aa}r8n(Aa){Aa.clientId||(Aa.clientId=N.a.create().toString());Aa.userName||(Aa.userName="Anonymous user");Aa.capabilities||(Aa.capabilities=
new ua.a);Aa.color||(Aa.color="#cccccc");Aa.rRa||(Aa.rRa=0)}Mxo(Aa){const Ab=[];Array.addRange(Ab,Aa);Ab.sort(Nb.dvn);return Ab}RUn(){m.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&!this.jNe&&(m.AFrameworkApplication.va.e0(fb.a.DEh)&&Sa.a.isSharedUxGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DoNotRegisterCoauthorsRenderedMultiplTimes")||m.AFrameworkApplication.va.fb(fb.a.DEh,rc.a.frame,Object(f.a)(this,this.Sjn,"onCoauthorGalleryFirstRender"),96));this.SUn();this.jNe=
!0;this.gce()}Sjn(Aa,Ab,nc,Kc,hd){this.JUe.rS(hd.RenderTime);return 32}get Kxj(){return this.JUe.task}gce(){if(!this.jNe&&(this.JUe.rS((new Date).getTime()),k.ULS.sendTraceTag(42567504,325,50,"We are trying to render the coauthor gallery before we are ready to record the render time"),this.zui))return;this.xRn();this.zui&&this.jZd?m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||Eb.a.Nfc("ribbon","coauthorGallery"):
(m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(Eb.a.fqa("ribbon","coauthorGallery"),Eb.a.eSa("ribbon","coauthorGallery")),this.yRn())}dispose(){this.zD&&(this.zD.A7f(Object(f.a)(this,this.xda,"onUsersUpdated")),this.zD=null)}static dvn(Aa,Ab){return Aa.capabilities.qFa(1)&&Ab.capabilities.qFa(1)||!Aa.capabilities.qFa(1)&&!Ab.capabilities.qFa(1)?Jb.a.localeCompare(Aa.userName,Ab.userName):Aa.capabilities.qFa(1)?
-1:1}}Object(l.a)(Nb,"APeoplesWell",null,[927,10]);var Fb=c(12);const nb=()=>!0;class pb extends Nb{constructor(Aa,Ab,nc=null,Kc=null){super(Aa,nc,Kc);this.$Hm=(hd,Rd,kc,ff,bd)=>this.N2a(kc,bd,()=>this.IYd(),nb);this.BKn=(hd,Rd,kc,ff,bd)=>this.N2a(kc,bd,Sf=>this.AKn(Sf),nb);this.WBn=(hd,Rd,kc,ff,bd)=>this.N2a(kc,bd,nb,Sf=>this.VBn(Sf));this.t_k=(hd,Rd,kc,ff,bd)=>this.N2a(kc,bd,nb,nb);this.s_k=(hd,Rd,kc,ff,bd)=>this.N2a(kc,bd,nb,nb);this.zZo=(hd,Rd,kc,ff,bd)=>this.N2a(kc,bd,nb,Sf=>this.ypg(Sf));this.Mzn=
(hd,Rd,kc,ff,bd)=>this.N2a(kc,bd,nb,()=>{this.gce();return!0});this.ga=Ab}N2a(Aa,Ab,nc,Kc){let hd=!1;switch(Aa){case 1:hd=nc(Ab);break;case 2:hd=Kc(Ab)}return hd?32:8}SUn(){this.ga.ra(this.settings.Zzd,Fb.a.application,this.$Hm);this.ga.fb(this.settings.cAd,Fb.a.application,this.BKn,96);this.ga.fb(this.settings.aAd,Fb.a.application,this.t_k,96);this.ga.fb(this.settings.$zd,Fb.a.application,this.s_k,96);this.ga.fb(this.settings.bAd,Fb.a.application,this.WBn,96);this.ga.ra(this.settings.eAd,Fb.a.application,
this.zZo);this.ga.fb(this.settings.PXe,Fb.a.application,this.Mzn,96)}}Object(l.a)(pb,"ABox4PeoplesWell",Nb,[]);var Xa=c(3),Pb=c(48),Va=c(8),tb=c(26),cb=c(166);class Mb{static isSupported(Aa){for(let Ab=0;Ab<Mb.svj.length;Ab++)if(Aa===Mb.svj[Ab])return!0;return!1}}Mb.svj=[1];Object(l.a)(Mb,"RTTDataVersion",null,[]);var mc=c(1639);const Cb=Aa=>{if("number"!==typeof Aa.RK||"number"!==typeof Aa.DK)return!1;let Ab,nc=!1,Kc=!1,hd=!1;switch(Aa.RK){case 0:Kc=Ab=!0;break;case 1:hd=nc=Kc=Ab=!0;break;case 2:if(null!=
Aa.PE&&"number"!==typeof Aa.PE)return!1;Ab=!0;break;case 4:Ab=!0;break;case 3:Kc=Ab=!0;break;case 5:nc=Ab=!0;break;default:return!1}return Ab&&("number"!==typeof Aa.PS||"number"!==typeof Aa.TS)||Kc&&("object"!==typeof Aa.OS||!Aa.OS||!mc.validateVersionedCpData(Aa.OS))||nc&&("number"!==typeof Aa.PE||"number"!==typeof Aa.TE)||hd&&("object"!==typeof Aa.OE||!Aa.OE||!mc.validateVersionedCpData(Aa.OE))?!1:!0},Ja=Aa=>{let Ab="";if("number"!==typeof Aa.I)return{returnValue:!1,Wha:"Invalid PacketId Type"};
if("number"!==typeof Aa.O)return{returnValue:!1,Wha:"Invalid Operation Type"};if("string"!==typeof Aa.A)return{returnValue:!1,Wha:"Invalid ClientId Type"};if("object"!==typeof Aa.AN)return{returnValue:!1,Wha:"Invalid Anchor Object Type"};if(!Aa.AN)return{returnValue:!1,Wha:"Null AnchorObject"};if(!Cb(Aa.AN)){let nc;try{nc=T.c(Aa.AN)}catch(Kc){nc=String.format("Failed to JSON-serialize payload : {0}",Kc)}8E3<nc.length&&(nc=String.format("Payload exceeds maximum length: {0} > {1}, not logging",nc.length,
8E3));Ab="Invalid AnchorObject: "+nc+", Client: "+Aa.C;return{returnValue:!1,Wha:Ab}}return!Aa.O&&Aa.AN.RK?(Ab="Invalid RangeKind:"+Aa.AN.RK+" for Caret",{returnValue:!1,Wha:Ab}):2===Aa.O&&("number"!==typeof Aa.TF||"undefined"!==typeof Aa.TX&&"string"!==typeof Aa.TX||1!==Aa.AN.RK&&Aa.AN.RK)?{returnValue:!1,Wha:"Invalid TypingData"}:3!==Aa.O||"object"===typeof Aa.AP&&Aa.AP&&"number"===typeof Aa.AP.TFA&&"number"===typeof Aa.AP.PN&&"number"===typeof Aa.AP.TN&&2===Aa.AN.RK?6!==Aa.O||"object"===typeof Aa.MP&&
Aa.MP&&"number"===typeof Aa.MP.PM&&"number"===typeof Aa.MP.TM&&5===Aa.AN.RK?4!==Aa.O||"object"===typeof Aa.SP&&Aa.SP&&"number"===typeof Aa.SP.PA&&"number"===typeof Aa.SP.TA&&"number"===typeof Aa.SP.PB&&"number"===typeof Aa.SP.TBS&&3===Aa.AN.RK&&(Aa.AN.PS===Aa.SP.PA||Aa.AN.PS===Aa.SP.PB)?7!==Aa.O||"object"===typeof Aa.SPS&&Aa.SPS&&"string"===typeof Aa.SPS.SF&&"boolean"===typeof Aa.SPS.SL?null!=Aa.ISS&&"number"!==typeof Aa.ISS?{returnValue:!1,Wha:"invalid StrictlySequentialId"}:{returnValue:!0,Wha:Ab}:
{returnValue:!1,Wha:"Invalid SymbolData"}:{returnValue:!1,Wha:"Invalid SplitParaData"}:{returnValue:!1,Wha:"Invalid RemoveParaData"}:{returnValue:!1,Wha:"Invalid AddParaData"}};var Wa=c(1609);class xb{constructor(Aa,Ab=null,nc=null){this.K1=this.gZf=this.Ekg=null;null!=Aa&&(this.Ekg=Aa);null!=Ab&&(this.gZf=Ab);null!=nc&&(this.K1=nc)}}Object(l.a)(xb,"AddParaData",null,[]);class ic{constructor(Aa=null,Ab=null){this.Lmc=this.fZf=null;null!=Aa&&(this.fZf=Aa);null!=Ab&&(this.Lmc=Ab)}}Object(l.a)(ic,"MergeRemoveParaData",
null,[]);class qc{constructor(Aa,Ab,nc,Kc,hd,Rd,kc=null,ff=null,bd=null,Sf=null,Te=null,bi=null,Si=0,li=null){this.pad=this.text=this.wRb=this.PQb=this.L_c=this.T1b=this.yka=null;this.packetId=Aa;this.client=nc;this.jt=Kc;this.clientId=Ab.toLowerCase();this.zT=hd;this.version=Si;Rd&&(this.yka=Rd);null!=kc&&(this.wRb=kc);void 0!==ff&&null!==ff&&(this.text=ff);bd&&(this.T1b=bd);Sf&&(this.L_c=Sf);Te&&(this.PQb=Te);bi&&(this.pad=bi);this.strictlySequentialId=li}}Object(l.a)(qc,"RTTData",null,[]);class Lc{constructor(Aa=
null,Ab=null,nc=null,Kc=null){this.Dkg=this.eZf=this.Akg=this.dZf=null;null!=Aa&&(this.dZf=Aa);null!=Ab&&(this.Akg=Ab);null!=nc&&(this.eZf=nc);null!=Kc&&(this.Dkg=Kc)}}Object(l.a)(Lc,"SplitParaData",null,[]);class Ac{constructor(Aa=null,Ab=null){this.ejg=this.djg=null;Aa&&(this.djg=Aa);null!=Ab&&(this.ejg=Ab)}}Object(l.a)(Ac,"SymbolData",null,[]);class gd{constructor(Aa,Ab=null,nc=null){null!=Aa&&(this.TFA=Aa);null!=Ab&&(this.PN=Ab);null!=nc&&(this.TN=nc)}}Object(l.a)(gd,"SerializableAddParaDataV1",
null,[]);class Md{constructor(Aa=null,Ab=null){null!=Aa&&(this.PM=Aa);null!=Ab&&(this.TM=Ab)}}Object(l.a)(Md,"SerializableMergeRemoveParaDataV1",null,[]);class ie{}Object(l.a)(ie,"SerializableRTTDataV1",null,[]);class hf{constructor(Aa=null,Ab=null,nc=null,Kc=null){null!=Aa&&(this.PA=Aa);null!=Ab&&(this.TA=Ab);null!=nc&&(this.PB=nc);null!=Kc&&(this.TBS=Kc)}}Object(l.a)(hf,"SerializableSplitParaDataV1",null,[]);class Ue{constructor(Aa=null,Ab=null){Aa&&(this.SF=Aa);null!=Ab&&(this.SL=Ab)}}Object(l.a)(Ue,
"SerializableSymbolDataV1",null,[]);const Kd=Aa=>{var Ab;if(!({Wha:Ab}=Ja(Aa)).returnValue)return k.ULS.sendTraceTag(9188759,302,15,"Failed to parse RTT packet, InvalidFieldInfo {0}",Ab),null;let nc=Ab=null,Kc=null,hd=null,Rd=null,kc=null,ff=null,bd=null;Aa.WD&&(Ab=Aa.WD);null!=Aa.TF&&(nc=Aa.TF);void 0!==Aa.TX&&null!==Aa.TX&&(Kc=Aa.TX);Aa.AP&&(hd=new xb(Aa.AP.TFA,Aa.AP.PN,Aa.AP.TN));Aa.MP&&(Rd=new ic(Aa.MP.PM,Aa.MP.TM));Aa.SP&&(kc=new Lc(Aa.SP.PA,Aa.SP.TA,Aa.SP.PB,Aa.SP.TBS));Aa.SPS&&(ff=new Ac(Aa.SPS.SF,
Aa.SPS.SL));null!=Aa.ISS&&(bd=Aa.ISS);return new qc(Aa.I,Aa.A,Aa.C,Aa.O,Wa.a(Aa.AN),Ab,nc,Kc,hd,Rd,kc,ff,1,bd)},Wc=Aa=>{let Ab=Aa;if("number"===typeof Ab.V){if(1===Ab.V)return Kd(Aa);k.ULS.sendTraceTag(9188758,302,15,"Unsupported Version");return null}let nc=0,Kc=null;for(let hd=0;hd<Aa.length;hd++)Ab=Aa[hd],Mb.isSupported(Ab.V)&&Ab.V>nc&&(nc=Ab.V,Kc=Aa[hd]);return 1===nc?Kd(Kc):null},Zc=Aa=>{if(Aa){const Ab=new ie;Ab.I=Aa.packetId;Ab.V=1;Ab.A=Aa.clientId;Ab.C=Aa.client;Ab.O=Aa.jt;Ab.AN=Wa.c(Aa.zT);
Aa.yka&&(Ab.WD=Aa.yka);null!=Aa.wRb&&(Ab.TF=Aa.wRb);void 0!==Aa.text&&null!==Aa.text&&0<Aa.text.length&&(Ab.TX=Aa.text);Aa.T1b&&(Ab.AP=new gd(Aa.T1b.Ekg,Aa.T1b.gZf,Aa.T1b.K1));Aa.L_c&&(Ab.MP=new Md(Aa.L_c.fZf,Aa.L_c.Lmc));Aa.PQb&&(Ab.SP=new hf(Aa.PQb.dZf,Aa.PQb.Akg,Aa.PQb.eZf,Aa.PQb.Dkg));Aa.pad&&(Ab.SPS=new Ue(Aa.pad.djg,Aa.pad.ejg));Ab.ISS=Aa.strictlySequentialId;Aa=Ab}else Aa=null;return Aa};var Nc=c(60);class ge{constructor(Aa,Ab,nc,Kc,hd,Rd,kc,ff,bd){this.LocalCobaltSessionId=Aa;this.SkypeChatThreadId=
Ab;this.ChatThreadDiscoveryUri=nc;this.InChat=Kc;this.Capabilities=hd;this.Email=Rd;this.UserName=kc;this.IsAnonymous=ff;this.PresenceStatus=bd}}Object(l.a)(ge,"SerializableWacData",null,[]);class $d{constructor(){this.Ewd=this.Dwd=0}f4l(){this.Ewd===Number.MAX_VALUE&&(this.Ewd=0);this.Ewd++;return this.Ewd}e4l(){this.Dwd===Number.MAX_VALUE&&(this.Dwd=0);this.Dwd++;return this.Dwd}static get instance(){return $d.Rik}}$d.Rik=new $d;Object(l.a)($d,"StrictlySequentialIdGenerator",null,[192]);var te=
c(1534);class Se{constructor(Aa,Ab,nc,Kc,hd,Rd,kc,ff=0){this.zta=null;this.dryDeletion=0;this.MI=Aa;this.jMa=Rd;this.ud=hd;this.aAb=kc;this.Wc=Ab;this.shapeId=ff;this.uHa=nc;this.e$=kc.create(this,Kc,hd,Rd)}clone(){return new Se(this.MI,this.Wc,this.uHa,this.e$.Nrb,this.ud,this.jMa,this.aAb,this.shapeId)}get paragraphId(){return this.zta?this.zta:this.MI.Pib(this.Wc)}JWf(){this.zta||(this.zta=this.paragraphId,this.e$.JWf())}isValid(){return 0<=this.e$.cp}getData(){const Aa=this.e$.Nrb;return Aa?new te.a(0,
this.Wc,this.uHa,Aa,null,null,null,0,this.shapeId):null}static BCb(Aa,Ab,nc,Kc,hd){return Ab?new Se(Ab,parseInt(Aa.ASa),Aa.p8a,Aa.ZR,nc,Kc,hd,Aa.shapeId):null}}Object(l.a)(Se,"WordPresenceIp",null,[158,46,159]);class tc{constructor(Aa,Ab,nc){this.hUa=this.Wca=this.zyc=!1;this.tcb=Aa;this.jXa=nc;this.user=Ab}get ip(){return this.jXa}get Zec(){return this.zyc}set Zec(Aa){(this.zyc=Aa)&&this.ip.JWf()}gtf(){const Aa=$d.instance.e4l();return new qc(this.tcb,this.user.clientId,1,0,this.ip?this.ip.getData():
null,new ge(this.user.wP,this.user.BHc,this.user.chatThreadDiscoveryUri,this.user.inChat,this.user.capabilities.capabilities,this.user.email,this.user.userName,this.user.isAnonymous,this.user.presenceStatus),void 0,void 0,void 0,void 0,void 0,void 0,void 0,Aa)}s9h(){return this.user.clientId+(this.ip?this.ip.paragraphId.toString():Nc.a.nil.toString())}isValid(){const Aa=!!this.user&&this.user.isValid(),Ab=!this.ip||this.ip.isValid();return Aa&&Ab}clone(){const Aa=new tc;Aa.tcb=this.tcb;Aa.zyc=this.zyc;
Aa.user=this.user?this.user.clone():null;Aa.jXa=this.ip?this.ip.clone():null;Aa.Wca=this.Wca;Aa.hUa=this.hUa;return Aa}static W$e(Aa,Ab,nc,Kc,hd){if(!Aa||!Ab)return null;if(Aa.jt)return k.ULS.sendTraceTag(7685324,302,15,"Presence packet is of unexpected operationType {0}",Aa.jt),null;let Rd;Rd=void 0!==Aa.yka&&null!==Aa.yka?bb.DKh(Aa.clientId,Aa.yka.UserName,Aa.yka.Capabilities,Aa.yka.LocalCobaltSessionId,Aa.yka.SkypeChatThreadId,Aa.yka.Email,Aa.client,Aa.yka.ChatThreadDiscoveryUri,Aa.yka.InChat,
!1,Aa.yka.IsAnonymous,Aa.yka.PresenceStatus):bb.DKh(Aa.clientId,null,0,void 0,void 0,void 0,Aa.client);return new tc(Aa.packetId,Rd,Se.BCb(Aa.zT,Ab,nc,Kc,hd))}}Object(l.a)(tc,"WordPresenceInfo",null,[188,46]);class dd extends pb{constructor(Aa,Ab,nc,Kc,hd,Rd,kc,ff,bd,Sf,Te,bi,Si,li){super(Aa,Rd,li,Ab);this.GWj=nc;this.ugk=Kc;this.Qek=hd;this.ib=kc;dd.eu=ff;this.MI=bd;this.ud=Sf;this.jMa=Te;this.sXe=bi;this.mKa=Si}ypg(Aa){this.mKa.HDi(Aa.CommandValueId);return super.ypg(Aa)}rWm(Aa){let Ab;({X0f:Ab}=
this.LFf(Aa)).returnValue&&(this.ugk(Ab.ip.paragraphId,Ab.ip.e$.cp),m.AFrameworkApplication.K.$("WordEditorMoveIpToUserLocationIsEnabled")&&(Aa=dd.Ibm(Ab),void 0!==Aa&&null!==Aa?(k.ULS.sendTraceTag(20764574,325,50,"Attempting to move IP to the editing location of the selected user"),this.ib.Bc(Aa),Za.FocusManager.iK()&&Za.FocusManager.instance().kg(Ub.AFrame.Un)):k.ULS.sendTraceTag(20764575,325,50,"IP will not be moved since the selection is either null or undefined")),Aa=new oa.a(2,1,0,()=>{this.ga.Rb(Xa.a.rie,
2,Ab)}),Xb.a.instance.Xb(Aa))}Bdi(Aa){return Aa?(Aa=tc.W$e(Wc(Aa),this.MI,this.ud,this.jMa,this.sXe.instance))&&Aa.isValid()&&Aa.ip?Aa:null:null}fRk(Aa){return this.kQm(Aa)?this.zRk(Aa)?!0:(k.ULS.sendTraceTag(41236613,325,50,"Cannot jump to user location because paragraph has not been loaded yet"),!1):(k.ULS.sendTraceTag(41236612,325,50,"Cannot jump to user location because presence is not valid"),!1)}kQm(Aa){return!!this.Bdi(Aa)}LFf(Aa){Aa=this.Bdi(Aa);return{returnValue:!!Aa,X0f:Aa}}zRk(Aa){let Ab;
return({X0f:Ab}=this.LFf(Aa)).returnValue?this.GWj(Ab.ip.paragraphId,Ab.ip.e$.cp):!1}yLl(){if(!this.zD)return[];const Aa=[];for(const Ab of this.zD.I1a())Ab.userName?Aa.push(Ab):k.ULS.sendTraceTag(592229832,304,15,"The looked up RTC User has no name");return Aa}M5k(Aa){let Ab;return({X0f:Ab}=this.LFf(Aa)).returnValue&&Ab.user&&Ab.user.presenceStatus&&"0"!==Ab.user.presenceStatus?String.format(WordEditorIntl.WordEditorStrings.l_PresenceStatusOnPage,Ab.user.presenceStatus):CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}yRn(){this.Qek(this.settings.id)}static createInstance(Aa,
Ab,nc,Kc,hd,Rd,kc){const ff=Ga.App.za.jb,bd=m.AFrameworkApplication.va,Sf=Pb.a.instance,Te=Na.a.instance.resolve("Box4.ICoauthCashTelemetry");return new dd(Aa,Ab,bi=>ff.qc.Vi?ff.qc.y5e(bi,!0):!1,(bi,Si)=>{ff.qc.Vi&&ff.qc.FTa(bi,Si,!0,!0,!1)},()=>{Ga.App.Gv.$I.xcd()},bd,Sf,ff,nc,Kc,hd,Rd,Te,kc)}static Ibm(Aa){const Ab=dd.eu.Yc.vd.Eb(Aa.ip.paragraphId);if(void 0===Ab||null===Ab)return k.ULS.sendTraceTag(20764576,325,15,"The node could not be obtained"),null;if(!Va.ParagraphReader.Wb(Ab))return k.ULS.sendTraceTag(20764577,
325,15,"The obtained node is not a paragraph node"),null;Aa=tb.a.Oc(Ab,Aa.ip.e$.cp);return new cb.Selection([Aa],!0)}}dd.eu=null;Object(l.a)(dd,"WordEditorPeoplesWell",pb,[]);class Ed{constructor(){this.Wx=()=>{m.AFrameworkApplication.P_i?Ed.Xqa.XD().continueWith(this.J1c):k.ULS.sendTraceTag(23196872,325,50,"PeoplesWell control is explicitly disabled. Skipping initialization attempt")};this.J1c=()=>{Ed.fj=Ed.Xqa.XD().result;if(Ed.fj){var Aa=()=>{const Ab=Ga.App.za.jb;return Ab?Ab.Yc?Ab.Yc.vd:(k.ULS.sendTraceTag(23196876,
325,15,"ActivePage is null"),null):(k.ULS.sendTraceTag(23196875,325,15,"Workspace is null"),null)};Ga.App.Foa().continueWith(()=>{const Ab=Ga.App.Foa().result.mj,nc=yb.CuiHelper.J7l(m.AFrameworkApplication.$s,m.AFrameworkApplication.$s,m.AFrameworkApplication.$s,m.AFrameworkApplication.$s),Kc=ab.createInstance(nc,Ab,Object(f.a)(Ed.fj.hee,Ed.fj.hee.rRc,"getUserPresence"),Object(f.a)(Ed.fj.hee,Ed.fj.hee.bjb,"getUserStatusInfo"),m.AFrameworkApplication.K.$("WordEditorPresenceDedupeMultipleCoauthorInstances"));
Na.a.instance.ia("RealtimePresenceUI.WordEditorPeoplesWell",()=>dd.createInstance(Kc,Da.a.Bp(Ed.W.Ta("Common.IPeopleInfoProvider")),Ed.W.Oa("WordEditor.ParagraphWordIdMapping"),Ed.W.Oa("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Aa,Ed.W.Ta("WordEditor.Presence.IWordPresenceCpFactory"),Ed.W.resolve("Common.App.People.IPeopleManager"))).as("Common.IPeoplesWell").ha();Ed._instance=Na.a.instance.resolve("Common.IPeoplesWell");Ed._instance.RUn();k.ULS.sendTraceTag(23196877,325,50,
"PeoplesWellControl is fully initialized")})}else k.ULS.sendTraceTag(23196873,325,15,"Can't initialize the PeoplesWell control because can't get a handle to RtcProxy")}}get name(){return"WordEditor.PeoplesWellControl"}wc(Aa){Ed.W=Aa}init(){m.AFrameworkApplication.K.Hn(this.Wx)}dispose(){Ed._instance&&(Ed._instance.dispose(),Ed._instance=null)}static get Xqa(){return null!=Ed.SEg?Ed.SEg:Ed.SEg=Na.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}}Ed._instance=null;Ed.W=null;Ed.fj=null;Object(l.a)(Ed,
"WordEditorPeoplesWellControlPackage",null,[1,2]);var Qd=c(99),Ad=c(163);class Oe{constructor(Aa,Ab,nc,Kc,hd,Rd,kc,ff,bd=!1){this.J9a=null;this.AAe=!0;this.MNe=this.Fl=this.ote=null;this.sa=new Ka.a;this.dMa=Aa;this.d_=Ab;this.bah=nc;this.JAc=Kc;this.cLg=Rd;Oe.Ib=hd;this.Sdk=kc;this.o7=ff;this.Zek=bd;G.Task.WAA(Ab,nc).continueWith(Object(f.a)(this,this.oxm,"initOnTaskReady"))}Oxk(Aa){this.sa.addHandler("u",Aa)}q5i(){this.sa.raiseEvent("u",null,this)}oxm(){this.d_.result&&this.bah.result&&(this.Fl=
this.d_.result,this.MNe=this.bah.result,this.Fl.b_a(Object(f.a)(this,this.h5,"onPresenceUpdated")),this.ote=new oa.a(2,2,this.cLg,Object(f.a)(this,this.xRo,"updateAwayClientsTask"),88),Oe.Ib.Xb(this.ote))}h5(Aa,Ab){(this.AAe||this.aOn(Ab.Ora))&&Oe.Ib.o1(this.ote,0)}aOn(Aa){for(let nc in Aa){var Ab=this.JAc.TSd({key:nc,value:Aa[nc]});if(Ab&&Ab.clientId&&(Ab=Ab.clientId.toLowerCase(),(Ab=this.J9a[Ab]||this.J9a[Ab.toUpperCase()])&&2===Ab.status))return!0}return!1}xRo(Aa){var Ab=this.Fl.HOc();if(Ab){var nc=
new Date,Kc=!1;if(this.AAe){this.J9a=Ab;this.AAe=!1;var hd=this.J9a;for(var Rd in hd){Ab=Rd;var kc=hd[Rd];kc.hec<nc&&(nc=kc.hec);2===kc.status&&(Kc=!0,this.MNe.X5c(Ab))}Kc&&this.q5i();Oe.Ib.o1(Aa,this.rbi(nc))}else{kc=new P.a;Rd=!1;var ff=this.J9a;for(hd in ff){ff=hd;if(!(ff in this.J9a)||this.dMa.clientId===ff)continue;var bd=this.J9a[ff];const Sf=Ab[ff];if(bd&&Sf){bd=bd.status;const Te=Sf.status;2===bd&&1===Te?(kc.add(ff),k.ULS.sendTraceTag(38052609,392,50,ff+" returned from away")):1===bd&&2===
Te&&(Rd=Kc=!0,this.MNe.X5c(ff),k.ULS.sendTraceTag(38052610,392,50,ff+" went away"));1===Te&&Sf.hec<nc&&(nc=Sf.hec)}}this.J9a=Ab;Oe.Ib.o1(Aa,this.rbi(nc));(0<kc.count||Kc)&&this.q5i();0<kc.count&&!this.Zek?(Aa=this.DPl(kc),this.yIo(Aa)):Aa=new P.a;(Rd||0<Aa.count)&&this.Sdk(fb.a.MFd,2)}}}yIo(Aa){if(Aa.count)for(let Ab of Aa)Aa=this.o7.sva(String.format(CommonUIStrings.l_EditorsToastArriving,Ab),!1),Aa.image=5,Aa.Qoa="CoAuth_AuthorStatus_16x16x32",this.o7.qA(Aa)}DPl(Aa){const Ab=this.Fl.ZEb(),nc=new P.a;
for(let Kc in Ab){const hd={key:Kc,value:Ab[Kc]};if(Aa.contains(hd.key)){const Rd=this.JAc.TSd(hd);Rd&&(nc.add(Rd.userName),Aa.remove(hd.key))}}nc.count||k.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return nc}rbi(Aa){const Ab=new Date;return Math.max(Aa.getTime()+this.cLg-Ab.getTime(),0)}}Oe.Ib=null;Object(l.a)(Oe,"AwayManager",null,[]);var pf=c(775);class Fh{constructor(Aa=0){this.updates=Aa}get Uxf(){return 0!==this.updates}qFa(Aa){return!!(this.updates&Aa)}q7a(Aa){this.updates|=
Aa}toString(){if(this.qFa(0))return"none";const Aa=new P.a;this.qFa(1)&&Aa.add("user(s) joined");this.qFa(2)&&Aa.add("user(s) disconnected");this.qFa(4)&&Aa.add("user(s) updated");return Aa.toArray().join(", ")}}Object(l.a)(Fh,"UserUpdateEvent",null,[]);var Ig=c(35);class Jh{constructor(Aa,Ab,nc,Kc,hd=null){this.sa=new Ka.a;this.sK=this.fj=null;this.x6g=this.U6g=this.fm=!1;this.xq=new vb.a;Aa.continueWith(()=>{this.fj=Aa.result;this.fj.b_a(Object(f.a)(this,this.rWi,"onRtcPresenceUpdate"));this.fj.xua(Object(f.a)(this,
this.qWi,"onRtcConnectionChange"));this.Zog(null,null)});Ab.continueWith(()=>{this.sK=Ab.result;this.sK.qeb(Object(f.a)(this,this.m1c,"onEditorsTableUpdated"))});hd&&hd.continueWith(()=>{hd.result.Oxk(Object(f.a)(this,this.Zog,"updateUserStatus"));this.Zog(null,null)});this.vMa=nc;this.JAc=Kc}get users(){return this.xq}h2b(Aa){this.sa.addHandler("UU",Aa)}A7f(Aa){this.sa.removeHandler("UU",Aa)}Zog(){if(this.fj){var Aa=!1,Ab=this.fj.HOc();for(let Kc in Ab){var nc=Ab[Kc];const hd=Kc;this.users.nb(hd)&&
(nc=this.zzj(nc),Aa=this.users.J(hd).UBb!==nc||Aa,this.users.J(hd).UBb=nc)}Aa&&(Aa=new Fh(4),this.kfe(Aa))}}zzj(Aa){return 1===Aa.status?0:1}I1a(){this.users.count||(this.U6g||(Ig.b(42316242,302,50,"No users available at PeopleInfoProvider.GetAllUsers call"),this.U6g=!0),this.tCn());const Aa=[];for(let Ab of this.users)Array.add(Aa,Ab.value);return Aa}tCn(){if(this.fj){var Aa=this.fj.ZEb();this.lOf(Aa)}if(this.sK){Aa=this.sK.BOc();for(const Ab of Aa)Ab.Id&&(Aa=this.QMh(Ab.Id),this.Yog(new Fh,Aa))}}DMf(Aa){({value:Aa}=
this.users.Fc(Aa));return Aa}dispose(){this.fm||(this.fj&&(this.fj.AOb(Object(f.a)(this,this.rWi,"onRtcPresenceUpdate")),this.fj.Lic(Object(f.a)(this,this.qWi,"onRtcConnectionChange"))),this.sK&&this.sK.E$i(Object(f.a)(this,this.m1c,"onEditorsTableUpdated")),this.fm=!0)}qWi(Aa,Ab){2===Ab.newState&&(Aa=this.lOf(this.fj.ZEb()),Aa.Uxf&&this.kfe(Aa))}m1c(Aa,Ab){Aa=new Fh;var nc=this.sK.BOc();k.ULS.sendTraceTag(561894485,302,50,"editorstablemanager coauthors count is {0}, editorstableupdate old count of coauthors is {1}, editorstableupdate new count of coauthors is {2}",
nc.length,Ab.zhn,Ab.vPi);const Kc=new vb.a;for(var hd of nc){nc=hd.Id;const Rd=this.QMh(nc);this.Yog(Aa,Rd);Kc.Z(nc,Rd)}if((Ab=Ab.BJf)&&0<Ab.length)for(hd=0;hd<Ab.length;hd++)k.ULS.sendTraceTag(562415168,302,50,"{0} users in coauth gallery. User leaving the editor table: {1}",this.users.count,Ab.J(hd).Id),({value:nc}=this.users.Fc(Ab.J(hd).Id)).returnValue?nc?(this.users.remove(Ab.J(hd).Id),Aa.q7a(2),Kc.Z(Ab.J(hd).Id,nc)):k.ULS.sendTraceTag(561287839,302,50,"Empty entry in PIP users: {0}",Ab.J(hd).Id):
k.ULS.sendTraceTag(570426140,302,15,"Disconnected user not found: {0}",Ab.J(hd).Id);Ab=this.fj.ZEb();for(let Rd in Ab)hd=this.JAc.TSd({key:Rd,value:Ab[Rd]}),Kc.Z(hd.clientId,hd);for(let Rd of this.users)Kc.nb(Rd.value.clientId)||(k.ULS.sendTraceTag(561287840,302,15,"Coauth Gallery contains user not in Editors Table or RTC presence: {0}",Rd.key),this.users.remove(Rd.key),Aa.q7a(2));Aa.Uxf&&this.kfe(Aa)}rWi(Aa,Ab){Aa=this.lOf(Ab.Ora);for(const nc of Ab.rKd)this.users.nb(nc)&&(Aa.q7a(2),this.users.J(nc).UBb=
2);Aa.Uxf&&this.kfe(Aa)}lOf(Aa){const Ab=new Fh;if(!Aa)return Ab;for(let Kc in Aa){var nc=this.JAc.TSd({key:Kc,value:Aa[Kc]});nc&&(nc=nc.clone(),this.Yog(Ab,nc))}return Ab}Yog(Aa,Ab){if(Ab){var nc=Ab.clientId;var Kc=this.U4n(Ab);({value:Ab}=this.users.Fc(nc)).returnValue?Ab.equals(Kc)||(Aa.q7a(4),this.users.Z(nc,Kc)):(k.ULS.sendTraceTag(562415169,302,50,"{0} users in coauth gallery. User joining: {1}",this.users.count,nc),Aa.q7a(1),this.users.Z(nc,Kc))}}QMh(Aa){return this.users.nb(Aa)?this.users.J(Aa):
Ca.a.I9k(Aa)}U4n(Aa){if(!Aa||!Aa.clientId||!this.sK)return Aa;const Ab=Aa.clone();Ab.UBb=this.CPl(Aa);if(Aa=this.sK.Q8b(Ab.clientId))Ab.isReadOnly=Ab.isReadOnly||Aa.IsReadOnly?!0:!1,Ab.userName=this.T4n(Ab,Aa),Ab.capabilities=this.Fan(Ab.capabilities,Aa.Capabilities),Ab.email=Ab.email||Aa.SIPAddress||Aa.EmailAddress,Aa.JoinCoauthTime&&(Ab.rRa=Aa.JoinCoauthTime);Ab.color=this.vMa.C$b(new pf.a(Ab.email,void 0,Ab.userName,void 0,Ab.isAnonymous,Ab.clientId),3);return Ab}CPl(Aa){if(!this.fj)return 2;if(Aa&&
Aa.clientId){const Ab=this.fj.HOc();if(Aa.clientId in Ab)return this.zzj(Ab[Aa.clientId])}return 2}e1k(Aa,Ab){Ab.Name&&Aa.userName&&Ab.Name!==Aa.userName&&!this.x6g&&(this.x6g=!0,Ig.b(42316243,302,15,"User names in EditorsTable and RTC don't match"))}Fan(Aa,Ab){Aa=Aa||new ua.a;Ab&&(Ab.SupportsRealtimeChannel&&Aa.q7a(1),Ab.SupportsRename&&Aa.q7a(2),Ab.SupportsChat&&Aa.q7a(4));return Aa}T4n(Aa,Ab){this.e1k(Aa,Ab);return Ab.Name||Aa.userName||(Aa.isAnonymous||Ab.IsAnonymous?CommonUIStrings.l_GuestUserName:
null)}kfe(Aa){k.ULS.sendTraceTag(42316245,302,100,"PeopleInfoProvider update detected: {0}",Aa.toString());this.sa.raiseEvent("UU")}}Object(l.a)(Jh,"PeopleInfoProvider",null,[948,10]);var xg;(function(Aa){Aa[Aa.multipleBrowsersImageClassName=0]="multipleBrowsersImageClassName";Aa[Aa.peopleImageClassName=1]="peopleImageClassName";Aa[Aa.peopleImageClusterPath=4]="peopleImageClusterPath";Aa[Aa.multipleBrowserImageClusterPath=5]="multipleBrowserImageClusterPath";Aa[Aa.imageDimension=6]="imageDimension";
Aa[Aa.rtl=8]="rtl";Aa[Aa.pointerInputManager=9]="pointerInputManager";Aa[Aa.clickInputManager=10]="clickInputManager";Aa[Aa.vertical=11]="vertical";Aa[Aa.zIndex=12]="zIndex";Aa[Aa.contextMenuInputManager=13]="contextMenuInputManager";Aa[Aa.imageDomElement=14]="imageDomElement";Aa[Aa.useIdleTooltip=15]="useIdleTooltip";Aa[Aa.viewportBoundsCallback=16]="viewportBoundsCallback";Aa[Aa.flipHorizontalDirection=17]="flipHorizontalDirection";Aa[Aa.fixRemoveFadeOutElementCrash=18]="fixRemoveFadeOutElementCrash";
Aa[Aa.ignoreEventOnExpandedTooltip=19]="ignoreEventOnExpandedTooltip";Aa[Aa.ipWidthAdjustForFlyout=20]="ipWidthAdjustForFlyout"})(xg||(xg={}));Object(l.b)("PresenceTooltipSettingKeys",xg);class bc{constructor(){this.Au={}}get(Aa,Ab=null){Aa=xg[Aa];return"number"===typeof Ab?(Ab=this.Au[Aa])?Number.parseInvariant(Ab.toString()):0:this.Au[Aa]}add(Aa,Ab){this.Au[xg[Aa]]=Ab}wNa(Aa,Ab){xg[Aa]in this.Au||(this.Au[xg[Aa]]=Ab)}remove(Aa){delete this.Au[xg[Aa]]}}Object(l.a)(bc,"PresenceTooltipSettings",null,
[]);class Bc extends Ka.a{constructor(Aa){super();this._element=null;this.element=Aa}get element(){return this._element}set element(Aa){this._element=Aa}get visible(){return"visible"===this.element.style.visibility}set visible(Aa){this.element.style.visibility=Aa?"visible":"hidden"}get rtl(){return"rtl"===this.element.dir.toLowerCase()}set rtl(Aa){this.element.dir=Aa?"rtl":"ltr"}get zIndex(){return this.element.style.zIndex}set zIndex(Aa){this.element.style.zIndex=String(Aa)}dispose(){this.element&&
this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;super.dispose()}createElement(Aa){return this.element.ownerDocument.createElement(Aa)}$ja(){return!0}static eMh(Aa){return"prControl"+(Aa?"Rtl":"")}}Object(l.a)(Bc,"BasePresenceControl",Ka.a,[10,953]);class ad extends Sys.EventArgs{constructor(Aa,Ab){super();this.type=Aa;this.Po=Ab}}ad.zU="InteractivityChanged";Object(l.a)(ad,"InteractivityChangedEventArgs",Sys.EventArgs,[]);class zd{static MSl(Aa){return zd.NSl(Aa)}static NSl(Aa){const Ab=
document.createElementNS(zd.urg,"svg");Ab.setAttribute("viewBox",String.format(zd.Ifl,zd.qIj,zd.pIj));Ab.appendChild(zd.Tdm(Aa));return Ab}static Tdm(Aa){const Ab=zd.qIj/Aa,nc=2*Ab,Kc=zd.pIj/2;Aa=(Aa-12-8)*Ab/2;const hd=document.createElementNS(zd.urg,"g");Sys.UI.DomElement.addCssClass(hd,zd.Hfl);for(let Rd=1;3>=Rd;Rd++)hd.appendChild(zd.oPl(Rd,nc,Aa+(6*Rd-2)*Ab,Kc));return hd}static oPl(Aa,Ab,nc,Kc){const hd=document.createElementNS(zd.urg,"circle");Sys.UI.DomElement.addCssClass(hd,String.format("{0}-{1}",
zd.KVk,Aa));hd.setAttribute("cx",String.format("{0}",nc));hd.setAttribute("cy",String.format("{0}",Kc));hd.setAttribute("r",String.format("{0}",Ab));return hd}}zd.urg="http://www.w3.org/2000/svg";zd.Hfl="prDancingDots";zd.KVk="prAnimateCircle";zd.Ifl="0 0 {0} {1}";zd.pIj=40;zd.qIj=120;Object(l.a)(zd,"ModernPresenceTooltipDancingDots",null,[]);var Xd=c(97),Gd=c(90),Ze=c(11),Fe=c(28),bf=c(140),ag=c(56);class Xf extends Bc{constructor(Aa,Ab){super(Aa);this.Hjh=this.Aab=this.cve=this._img=this.uE=this.us=
this.gg=null;this.OMa=Ab.get(8,!1);this.gab=Ab.get(6,0);this.hmk=Ab.get(15,!1);this.Sf=Ab;this.rTg=0;this.element=Aa;this.element.className=Xf.ykf;this._span=document.createElement("span");this.element.appendChild(this._span);this.L_j=zd.MSl(Ab.get(6,0));this.cC(Ab);this._state=5}uAb(Aa){this.addHandler(ad.zU,Aa)}wOb(Aa){this.removeHandler(ad.zU,Aa)}get user(){return this.Hjh}get state(){return this._state}dispose(){this.element&&(this.gg.sc(Ze.a.click,this.element,Object(f.a)(this,this.onClick,"onClick")),
this.gg.sc(Ze.a.uB,this.element,Object(f.a)(this,this.$ja,"stopPropagationAndPreventDefaultBehavior")),this.us.sc(Ze.a.pointerDown,this.element,Object(f.a)(this,this.eD,"onPointerDown")),this.us.sc(Ze.a.pointerOut,this.element,Object(f.a)(this,this.PJ,"onPointerOut")),this.us.sc(Ze.a.pointerOver,this.element,Object(f.a)(this,this.GP,"onPointerOver")),this.uE.sc(this.element,Object(f.a)(this,this.$ja,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}cC(Aa){this.gg=Aa.get(10);this.gg.ob(Ze.a.click,
this.element,Object(f.a)(this,this.onClick,"onClick"));this.gg.ob(Ze.a.uB,this.element,Object(f.a)(this,this.$ja,"stopPropagationAndPreventDefaultBehavior"));this.us=Aa.get(9);this.us.ob(Ze.a.pointerOver,this.element,Object(f.a)(this,this.GP,"onPointerOver"));this.us.ob(Ze.a.pointerOut,this.element,Object(f.a)(this,this.PJ,"onPointerOut"));this.us.ob(Ze.a.pointerDown,this.element,Object(f.a)(this,this.eD,"onPointerDown"));this.uE=Aa.get(13);this.uE.ob(this.element,Object(f.a)(this,this.$ja,"stopPropagationAndPreventDefaultBehavior"))}hide(Aa=
null,Ab=0,nc=0){this.hmk&&Aa?this.uuo(Aa,Ab,nc):(3===this.state&&this.m9i(),this.visible=!1,this._state=5)}uuo(Aa,Ab,nc=0){this.show(Aa,Ab,15,4,void 0,nc)}Xpj(Aa,Ab,nc=!1,Kc=!1,hd=!1,Rd=0){this.show(Aa,Ab,20,nc?2:Kc?1:0,hd,Rd)}Sto(Aa,Ab,nc,Kc=!1,hd=0){this.show(Aa,Ab,nc+20,3,Kc,hd)}show(Aa,Ab,nc,Kc=3,hd=!1,Rd=0){!Aa||Kc===this.state&&this.Mqm(Ab,nc)||(this.Apk(Kc,hd,Rd),this.ega(Aa,Kc,Rd),this._state=Kc,4===Rd||0===Rd&&!this.OMa?this.element.style.left=Ab+"px":this.element.style.right=Ab+"px",this.element.style.top=
nc+"px",this.visible=!0)}ega(Aa,Ab,nc){this.Hjh=Aa;ag.a.HC(this._span);bf.a.tXk(this._span);this._span.id="fly_"+Aa.clientId;this._span.style.backgroundColor=Aa.color;4!==Ab?(this._span.style.height=this.gab+"px",this._span.style.lineHeight=this.gab+"px",bf.a.WPb(this._span,"border-radius",this.gab+"px")):4===nc||0===nc&&!this.OMa?this._span.style.left="0px":this._span.style.right="0px";2!==Ab&&(4===Ab?ag.a.tv(this._span,""):1===Ab?this._span.appendChild(this.L_j):(this._span.setAttribute("dir","auto"),
nc=Jb.a.b_l(Aa.userName),(!Aa.isAnonymous||m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1))&&nc||0!==Ab?(Aa=Aa.userName,0===Ab&&(Aa=nc,bf.a.WPb(this._span,"text-align","center")),ag.a.tv(this._span,Aa)):(this._img||(this._img=this.v7k()),this._span.appendChild(this._img),bf.a.WPb(this._span,"text-align","start"))))}onClick(Aa){if(0===this.state)return this.raiseEvent(ad.zU,new ad(1,Aa)),!0;3===this.state&&k.ULS.sendTraceTag(50436114,
302,50,"User clicked on presence pill.");return!1}PJ(Aa){3===this.state&&this.raiseEvent(ad.zU,new ad(3,Aa));return!1}GP(Aa){3!==Aa.hg&&this.raiseEvent(ad.zU,new ad(2,Aa));return!1}eD(Aa){if(3!==Aa.hg)return!0;this.raiseEvent(ad.zU,new ad(4,Aa));return!1}v7k(){const Aa=document.createElement("img");Aa.src=Xd.a.Iba("doughperson_white_glyph.svg");Aa.setAttribute("Unselectable","on");Fe.a.ir(Aa,Fe.a.oh,Fe.a.rz);return Gd.createClusteredImageFromClusterWithImageClass(this.gab,this.gab,null,null,Xf.hFl,
"",!1,"",this.element.ownerDocument,Aa)}Apk(Aa,Ab=!1,nc=0){if(!this.kVc(this.state)||!this.kVc(Aa))switch(Sys.UI.DomElement.removeCssClass(this.element,this.cve),this.state){case 4:3===Aa?this.QZa(Xf.zkf,Xf.g0h):this.kVc(Aa)&&this.QZa(Xf.xkf,Xf.g0h);break;case 3:4===Aa?this.QZa(Xf.Ckf,Xf.f0h):this.kVc(Aa)&&(Ab&&this.m9i(),this.QZa(Xf.xkf,Xf.f0h,Ab?Xf.gFl:""));break;case 0:case 1:case 2:4===Aa?this.QZa(Xf.Ckf,Xf.Akf):3===Aa&&(Ab&&this.Hqk(),this.QZa(Xf.zkf,Xf.Akf,Ab?Xf.h0h:"",3===nc?Xf.kFl:Xf.iFl));
break;default:4===Aa?this.QZa(Xf.Ckf):3===Aa?this.QZa(Xf.zkf):this.kVc(Aa)&&this.QZa(Xf.xkf)}}QZa(...Aa){this.cve=Aa.join(" ");Sys.UI.DomElement.addCssClass(this.element,this.cve)}Hqk(){this.rTg=window.setTimeout(()=>{this.element&&(this.Aab=this.element.cloneNode(!0),this.element.parentNode.appendChild(this.Aab),this.element.style.zIndex="2",this.Aab.style.zIndex="1")},300)}m9i(){window.clearTimeout(this.rTg);this.Aab&&(Sys.UI.DomElement.removeCssClass(this.Aab,Xf.Akf+" "+Xf.h0h),Sys.UI.DomElement.addCssClass(this.Aab,
Xf.fFl),G.Task.delay(300).continueWith(()=>{this.element&&this.element.parentNode===this.Aab.parentNode&&this.element.parentNode.removeChild(this.Aab)}),bf.a.Jic(this.element,"z-index"))}kVc(Aa){return 0===Aa||1===Aa||2===Aa}Mqm(Aa,Ab){const nc=bf.a.PY(this.element.style.top);return bf.a.PY(this.element.style.left)===Aa&&nc===Ab}K8f(Aa){3===Aa&&bf.a.Bba(this.element,"left")?(Aa=bf.a.PY(this.element.style.left),bf.a.Jic(this.element,"left"),this.element.style.right=-1*Aa+"px"):4===Aa&&bf.a.Bba(this.element,
"right")&&(Aa=bf.a.PY(this.element.style.right),bf.a.Jic(this.element,"right"),this.element.style.left=-1*Aa+"px")}}Xf.ykf="prModernFlyout UIFont";Xf.Ckf="flyoutIdle";Xf.zkf="flyoutExpanded";Xf.xkf="flyoutCollapsed";Xf.g0h="flyoutFromIdle";Xf.f0h="flyoutFromExpanded";Xf.Akf="flyoutFromCollapsed";Xf.h0h="flyoutStacked";Xf.gFl="flyoutFromStacked";Xf.fFl="flyoutFadeOut";Xf.hFl="cui-img-cont-float cui-img-20by20";Xf.iFl="flyoutLtrDir";Xf.kFl="flyoutRtlDir";Object(l.a)(Xf,"ModernPresenceTooltipFlyoutControl",
Bc,[]);class vf{constructor(Aa,Ab,nc=2,Kc=4){this.offsetTop=Aa;this.offsetLeft=Ab;this.nIj=nc;this.yni=Kc}}Object(l.a)(vf,"FlyoutsPositioningInfo",null,[]);var Bg=c(39);class ob{constructor(Aa=!1,Ab=!1){this.hm=Aa;this.FAe=Ab}o0l(Aa,Ab,nc,Kc,hd){const Rd=hd.y,kc=hd.height;var ff=this.INl(Kc);const bd=ff+Ab,Sf=Aa*nc+2*(Aa-1);nc=null;1===Aa||this.WQk(ff,Sf,Rd,kc)?Aa=new vf(0,0,2):(Aa=this.ikf(bd,Sf,Rd,kc),Aa.offsetTop-=ff);this.FAe?nc=new vf(0,0,void 0,this.hm?4:3):(Kc=this.HNl(Kc,hd),ff=Math.max(0,
hd.x),hd=hd.width,Ab=Kc+Ab,this.XQk(Kc,ff,hd)?nc=new vf(0,0,void 0,this.hm?3:4):this.YQk(Ab,ff)&&(nc=new vf(0,0,void 0,this.hm?4:3)),nc||(nc=this.RDl(Kc,Ab,ff,hd)));return new vf(Aa.offsetTop,nc.offsetLeft,Aa.nIj,nc.yni)}INl(Aa){return Bg.a.REa(Aa)}HNl(Aa,Ab){return this.hm?Ab.width-Bg.a.x4h(Aa):Bg.a.knf(Aa)}WQk(Aa,Ab,nc,Kc){return Aa+Ab<=nc+Kc}ikf(Aa,Ab,nc,Kc){let hd=1,Rd=Math.max(nc,Aa-Ab);Ab>Aa-nc&&(hd=2,Rd=Ab<Kc?Kc-Ab:nc);return new vf(Rd,0,hd)}XQk(Aa,Ab,nc){return Aa+150<=Ab+nc}YQk(Aa,Ab){return 150<=
Aa-Ab}RDl(Aa,Ab,nc,Kc){Kc-Ab>=Aa-nc?Aa=4:(Ab=Aa,Aa=3);return new vf(0,Ab,void 0,Aa)}}Object(l.a)(ob,"ModernPresenceTooltipPositioner",null,[]);class $b{constructor(Aa,Ab,nc,Kc,hd,Rd,kc){this.qaa=Aa;this._parent=Ab;this.ONg=nc;this.yXj=Kc;this.y4j=hd;this.o0b=Rd;this.OMa=kc;this._element=document.createElement("div");this.element.className="prTouchTarget"}get element(){return this._element}update(Aa,Ab){if(3!==Aa)if(5!==Aa&&this.qaa&&this.qaa.length){if(4===Aa){var nc=this.y4j;var Kc=(this.o0b-nc)/
2;this.element.style.height=this.o0b+"px";this.element.style.width=this.o0b+"px";Aa=bf.a.PY(this.qaa[0].element.style.top);Ab=bf.a.PY(this.OMa?this.qaa[0].element.style.right:this.qaa[0].element.style.left)}else nc=this.ONg,Kc=(this.o0b-nc)/2,this.element.style.height=this.o0b+"px",this.element.style.width=this.GPl()+2*Kc+"px",Aa=bf.a.PY(this.qaa[this.qaa.length-1].element.style.top),Ab=this.aQk(this.qaa[this.qaa.length-1].element,nc,Ab);bf.a.WPb(this.element,"border-radius",this.o0b+"px");this.element.style.top=
Aa-Kc-nc+"px";this.OMa?this.element.style.right=Ab-Kc+"px":this.element.style.left=Ab-Kc+"px";this.element.parentNode||this._parent.insertBefore(this.element,this._parent.firstChild)}else this.element.parentNode&&this.element.parentNode.removeChild(this.element)}aQk(Aa,Ab,nc){return this.OMa&&!nc?bf.a.PY(Aa.style.right):this.OMa||nc?this.OMa&&nc?-bf.a.PY(Aa.style.left)-Ab:-bf.a.PY(Aa.style.right)-Ab:bf.a.PY(Aa.style.left)}GPl(){return this.qaa&&this.qaa.length?this.ONg+Math.min(this.qaa.length-1,
2)*this.yXj:0}}Object(l.a)($b,"ModernPresenceTooltipTarget",null,[]);var Uc=c(125),Pd=c(192);class ze extends Bc{constructor(Aa,Ab,nc){super(Aa);this.QZb=this.ALa=this.vYg=this.Eub=!1;this.xq=[];this.smd={};this.Sf=nc;this.hm=nc.get(8,!1);this.kXg=nc.get(15,!1);this.DZj=nc.get(12,0);this.cfb=nc.get(6,0);this.ema=Ab;this.ekh=nc.get(16);this.FAe=nc.get(17,!1);this.C4j=nc.get(19,!1);this.Idk=nc.get(20,!1);this.qpd=0;this.Cdk=new ob(this.hm,this.FAe);this.Zpc=this.b7h();this.Cxb=!1;this.KTb=[];this.Yvc=
[];this.element.id=ze.Zhb();this.element.className=Bc.eMh(this.hm);this.F0a&&(this.zIndex=this.F0a);this.rtl=this.hm;this.Nbg(Ab);this.T6=this.createElement("div");this.T6.className="prFlyoutContainer";this.element.appendChild(this.T6);this.qaa=[];this.bbb=new $b(this.l4,this.element,this.cfb,4,6,32,this.hm);this.us=nc.get(9);this.us.ob(Ze.a.pointerDown,this.bbb.element,Object(f.a)(this,this.hgc,"onHitTarget"));this.us.ob(Ze.a.pointerOver,this.bbb.element,Object(f.a)(this,this.hgc,"onHitTarget"));
this.us.ob(Ze.a.pointerOut,this.bbb.element,Object(f.a)(this,this.hgc,"onHitTarget"))}get B$d(){return Pd.a.clone(this.xq)}get l4(){return this.qaa}get F0a(){return this.DZj}get y1a(){return this.l4?this.l4.length:0}get IRb(){return 0<this.y1a?this.l4[0].state:5}get CDf(){return 3===this.IRb&&!this.Eub}uAb(Aa){this.addHandler(ad.zU,Aa)}wOb(Aa){this.removeHandler(ad.zU,Aa)}dispose(){if(this.CDf)this.Cxb=!0;else{if(this.l4)for(const Aa of this.l4)Aa.wOb(Object(f.a)(this,this.oSa,"onInteractivityChanged")),
Qd.a.gC(Aa);this.qaa=null;this.us.sc(Ze.a.pointerDown,this.bbb.element,Object(f.a)(this,this.hgc,"onHitTarget"));this.us.sc(Ze.a.pointerOver,this.bbb.element,Object(f.a)(this,this.hgc,"onHitTarget"));this.us.sc(Ze.a.pointerOut,this.bbb.element,Object(f.a)(this,this.hgc,"onHitTarget"));super.dispose()}}rlc(){this.r4b();this.visible=!0}X9c(){this.visible=!0;this.EXh();this.Eub=!0}Cfg(){this.X9c()}hide(){this.T9i();this.X2a();this.bbb.update(this.IRb,this.QZb)}ega(Aa){const Ab=this.IRb,nc=this.Eub;Aa.clientId||
(Aa.clientId=(ze.rwc++).toString());if(Aa.clientId in this.smd){var Kc=this.wEb(Aa.clientId);if(0<=Kc){Kc=this.xq[Kc];if(Kc.color===Aa.color&&Kc.userName===Aa.userName)return;this.K6a(Aa.clientId)}}this.hide();Kc=new Xf(this.createElement("div"),this.Sf);Kc.uAb(Object(f.a)(this,this.oSa,"onInteractivityChanged"));this.T6.insertBefore(Kc.element,this.T6.firstChild);this.smd[Aa.clientId]=Kc;Array.add(this.xq,Aa);Array.add(this.l4,Kc);this.zGj(Ab,nc);this.visible=!0}K6a(Aa){if(this.CDf)Array.add(this.Yvc,
Aa);else{var Ab=this.IRb,nc=this.Eub;this.hide();this.W5c(Aa);this.zGj(Ab,nc)}}GOi(Aa){const Ab=this.wEb(Aa);if(!(0>=Ab)){var nc=this.xq[Ab];Aa=this.smd[Aa];Array.removeAt(this.xq,Ab);Array.insert(this.xq,0,nc);Array.removeAt(this.l4,Ab);Array.insert(this.l4,0,Aa);this.T6.removeChild(Aa.element);this.T6.appendChild(Aa.element);this.r4b()}}zGj(Aa,Ab){0>=this.xq.length?this.hide():3===Aa&&Ab?this.X9c():this.rlc()}aif(Aa){if(this.CDf&&this.C4j)return!1;Aa=ze.Esf(Aa);if(this.T6!==Aa&&ag.a.HQa(this.T6,
Aa))return!0;for(const Ab of this.l4)if(ag.a.HQa(Ab.element,Aa))return!0;return!1}position(Aa,Ab){this.element.style.top=Ab+"px";this.element.style.left=Aa+"px"}r4b(Aa=!1){if(!Aa||this.ALa){this.vYg&&this.Ilj(!0);var Ab=Math.min(3,this.y1a)-1;Aa=0;var nc=1,Kc=0;this.QZb&&(Aa=this.Zpc,nc=-1,Kc=-this.cfb);for(let hd=this.y1a-1;hd>Ab;hd--)this.l4[hd].Xpj(this.xq[hd],-4*Ab*nc+Kc,!0,!1,!0,Aa);for(;0<=Ab;Ab--)this.l4[Ab].Xpj(this.xq[Ab],-4*Ab*nc+Kc,0<Ab,Array.contains(this.KTb,this.xq[Ab].clientId),Ab!==
this.qpd,Aa);this.qpd=0;this.bbb.update(0,this.QZb);this.zIndex=this.F0a;this.Eub=!1;this.T9i(0);this.Cxb&&this.dispose()}}EXh(){this.vYg&&this.Ilj(!1);this.zIndex=this.F0a+1;let Aa,Ab,nc;({offsetX:Ab,offsetY:Aa,xni:nc}=this.Iho());for(let Kc=0;Kc<this.y1a;Kc++)this.l4[Kc].Sto(this.xq[Kc],Ab,Aa+(this.cfb+2)*Kc,Kc!==this.qpd,nc)}X2a(){let Aa=0,Ab=0;this.QZb&&(Aa=this.Zpc,Ab=-6);for(let nc=0;nc<this.y1a;nc++)this.l4[nc].hide(this.xq[nc],Ab,Aa);this.zIndex=this.F0a;this.visible=this.Eub=!1;this.Cxb&&
this.dispose()}O7e(Aa=0){Aa?(this.ALa=!0,G.Task.delay(Aa).continueWith(()=>{this.kXg?this.xsm():this.r4b(!0);this.ALa=!1})):this.kXg?this.hide():this.r4b()}xsm(){this.ALa&&this.hide()}aJk(){if(m.AFrameworkApplication.ua&&m.AFrameworkApplication.ua.Lb.zpa&&Uc.c()){const Aa=appChrome.selectors.getShyState();return Aa.isActive&&0!==Aa.state}return!1}oSa(Aa,Ab){Aa=this.IRb;this.aJk()||2!==Ab.type&&(4!==Ab.type||3===Aa)?4===Ab.type&&3===Aa?(this.ALa&&(this.ALa=!1),this.O7e()):3!==Ab.type||3!==Aa||this.Eub||
(1<this.y1a?(this.ALa=!0,G.Task.delay(250).continueWith(()=>{this.r4b(!0);this.ALa=!1})):this.O7e()):(this.ALa&&(this.ALa=!1),3!==Aa&&(this.EXh(),3===Ab.Po.hg&&this.O7e(2E3)));this.raiseEvent(ad.zU,Ab)}hgc(Aa){3===Aa.hg?this.oSa(this,new ad(4,Aa)):Aa.eventName===Ze.a.pointerOver?this.oSa(this,new ad(2,Aa)):Aa.eventName===Ze.a.pointerOut&&this.oSa(this,new ad(3,Aa));return!1}Nbg(Aa){this.element.style.width=Aa+"px";this.element.style.height=this.cfb+"px"}W5c(Aa){this.EWn(Aa);Aa=this.wEb(Aa);if(!(0>
Aa)){var Ab=this.xq[Aa];Array.removeAt(this.xq,Aa);delete this.smd[Ab.clientId];Ab=this.l4[Aa];this.T6.removeChild(Ab.element);this.Sf.get(18,!1)&&Ab.wOb(Object(f.a)(this,this.oSa,"onInteractivityChanged"));Array.removeAt(this.l4,Aa);Ab.dispose()}}T9i(Aa=5){if(this.Yvc.length){this.visible&&this.X2a();for(let Ab=0;Ab<this.Yvc.length;Ab++)this.W5c(this.Yvc[Ab]);Array.clear(this.Yvc);0>=this.xq.length||5===Aa?this.hide():0===Aa&&this.rlc()}}wEb(Aa){for(let Ab=0;Ab<this.xq.length;Ab++)if(this.xq[Ab].clientId===
Aa)return Ab;return-1}EWn(Aa){-1===this.wEb(Aa)?k.ULS.sendTraceTag(41706452,302,50,"Cannot remove active editor because client id is invalid"):Array.contains(this.KTb,Aa)&&(Array.remove(this.KTb,Aa),this.xq[0].clientId===Aa&&0<this.KTb.length&&this.GOi(this.KTb[this.KTb.length-1]),this.xq[0].clientId===Aa&&1===this.IRb&&this.r4b())}Ilj(Aa){Aa?Sys.UI.DomElement.addCssClass(this.T6,"prBackgroundSelection"):Sys.UI.DomElement.removeCssClass(this.T6,"prBackgroundSelection")}Iho(){let Aa,Ab;Ab=Aa=0;var nc=
this.Zpc;if(this.ekh){const Kc=this.ekh(this);if(!Kc)return{offsetX:Aa,offsetY:Ab,xni:nc};const hd=4===this.IRb;nc=this.Cdk.o0l(this.y1a,hd?6:this.cfb,this.cfb,this.element,Kc);Ab=nc.offsetTop;this.qpd=this.RZl(nc.nIj,nc.offsetTop);nc=nc.yni;nc!==this.Zpc&&(this.K8f(nc),this.element.dir=3===nc?"rtl":"ltr",this.Zpc=nc);nc!==this.b7h()?(Aa=this.Idk?-2:hd?-6:-this.cfb,this.QZb=!0):this.QZb=!1}return{offsetX:Aa,offsetY:Ab,xni:nc}}RZl(Aa,Ab){if(1===Aa)return this.y1a-1;Aa=Math.abs(Ab);return 0<Aa?Aa/(this.cfb+
2):0}K8f(Aa){for(let Ab=0;Ab<this.y1a;Ab++)this.l4[Ab].K8f(Aa)}b7h(){return this.hm?3:4}static Zhb(){return String.format("{0}-{1}","presencetooltip",ze.rwc++)}static Esf(Aa){return Aa.Hb.rawEvent.relatedTarget}}ze.rwc=0;Object(l.a)(ze,"ModernPresenceTooltipControl",Bc,[1065,10]);var Me=c(231),af=c(273);class Hg{constructor(Aa){this.Sf=Aa;this.Sf.wNa(10,Me.a.instance);this.Sf.wNa(9,Ad.a.instance);this.Sf.wNa(6,20);this.Sf.wNa(13,af.a.instance);this.Sf.wNa(17,!1)}D$e(Aa,Ab=!1){this.Sf.wNa(15,Ab);return new ze(Aa,
20,this.Sf)}}Object(l.a)(Hg,"ModernPresenceTooltipFactory",null,[1064]);class wi extends Bc{constructor(Aa,Ab){super(Aa);this.xq=null;this.OMa=Ab.get(8,!1);this.gab=Ab.get(6,0);this.element=Aa;this.element.className=wi.ykf;this._ul=this.createElement("ul");this.element.appendChild(this._ul);this.gg=Ab.get(10);this.gg.ob(Ze.a.click,this.element,Object(f.a)(this,this.onClick,"onClick"));this.us=Ab.get(9);this.us.ob(Ze.a.pointerOut,this.element,Object(f.a)(this,this.PJ,"onPointerOut"));this.us.ob(Ze.a.pointerDown,
this.element,Object(f.a)(this,this.$ja,"stopPropagationAndPreventDefaultBehavior"));this.uE=Ab.get(13);this.uE.ob(this.element,Object(f.a)(this,this.$ja,"stopPropagationAndPreventDefaultBehavior"))}uAb(Aa){this.addHandler(ad.zU,Aa)}wOb(Aa){this.removeHandler(ad.zU,Aa)}get users(){return this.xq}dispose(){this.element&&(this.gg.sc(Ze.a.click,this.element,Object(f.a)(this,this.onClick,"onClick")),this.us.sc(Ze.a.pointerDown,this.element,Object(f.a)(this,this.$ja,"stopPropagationAndPreventDefaultBehavior")),
this.us.sc(Ze.a.pointerOut,this.element,Object(f.a)(this,this.PJ,"onPointerOut")),this.uE.sc(this.element,Object(f.a)(this,this.$ja,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}hide(){this.visible=!1}show(Aa,Ab,nc){this.hide();!Aa||0>=Aa.length||(this.OMa?this.element.style.right=Ab+"px":this.element.style.left=Ab+"px",this.element.style.top=nc+"px",this.muk(Aa),this.visible=!0)}muk(Aa){this.xq=Aa;ag.a.HC(this._ul);for(let Ab=Aa.length-1;0<=Ab;Ab--)this.ega(Aa[Ab])}ega(Aa){const Ab=
document.createElement("li");Ab.style.backgroundColor=Aa.color;Ab.style.height=this.gab+"px";Ab.id="fly_"+Aa.clientId;Ab.style.lineHeight=this.gab+"px";ag.a.tv(Ab,Aa.userName);Ab.setAttribute("dir","auto");this._ul.appendChild(Ab)}onClick(){this.hide();return!1}PJ(Aa){this.raiseEvent(ad.zU,new ad(3,Aa));return!1}}wi.ykf="prFlyout UIFont";Object(l.a)(wi,"PresenceTooltipFlyoutControl",Bc,[]);class Wi extends Bc{constructor(Aa,Ab,nc){super(Aa);this._img=null;this.xq=[];this.element.className="prGlyph";
this.Sf=Ab;this.xZb=this.Sf.get(9);this.Nq=this.Sf.get(10);this.uE=this.Sf.get(13);this.Tsm();this.ega(nc);this.bFe=!1}get y5a(){return this.xq.length}get users(){return this.xq}uAb(Aa){this.addHandler(ad.zU,Aa)}wOb(Aa){this.removeHandler(ad.zU,Aa)}dispose(){this.lPo();super.dispose()}ega(Aa){Array.add(this.xq,Aa);2===this.y5a?this.ska(!0):1===this.y5a?this.ska(!1):this.ska(this.bFe)}K6a(Aa){this.kBl(Aa)&&(1<this.y5a&&this.ska(!0),1===this.y5a?this.ska(!1):1>this.y5a&&this.hide())}show(){this.ska(2<=
this.y5a);this.visible=!0}hide(){this.visible=!1}BZl(Aa){return Aa?this.B5h(0,5):this.B5h(1,4)}kBl(Aa){for(let Ab=0;Ab<this.y5a;Ab++)if(this.xq[Ab].clientId===Aa)return Aa=this.xq[Ab],Array.removeAt(this.xq,Ab),Aa;return null}ska(Aa){this.bFe!==Aa&&(this._img&&this.element.removeChild(this._img),this._img=this.BZl(Aa),this.element.appendChild(this._img),this.bFe=Aa);this._img.childNodes[0].style.backgroundColor=this.xq[this.xq.length-1].color}B5h(Aa,Ab){const nc=this.Sf.get(6,0),Kc=this.Sf.get(14);
return Gd.createClusteredImageFromClusterWithImageClass(nc,nc,this.Sf.get(Aa),this.Sf.get(Ab),"cui-img-cont-float cui-img-16by16","",!1,"",this.element.ownerDocument,Kc?Kc.cloneNode(!0):null)}GP(Aa){3!==Aa.hg&&this.raiseEvent(ad.zU,new ad(2,Aa));return!1}onClick(Aa){this.raiseEvent(ad.zU,new ad(1,Aa));return!0}PJ(Aa){3!==Aa.hg&&this.raiseEvent(ad.zU,new ad(3,Aa));return!1}lPo(){this.element&&(this.xZb.sc(Ze.a.pointerDown,this.element,Object(f.a)(this,this.$ja,"stopPropagationAndPreventDefaultBehavior")),
this.xZb.sc(Ze.a.pointerOver,this.element,Object(f.a)(this,this.GP,"onPointerOver")),this.xZb.sc(Ze.a.pointerOut,this.element,Object(f.a)(this,this.PJ,"onPointerOut")),this.Nq.sc(Ze.a.uB,this.element,Object(f.a)(this,this.$ja,"stopPropagationAndPreventDefaultBehavior")),this.Nq.sc(Ze.a.click,this.element,Object(f.a)(this,this.onClick,"onClick")),this.uE.sc(this.element,Object(f.a)(this,this.$ja,"stopPropagationAndPreventDefaultBehavior")))}Tsm(){this.element&&(this.xZb.ob(Ze.a.pointerDown,this.element,
Object(f.a)(this,this.$ja,"stopPropagationAndPreventDefaultBehavior")),this.xZb.ob(Ze.a.pointerOver,this.element,Object(f.a)(this,this.GP,"onPointerOver")),this.xZb.ob(Ze.a.pointerOut,this.element,Object(f.a)(this,this.PJ,"onPointerOut")),this.Nq.ob(Ze.a.uB,this.element,Object(f.a)(this,this.$ja,"stopPropagationAndPreventDefaultBehavior")),this.Nq.ob(Ze.a.click,this.element,Object(f.a)(this,this.onClick,"onClick")),this.uE.ob(this.element,Object(f.a)(this,this.$ja,"stopPropagationAndPreventDefaultBehavior")))}}
Object(l.a)(Wi,"PresenceTooltipGlyph",Bc,[]);class Mf extends Bc{constructor(Aa,Ab,nc){super(Aa);this.xq=[];this.KK=[];this.fMa=0;this.KCc=this.JWb=!1;this.uJg=null;this.tmd={};this.Sf=nc;this.hm=nc.get(8,!1);this.zla=nc.get(11,!1);Aa=nc.get(12,0);this.imageDimension=nc.get(6,0);this.ema=Ab;this.element.id=Mf.Zhb();this.element.className=Bc.eMh(this.hm);Aa&&(this.zIndex=Aa);this.rtl=this.hm;this.Nbg(Ab);this.kBa=this.createElement("div");this.kBa.className=this.zla?"prContainerV":"prContainerHr";
this.element.appendChild(this.kBa);this.CUg=Array(this.fMa);for(Ab=0;Ab<this.fMa;Ab++)this.eca[Ab]=new wi(this.createElement("div"),this.Sf),this.eca[Ab].uAb(Object(f.a)(this,this.oSa,"onInteractivityChanged")),this.element.appendChild(this.eca[Ab].element)}get B$d(){return Pd.a.clone(this.xq)}get eca(){return this.CUg}get amh(){return this.uJg}get Yie(){return this.imageDimension+2}get width(){return this.zla?this.Yie:this.ema}get height(){return this.zla?this.ema:this.Yie}uAb(Aa){this.addHandler(ad.zU,
Aa)}wOb(Aa){this.removeHandler(ad.zU,Aa)}dispose(){if(this.eca)for(const Aa of this.eca)Aa.wOb(Object(f.a)(this,this.oSa,"onInteractivityChanged")),Qd.a.gC(Aa);Qd.a.t$f(this.KK);this.KK=this.CUg=null;super.dispose()}rlc(){this.X2a();this.Pfg();this.visible=!0;this.JWb=!1}X9c(){!this.KK||1>this.KK.length||(this.X2a(),this.visible=!0,this.Pfg(),this.s$d(this.KK[this.KK.length-1]),this.JWb=!0)}Cfg(){if(this.KK&&!(1>this.KK.length)){this.visible=!0;this.Pfg();var Aa=0;for(const Ab of this.KK)this.s$d(Ab,
Aa++);this.JWb=!1;this.KCc=!0}}hide(){this.visible=!1;this.X2a();for(let Aa=0;Aa<this.KK.length;Aa++)this.KK[Aa].hide();this.JWb=!1}ZBh(){if(!this.KCc)return!1;let Aa=0;for(const Ab of this.eca)Ab.visible&&Aa++;return this.KCc=0<Aa&&(this.xq.length<=this.fMa?Aa===this.xq.length:Aa===this.fMa)}ega(Aa){if(!(0>=this.fMa)){Aa.clientId||(Aa.clientId=(Mf.rwc++).toString());if(Aa.clientId in this.tmd){var Ab=this.wEb(Aa.clientId);if(0<=Ab){Ab=this.xq[Ab];if(Ab.color===Aa.color&&Ab.userName===Aa.userName)return;
this.K6a(Aa.clientId)}}Ab=this.ZBh();var nc=0;if(this.xq.length<this.fMa){var Kc=new Wi(this.createElement("div"),this.Sf,Aa);Kc.uAb(Object(f.a)(this,this.oSa,"onInteractivityChanged"));this.hm&&!this.zla&&0<this.xq.length?this.kBa.insertBefore(Kc.element,this.kBa.firstChild):(this.kBa.appendChild(Kc.element),nc=this.KK.length);Array.add(this.KK,Kc)}else this.hm&&!this.zla?Kc=this.KK[0]:(nc=this.KK.length-1,Kc=this.KK[nc]),Kc.ega(Aa);Kc.show();this.tmd[Aa.clientId]=Kc;Array.add(this.xq,Aa);this.kEj(Kc,
nc);Ab&&this.Cfg()}}K6a(Aa){const Ab=this.ZBh();Ab&&this.X2a();this.W5c(Aa);this.xq.length>=this.fMa&&this.KK.length<this.fMa&&this.eOn();0>=this.xq.length?this.hide():Ab&&this.Cfg()}GOi(){}W5c(Aa){var Ab=this.wEb(Aa);0>Ab||(Aa=this.xq[Ab],Array.removeAt(this.xq,Ab),Ab=this.tmd[Aa.clientId],delete this.tmd[Aa.clientId],Ab.K6a(Aa.clientId),this.kEj(Ab),0>=Ab.y5a&&(this.kBa.removeChild(Ab.element),Array.remove(this.KK,Ab),Ab.dispose()))}eOn(){var Aa=this.O5l();!Aa||1>=Aa.users.length||(Aa=Array.clone(this.xq),
Aa.forEach(Ab=>{this.W5c(Ab.clientId)}),Aa.forEach(Ab=>{this.ega(Ab)}))}wEb(Aa){for(let Ab=0;Ab<this.xq.length;Ab++)if(this.xq[Ab].clientId===Aa)return Ab;return-1}O5l(){return this.hm&&!this.zla?this.KK[0]:this.KK[this.KK.length-1]}position(Aa,Ab){this.element.style.top=Ab+"px";this.element.style.left=Aa+"px"}Pfg(){for(let Aa=0;Aa<this.KK.length;Aa++)this.KK[Aa].show()}X2a(){for(let Aa=0;Aa<this.fMa;Aa++)this.eca[Aa].hide();this.KCc=!1}s$d(Aa,Ab=0){if(Aa)if(this.uJg=Aa,this.zla){const nc=this.imageDimension;
if(1<Aa.users.length)this.eca[Ab].show(Aa.users,nc,this.height-this.imageDimension);else{const Kc=this.kBa.children.length;for(let hd=0;hd<this.kBa.children.length;hd++)Aa.element===this.kBa.children[hd]&&this.eca[Ab].show(Aa.users,nc,this.height-(Kc-hd)*this.Yie+2)}}else this.eca[Ab].show(Aa.users,this.width,0)}oSa(Aa,Ab){var nc=Object(y.a)(Wi,Aa);nc=nc?this.zZh(nc):-1;if(2===Ab.type||1===Ab.type&&-1!==nc&&!this.eca[nc].visible)this.s$d(Aa);else if(1===Ab.type)this.X2a(),this.JWb=!1;else if(3===
Ab.type){if(this.aif(Ab.Po))return;this.JWb||this.X2a()}this.raiseEvent(ad.zU,Ab)}aif(Aa){Aa=Mf.Esf(Aa);let Ab=!1;for(const nc of this.eca)if(ag.a.HQa(nc.element,Aa)){Ab=!0;break}return this.kBa!==Aa&&ag.a.HQa(this.kBa,Aa)||Ab}kEj(Aa,Ab=0){const nc=this.eFm(Aa);nc&&0>=Aa.y5a?this.eca[Ab].hide():nc?this.s$d(Aa):this.eca[Ab].hide()}zZh(Aa){let Ab=0;for(const nc of this.KK){if(Aa===nc)return Ab;Ab++}return-1}eFm(Aa){const Ab=this.zZh(Aa);return!!this.amh&&Aa===this.amh&&-1!==Ab&&this.eca[Ab].visible}Nbg(Aa){this.fMa=
Aa===this.imageDimension?1:Math.floor(Aa/this.Yie);this.zla?(this.element.style.height=Aa+"px",this.element.style.width=this.imageDimension+"px"):(this.element.style.width=Aa+"px",this.element.style.height=this.imageDimension+"px")}static Zhb(){return String.format("{0}-{1}","presencetooltip",Mf.rwc++)}static Esf(Aa){Aa=Aa.Hb.rawEvent;return Aa.relatedTarget||Aa.toElement}}Mf.rwc=0;Object(l.a)(Mf,"PresenceTooltipControl",Bc,[1065,10]);class Zg{constructor(Aa){this.Sf=Aa;this.Sf.wNa(10,Me.a.instance);
this.Sf.wNa(9,Ad.a.instance);this.Sf.wNa(6,16);this.Sf.wNa(13,af.a.instance)}D$e(Aa){return new Mf(Aa,16,this.Sf)}}Object(l.a)(Zg,"PresenceTooltipFactory",null,[1064]);var zf=c(255),ii=c(113),Af=c(55),jg=c(6),Rf=c(5),lj=c(18),Qh=c(78),ei=c(516),cl=c(306),ul=c(110);class qi extends Sys.EventArgs{constructor(Aa,Ab){super();this.paragraphId=Aa;this.cZm=Ab}}Object(l.a)(qi,"PresenceControlRenderedEventArgs",Sys.EventArgs,[]);class Jg extends Bc{constructor(Aa,Ab,nc,Kc,hd,Rd=null,kc=null){super(null);this.mmd=
this.an=null;this.XYc=!1;this.Fra=0;this.yp=Aa;this.LDc=Ab;this.us=nc;this.qj=Kc;this.mKa=hd;Jg.bvb=0;this.urh=new vb.a;this.Rcj=new vb.a;this.IW=Rd;this.Ga=kc;this.x1j=this.Ga.lc("PresenceIpRenderedFloodgateTimeLapseSec",30);this.rlk=this.Ga.lc("PresenceIpRenderedFloodgateTriggerThreshold",3);this.wsa=0}get n5a(){return m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}Zuk(Aa){this.addHandler("CR",Aa)}C$i(Aa){this.removeHandler("CR",Aa)}Lbe(){this.raiseEvent("CR",new qi(this.yp.ip.paragraphId,
this.XYc))}fPf(){if(Object(ul.a)(ze,this.an)){const Aa=Object(y.a)(ze,this.an);Jg.bvb=0<Jg.bvb?Jg.bvb+1:Aa.F0a+1;Aa.zIndex=Jg.bvb;this.element.style.zIndex=String(Jg.bvb)}}Y3n(){if(Object(ul.a)(ze,this.an)){const Aa=Object(y.a)(ze,this.an);Jg.bvb=Aa.F0a;Aa.zIndex=Aa.F0a;this.element.style.zIndex=String(Aa.F0a)}}BJi(){this.IW&&!this.ALo()&&this.IW.continueWith(()=>{this.IW.result.logActivity("PresenceIpRendered","PresenceIpRenderedFloodgateEnabled",this.x1j)&&this.wsa++})}ALo(){return this.wsa>=this.rlk}static VIi(){Jg.oUg||
(Jg.oUg=!0,k.ULS.sendTraceTag(4006594,302,50,"First presence ip rendered on the page"))}static Zhb(Aa){return Jg.ium+Aa.s9h()}}Jg.T1i="data-presence-control";Jg.KYi="OverlayControlElementOwner";Jg.ium="ipId_";Jg.U1i="WacPresence";Jg.iwn="PresenceIpPaddingDiv";Jg.oUg=!1;Jg.bvb=0;Object(l.a)(Jg,"APresenceControl",Bc,[1256,10]);class xi{constructor(){this.rotation=this.height=this.width=this.top=this.left=0;this.F7a=!1}}Object(l.a)(xi,"PresenceImageControlStyle",null,[1255]);class Fj extends Jg{constructor(Aa,
Ab,nc,Kc,hd,Rd=null,kc=null){super(Aa,Ab,nc,Kc,hd,Rd,kc);this.PJ=()=>{this.MNi();return!1};this.$7d=ff=>{this.an&&3===ff.hg&&(2!==this.Fra?(this.fPf(),this.IQb()):this.MNi());return!1}}K6a(Aa){this.an&&this.an.K6a(Aa)}aoe(){return this.an?this.an.B$d.length:0}updatePosition(Aa){if(this.element&&this.element.parentNode){var Ab=this.Q9h(Aa);if(Ab){var nc=Sys.UI.DomElement.getBounds(this.element.parentNode),Kc,hd;({left:nc,top:Kc,height:hd,width:Ab}=this.u8l(Ab,nc,this.element.parentNode,this.qj.instance));
this.element.style.top=Kc+"px";this.element.style.left=nc+"px";this.element.style.height=hd+"px";this.element.style.width=Ab+"px";nc=this.Y9h(Aa);bf.a.G5(this.element,nc);Aa=this.fqf(Aa,this.yp.ip.shapeId);this.nmj(nc,Ab,this.isSelected(Aa),m.AFrameworkApplication.isRtl);this.IQb()}}}YY(){this.element&&(ag.a.ox(this.element),this.an.K6a(this.yp.user.clientId),this.Lbe())}sGh(Aa,Ab,nc,Kc){Ab=new xi;if(!Kc||!nc)return Ab;nc=this.Q9h(Aa);if(!nc)return Ab;Ab.top=nc.y;Ab.left=nc.x;Ab.height=nc.height;
Ab.width=nc.width;Ab.rotation=this.dam(Aa);Ab.F7a=!0;return Ab}Baj(Aa,Ab,nc,Kc){Jg.VIi();this.mmd=Aa;if(Kc){const hd=this.fqf(Aa,this.yp.ip.shapeId);if(!hd)return;const Rd=!this.element;Rd&&this.H$e(Ab.ownerDocument,Aa);Rd||!this.element.parentNode?hd.appendChild(this.element):this.element.parentNode!==hd&&(this.element.parentNode.removeChild(this.element),hd.appendChild(this.element));this.an.ega(this.yp.user);this.element.style.borderColor=this.yp.user.color;this.element.id=Jg.Zhb(this.yp);nc.F7a&&
(this.element.style.height=nc.height+"px",this.element.style.top=nc.top+"px",this.element.style.left=nc.left+"px",this.element.style.width=nc.width+"px",bf.a.G5(this.element,nc.rotation),bf.a.G5(this.an.element,-1*nc.rotation),this.nmj(nc.rotation,nc.width,this.isSelected(hd),m.AFrameworkApplication.isRtl),this.IQb())}this.XYc=!Kc;this.Lbe()}dam(Aa){return this.element&&this.element.parentNode&&this.Vei(bf.a.getTransform(this.element.parentNode))?this.Vei(bf.a.getTransform(this.element)):this.Y9h(Aa)}Vei(Aa){return Aa&&
-1<Aa.indexOf("deg")&&(Aa=parseInt(Aa.substring(Aa.indexOf("(")+1,Aa.indexOf("deg"))),!isNaN(Aa))?Aa:0}JDj(Aa){this.element.style.borderColor=this.yp.user.color;this.element.id=Jg.Zhb(this.yp);this.updatePosition(Aa)}H$e(Aa,Ab){this.element=Aa.createElement("div");this.element.setAttribute(Jg.T1i,!0);ii.a.Nl(this.element,Jg.KYi,this);this.element.className=Fj.sEn;(Aa=Ab.Bb)&&Aa.UQ&&(this.element.style.pointerEvents="none");this.element.dir=m.AFrameworkApplication.isRtl?"rtl":"ltr";this.an=this.LDc.D$e(this.createElement("div"),
!0);this.an.ega(this.yp.user);this.an.hide();this.us.ob(Ze.a.pointerOut,this.an.element,this.PJ);this.us.ob(Ze.a.pointerDown,this.an.element,this.$7d);this.an.element.classList.add(Jg.U1i);this.element.appendChild(this.an.element)}u8l(Aa,Ab,nc,Kc){let hd=Aa.y,Rd=Aa.x,kc=Aa.height;Aa=Aa.width;(1<Math.abs(Ab.width-nc.offsetWidth)||1<Math.abs(Ab.height-nc.offsetHeight))&&Kc&&(hd=Math.round(hd/Kc.ij),Rd=Math.round(Rd/Kc.ij),kc=Math.round(kc/Kc.ij),Aa=Math.round(Aa/Kc.ij));return{left:Rd,top:hd,height:kc,
width:Aa}}isSelected(Aa){return Aa.classList.contains(cl.a.$5b)}nmj(Aa,Ab,nc,Kc){this.an.element.style.left="auto";this.an.element.style.top="auto";this.an.element.style.right="auto";this.an.element.style.bottom="auto";nc=nc?Math.round(.5*Fj.Era)+Fj.lJo:0;0<=Aa&&90>Aa||360===Aa?(this.an.element.style.top=-.5*Fj.Era-nc+"px",Kc?this.an.element.style.right=Ab-.5*Fj.Era+"px":this.an.element.style.left=Ab-.5*Fj.Era+"px"):90<=Aa&&180>Aa?(this.an.element.style.left=-.5*Fj.Era-nc+"px",Kc?this.an.element.style.bottom=
-.5*Fj.Era+"px":this.an.element.style.top=-.5*Fj.Era+"px"):180<=Aa&&270>Aa?(this.an.element.style.bottom=-.5*Fj.Era-nc+"px",Kc?this.an.element.style.left=Ab-.5*Fj.Era+"px":this.an.element.style.right=Ab-.5*Fj.Era+"px"):(this.an.element.style.right=-.5*Fj.Era-nc+"px",Kc?this.an.element.style.top=-.5*Fj.Era+"px":this.an.element.style.bottom=-.5*Fj.Era+"px")}xl(Aa,Ab){const nc=this.gRd(Aa,Ab);return nc?nc.properties:(Aa=this.W9h(Aa,Ab))?Aa.properties:null}fqf(Aa,Ab){var nc=this.gRd(Aa,Ab);return nc&&
(nc=nc.Fwa(Aa.Tg,Aa))?nc.element:(Ab=this.W9h(Aa,Ab))?Object(y.a)(ei.a,Ab).pe(Aa.$b).htmlElement:null}gRd(Aa,Ab){Aa=Qh.i(Aa.Bb,5);for(const nc of Aa)if(nc.properties.getValue(jg.a.Pgb)===Ab)return nc;return null}W9h(Aa,Ab){Aa=Rf.GraphIterator.eb(Aa.Bb);let nc=Aa.Ub(6);for(;nc;){const Kc=nc.properties.getValue(jg.a.Pgb);if(lj.ImageReader.Jt(nc)&&Kc===Ab)return nc;nc=Aa.Jf(6)}return null}pZl(Aa){const Ab=Af.a.jf(lj.ImageReader.iF(Aa),0);Aa=Af.a.jf(lj.ImageReader.EG(Aa),1);return{Bka:Ab,Orm:Aa}}Y9h(Aa){Aa=
this.xl(Aa,this.yp.ip.shapeId);return lj.ImageReader.h0(Aa)}Q9h(Aa){var Ab=this.yp.ip;if(!Ab||!Ab.shapeId)return null;var nc=this.xl(Aa,Ab.shapeId);const Kc=this.fqf(Aa,Ab.shapeId);if(!nc||!Kc)return null;const hd=lj.ImageReader.vi(nc);let Rd=Aa=1,kc;({Bka:Ab,Orm:kc}=this.pZl(nc));Ga.App.instance&&Ga.App.instance.HU(hd)?(nc=lj.ImageReader.loa(nc),Aa=Af.a.jf(nc[0],0),Rd=Af.a.jf(nc[2],1)):nc.hasProperty(jg.a.Gda)?(nc=nc.getValue(jg.a.Gda),Aa+=Af.a.jf(nc[0],0),Rd+=Af.a.jf(nc[2],1)):(Aa+=0<Kc.offsetWidth?
(Kc.offsetWidth-Ab)/2:2,Rd+=0<Kc.offsetHeight?(Kc.offsetHeight-kc)/2:2);return new Sys.UI.Bounds(Math.round(Aa),Math.round(Rd),Math.round(Ab),Math.round(kc))}MNi(){this.an&&(this.an.rlc(),this.Fra=1)}IQb(){for(const Aa of this.an.B$d)if(Aa.clientId===this.yp.user.clientId&&!Aa.equals(this.yp.user)){this.an.ega(this.yp.user);break}if(this.yp.hUa||2===this.Fra)this.an.X9c(),this.yp.hUa=!1,this.yp.Wca=!0,this.Fra=2;this.yp.Wca&&1!==this.Fra||(this.an.rlc(),this.yp.Wca=!0,this.Fra=1)}}Fj.sEn="WACImgPresenceHighlight";
Fj.Era=20;Fj.lJo=6;Object(l.a)(Fj,"PresenceImageControl",Jg,[]);var km=c(277);class hg{constructor(){this.height=this.top=this.left=this.oti=0;this.F7a=!1;this.ZB=this.Jh=null}}Object(l.a)(hg,"PresenceIpControlStyle",null,[1255]);var Wg=c(63);class ej extends Jg{constructor(Aa,Ab,nc,Kc,hd,Rd=null,kc=null,ff=null){super(Aa,Ab,nc,Kc,hd,Rd,kc);this.RCc=this.kXa=this.Q_b=null;this.GP=bd=>{!this.an||this.n5a&&!this.an.aif(bd)||(this.fPf(),this.Gee(bd));this.JDj(this.mmd);return!1};this.PJ=()=>{this.an&&
this.vR();return!1};this.$7d=bd=>{this.an&&3===bd.hg&&(2!==this.Fra?(this.fPf(),this.Gee(bd)):this.vR());return!1};this.zD=ff}H$e(Aa){this.element=Aa.createElement("div");this.element.setAttribute(Jg.T1i,!0);ii.a.Nl(this.element,Jg.KYi,this);this.element.className=Jg.iwn;this.element.dir=m.AFrameworkApplication.isRtl?"rtl":"ltr";this.us.ob(Ze.a.pointerOver,this.element,this.GP);this.n5a&&(this.us.ob(Ze.a.pointerOut,this.element,this.PJ),this.us.ob(Ze.a.pointerDown,this.element,this.$7d));this.kXa=
this.createElement("div");this.kXa.className=ej.tEn;this.n5a||(this.RCc=this.createElement("div"),this.RCc.className=ej.wEn,this.kXa.appendChild(this.RCc));this.an=this.LDc.D$e(this.createElement("div"),this.n5a);Aa=this.Ga.$("NoPresenceUserLookUpBeforeRender");this.zD&&!Aa&&(this.yp.user=this.zD.DMf(this.yp.user.clientId)||this.yp.user);this.an.ega(this.yp.user);this.an.hide();this.an.element.classList.add(this.n5a?Jg.U1i:ej.Ezn);this.kXa.appendChild(this.an.element);this.element.appendChild(this.kXa)}Eil(){this.Q_b&&
(Xb.a.instance.Ze(this.Q_b),this.Q_b=null)}IQb(Aa){for(var Ab of this.an.B$d)if(Ab.clientId===this.yp.user.clientId&&!Ab.equals(this.yp.user)){this.an.ega(this.yp.user);break}Ab=!1;ej.sgl===this.yp.user.color?({value:Ab}=this.urh.Fc(this.yp.user.clientId,!1),Ab||(this.urh.Z(this.yp.user.clientId,!0),k.ULS.sendTraceTag(17954772,302,50,'{ "ClientID" : "'+this.yp.user.clientId+'" , "Event" : "RenderGrayPawn"}'))):({value:Ab}=this.Rcj.Fc(this.yp.user.clientId,!1),Ab||(this.Rcj.Z(this.yp.user.clientId,
!0),k.ULS.sendTraceTag(17954773,302,50,'{ "ClientID" : "'+this.yp.user.clientId+'" , "Event" : "RenderColoredPawn"}')));return Aa||this.yp.hUa||2===this.Fra?(this.BJi(),this.an.X9c(),this.yp.hUa=!1,this.yp.Wca=!0,this.Fra=2,ej.THo):this.yp.Wca&&1!==this.Fra?0:(this.BJi(),this.an.rlc(),this.yp.Wca=!0,this.Fra=1,ej.SHo)}Gee(Aa=null){this.Eil();const Ab=this.IQb(!!Aa);this.n5a&&Aa&&Aa.eventName===Ze.a.pointerOver||this.D9n(Ab)}vR(){this.an&&this.Fra&&(this.Y3n(),this.an.hide(),this.Fra=0)}D9n(Aa){this.Q_b=
new oa.a(2,1,Aa,()=>{this.Q_b=null;this.vR()},56);Xb.a.instance.Xb(this.Q_b)}updatePosition(Aa){if(this.element&&this.element.parentNode){var Ab=this.F$h(Aa);if(Ab){Aa=Sys.UI.DomElement.getBounds(this.element.parentNode);Ab=new Sys.UI.Bounds(Ab.x-Aa.x,Ab.y-Aa.y,ej.sti,Ab.height);var nc;({left:Aa,top:Ab,height:nc}=this.x8l(Ab,Aa,this.element.parentNode,this.qj.instance));this.element.style.height=2*ej.Ugc+nc+"px";this.element.style.top=Ab-ej.Ugc+"px";this.element.style.left=Aa-ej.Ugc+"px";this.kXa.style.height=
Math.max(ej.BNi,nc)+"px";this.Gee()}}}YY(){this.element&&(ag.a.ox(this.element),this.Lbe())}sGh(Aa,Ab,nc,Kc,hd){const Rd=new hg;if(!Kc||!nc)return Rd;Kc=this.F$h(Aa);if(!Kc)return Rd;var kc=nc;nc=Aa;if(Aa.Wj){var ff=Aa.mc;kc=Aa.Lg.l$b(this.yp.ip.e$.cp);0>kc&&0==kc;Aa.mc.oxa?ag.a.HQa(ff.editingElement,Aa.Lg.Oi.J(kc))||(nc=Wg.InteractiveViewManager.instance.zd.vj(Aa.source),Ab=nc.Lg.Oi.J(kc)):Ab=nc.Lg.Oi.J(kc);kc=Ab.getBoundingClientRect()}kc=new Sys.UI.Bounds(Kc.x-kc.x,Kc.y-kc.y,ej.sti,Kc.height);
Aa=kc.y;Kc=kc.x;kc=kc.height;ff=this.qj.instance;hd&&ff&&(hd=ff.ij,Aa=Math.round(Aa/hd),Kc=Math.round(Kc/hd),kc=Math.round(kc/hd));Rd.top=Aa-ej.Ugc;Rd.left=Kc-ej.Ugc;Rd.height=2*ej.Ugc+kc;Rd.oti=Math.max(ej.BNi,kc);Rd.F7a=!0;Rd.Jh=Ab;Rd.ZB=nc;return Rd}Baj(Aa,Ab,nc,Kc){Jg.VIi();this.mmd=Aa;Aa=nc.Jh;Ab=nc.ZB;if(Aa&&Ab){if(Kc){const hd=!this.element;hd&&this.H$e(Aa.ownerDocument);hd||!this.element.parentNode?Aa.appendChild(this.element):this.element.parentNode!==Aa&&(this.element.parentNode.removeChild(this.element),
Aa.appendChild(this.element));this.mmd=Ab;Aa=this.yp.user.color;this.kXa.style.borderColor=Aa;this.n5a||(this.RCc.style.borderColor=Aa);this.element.id=Jg.Zhb(this.yp);nc.F7a&&(this.element.style.height=nc.height+"px",this.element.style.top=nc.top+"px",this.element.style.left=nc.left+"px",this.kXa.style.height=nc.oti+"px",this.Gee())}this.XYc=!Kc;this.Lbe()}else k.ULS.sendTraceTag(520950942,302,50,`Skip IpControl rendering due to paragraphElement is null:${!Aa} or paragraphViewElement is null:${!Ab}`)}dispose(){this.element&&
(this.YY(),this.us.sc(Ze.a.pointerOver,this.element,this.GP),this.n5a&&(this.us.sc(Ze.a.pointerOut,this.element,this.PJ),this.us.sc(Ze.a.pointerDown,this.element,this.$7d)),Qd.a.gC(this.an),this.element=this.an=null);super.dispose()}JDj(Aa){const Ab=this.yp.user.color;this.kXa.style.borderColor=Ab;this.n5a||(this.RCc.style.borderColor=Ab);this.element.id=Jg.Zhb(this.yp);this.updatePosition(Aa)}x8l(Aa,Ab,nc,Kc){let hd=Aa.y,Rd=Aa.x;Aa=Aa.height;(1<Math.abs(Ab.width-nc.offsetWidth)||1<Math.abs(Ab.height-
nc.offsetHeight))&&Kc&&(hd=Math.round(hd/Kc.ij),Rd=Math.round(Rd/Kc.ij),Aa=Math.round(Aa/Kc.ij));return{left:Rd,top:hd,height:Aa}}F$h(Aa){const Ab=this.yp.ip;if(!Ab)return null;let nc;try{const Kc=Ab.e$.cp;nc=km.a.E_(Kc,Aa,0<Kc,!1,!1,!1)}catch(Kc){k.ULS.sendTraceTag(4301318,302,15,"Could not determine the bounds of IP: isYielding={0} message={1} stack={2}",Xb.a.instance.Qv,Kc.message,Kc.stack),nc=null}return nc}}ej.Ezn="WacPawn";ej.sti=2;ej.SHo=7E3;ej.THo=2E3;ej.Ugc=5;ej.tEn="presenceIp";ej.wEn="PresenceSmallBox";
ej.BNi=10;ej.sgl="0xcccccc";Object(l.a)(ej,"PresenceIpControl",Jg,[]);class tm{constructor(Aa,Ab,nc,Kc,hd=null,Rd=null,kc=null){this.Csc={};this.zsc={};this.vNg={};this.LDc=Aa;this.us=Ab;this.fn=nc;this.mKa=Kc;this.IW=hd;this.Ga=Rd;this.zD=kc}get Yel(){return this.Csc}get zNh(){return this.zsc}t8l(Aa){const Ab=!!this.Ga&&this.Ga.$("PeoplesWellExtraButtonInfoIsEnabled");return Aa.ip.shapeId&&Ab?this.y8l(Aa):this.z8l(Aa)}y8l(Aa){const Ab=Aa.ip.shapeId.toString();this.vNg[Aa.user.clientId]=Ab;const nc=
this.zsc[Ab];return nc?(nc.yp=Aa,{returnValue:nc,Zne:!0}):{returnValue:this.zsc[Ab]=new Fj(Aa,this.LDc,this.us,this.fn,this.mKa,this.IW,this.Ga),Zne:!1}}z8l(Aa){const Ab=Aa.user.clientId,nc=this.Csc[Ab];return nc&&nc.yp.user.equals(Aa.user)?(nc.yp=Aa,{returnValue:nc,Zne:!0}):{returnValue:this.Csc[Ab]=new ej(Aa,this.LDc,this.us,this.fn,this.mKa,this.IW,this.Ga,this.zD),Zne:!1}}G$h(Aa){return this.Csc[Aa]}lZl(Aa){return(Aa=this.zsc[this.vNg[Aa]])&&!Aa.aoe()?Aa:null}Znl(){var Aa=this.Csc;for(const Ab in Aa)Aa[Ab].dispose();
Aa=this.zsc;for(const Ab in Aa)Aa[Ab].dispose()}}Object(l.a)(tm,"PresenceControlProvider",null,[]);var nl=c(161);class Pg{constructor(){this.tcb=0}wbi(){this.tcb++;this.tcb===Number.MAX_VALUE&&(this.tcb=1);return this.tcb}static get instance(){return Pg.Xzc}}Pg.Xzc=new Pg;Object(l.a)(Pg,"PacketIdGenerator",null,[156]);class fi{constructor(Aa,Ab,nc){this.Q9n=Aa;this.Qvm=Ab;this.qEi=nc}}Object(l.a)(fi,"SuccessfulInboundReplicationCallbackData",null,[]);class Em{constructor(Aa,Ab,nc,Kc,hd,Rd,kc){this.y7n=
(ff,bd)=>{bd.type||(ff=this.Pk.nUh>=this.P_j,this.Hkk&&ff?(ff=this.FBe())?ff.gWh():k.ULS.sendTraceTag(19682513,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt."):this.fF())};this.ksn=ff=>{if(ff=Object(y.a)(fi,ff)){var bd=ff.Qvm.li.toString(),Sf=this.FBe(),Te=Sf.Lt,bi="";Te!==ff.qEi&&(k.ULS.sendTraceTag(19964236,500,50,"Time saved due to force inbound on update notification message = {0} ms",ff.Q9n.toString()),bi=this.L3l(Sf,Te,ff.qEi));k.ULS.sendTraceTag(19964237,
500,50,"Revisions: {0}, InboundDuration: {1}",bi,bd)}else k.ULS.sendTraceTag(19964235,500,10,"The callback data was null")};this.q7n=Aa;this.FBe=Ab;this.Pk=nc;this.Hkk=hd;this.P_j=Rd;this.TXb=Kc;this.Xp=kc;this.q7n.G3(this.y7n)}fF(){const Aa=this.FBe();if(!Aa)k.ULS.sendTraceTag(19682514,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt.");else if(!this.TXb()&&Aa.xRa){const Ab=this.Xp.Vf("Task","ShoulderTapInboundReplicationTimer");Aa.fF(this.ksn,null,new fi(-1,Ab,
Aa.Lt))}}L3l(Aa,Ab,nc){const Kc=new Sys.StringBuilder;Aa=Aa.node.vd.store.getRevision(Ab);if(!Aa)return k.ULS.sendTraceTag(19964238,500,10,"The revision we got from the last replicator revisionId was null - {0}",{["lastRevisionId"]:Ab}),"";for(Kc.append(Aa.id.guid);Ab!==nc;){Kc.append(", ");Kc.append(Ab.guid);Aa=Aa.Bn;if(!Aa)break;Ab=Aa.id}return Kc.toString()}}Object(l.a)(Em,"ContentNotificationManager",null,[]);class kg extends Em{constructor(Aa,Ab,nc,Kc,hd,Rd,kc){super(Aa,Ab,nc,Kc,hd,Rd,kc)}static get Xqa(){return null!=
kg.UEg?kg.UEg:kg.UEg=Na.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){if(Ga.App.za){var Aa=Ga.App.za.jb;Aa&&(Aa.fga(kg.Z0c),Aa=Aa.Yc)&&(kg.Dv=Aa.contentReplicator,kg.Dv&&Ga.App.Foa().continueWith(kg.xUf))}}static xUf(){kg.dhd=Ga.App.Foa().result;kg.dhd&&kg.dhd.So&&kg.Xqa.XD().continueWith(kg.J1c)}static J1c(){kg.fj=kg.Xqa.XD().result;if(kg.fj){var Aa=m.AFrameworkApplication.K,Ab=Aa.$("Box4ThrottleInboundRequests");Aa=Aa.lc("Box4ThrottleInboundsAtUserCount",20);kg.Dv.lTd=()=>
kg.fj.LRa;kg.ahd=kg.ahd||new kg(kg.fj,()=>kg.Dv,kg.dhd,()=>m.AFrameworkApplication.Lk,Ab,Aa,Ga.App.za.Iq);kg.ahd.fF()}}static Z0c(Aa){kg.ahd||(Aa.Dob(kg.Z0c),kg.init())}}kg.ahd=null;kg.fj=null;kg.Dv=null;kg.dhd=null;Object(l.a)(kg,"WordContentNotificationManager",Em,[]);var aj=c(57);class Ri{constructor(Aa,Ab,nc,Kc,hd,Rd){this.Yhd=null;this.$$g=Aa;this.ud=nc;this.jMa=Kc;this.fz=hd;this.vh=Rd;this.Nrb=Ab}clone(){return new Ri(this.$$g,this.Nrb.clone(),this.ud,this.jMa,this.fz,this.vh)}get cp(){if(null!=
this.Yhd)return this.Yhd;var Aa=this.$$g.paragraphId;if(Aa.equals(Nc.a.nil))return 0;var Ab=this.jMa();if(!Ab)return 0;Aa=Ab.Eb(Aa);if(!Aa)return k.ULS.sendTraceTag(7685326,302,15,"Paragraph Node is null so returning a CP with value 0"),0;Ab=this.ud.wCb(this.ud.CSa(Aa.characterData,Aa.qa),this.Nrb);if(aj.a.Sj&&this.fz){var nc=tb.a.Oc(Aa,Ab);this.vh&&Aa.Gs&&(nc.Fb=this.vh.fSd(Aa,Ab,this.Nrb.kva));Ab=this.fz.Oba(nc,!0)}else this.fz&&this.vh&&Aa.Gs&&(nc=tb.a.Oc(Aa,Ab),nc.Fb=this.vh.fSd(Aa,Ab,this.Nrb.kva),
Ab=this.fz.Oba(nc,!0));return Ab}JWf(){null==this.Yhd&&(this.Yhd=this.cp)}equals(Aa){return Aa?this.Nrb.isEqual(Aa.Nrb,!1):!1}}Object(l.a)(Ri,"WordPresenceCp",null,[175,46,176]);class Qk{constructor(Aa,Ab){this.fz=Aa;this.vh=Ab}create(Aa,Ab,nc,Kc){return new Ri(Aa,Ab,nc,Kc,this.fz,this.vh)}}Object(l.a)(Qk,"Factory",null,[155]);class dl extends Sys.EventArgs{constructor(Aa,Ab,nc){super();this.paragraphId=Aa;this.presence=Ab;this.WBf=nc}}Object(l.a)(dl,"ParagraphChangedEventArg",Sys.EventArgs,[]);class dm{constructor(Aa){this.cp=
Aa}equals(Aa){return Aa?this.cp===Aa.cp:!1}clone(){return new dm(this.cp)}}Object(l.a)(dm,"PresenceCp",null,[175,46]);class xn{constructor(Aa,Ab,nc,Kc,hd){this.paragraphId=Aa;this.cp=Ab;this.length=nc;this.shapeId=Kc;this.dryDeletion=hd}}Object(l.a)(xn,"SerializablePresenceIpData",null,[]);class ah{constructor(Aa,Ab,nc,Kc=0,hd=0){this.zta=null;Aa&&(this.zta=Nc.a.Ff(Aa));this.Z$g=new dm(Ab);this.uHa=nc;this.Beh=Kc;this.ZRg=hd}get paragraphId(){return this.zta}get e$(){return this.Z$g}get shapeId(){return this.Beh}get dryDeletion(){return this.ZRg}isValid(){return 0<=
this.e$.cp&&!!this.paragraphId&&!this.paragraphId.equals(Nc.a.nil)}getData(){return new xn(this.paragraphId.toString(),this.e$.cp,this.uHa,this.shapeId,this.dryDeletion)}clone(){const Aa=new ah;Aa.zta=this.paragraphId;Aa.Z$g=this.e$?this.e$.clone():null;Aa.uHa=this.uHa;Aa.Beh=this.shapeId;Aa.ZRg=this.dryDeletion;return Aa}static BCb(Aa){return Aa.paragraphId&&void 0!==Aa.cp&&null!==Aa.cp&&void 0!==Aa.length&&null!==Aa.length?new ah(Aa.paragraphId,Aa.cp,Aa.length,void 0,Aa.dryDeletion):null}}Object(l.a)(ah,
"PresenceIp",null,[158,46]);class Tn{constructor(Aa,Ab){this.ip=Aa;this.user=Ab}}Object(l.a)(Tn,"SerializablePresenceData",null,[]);class Jj{constructor(Aa,Ab){this.hUa=this.Wca=this.Zec=!1;this.jXa=Ab;this.user=Aa}get ip(){return this.jXa}gtf(){return new Tn(this.ip?this.ip.getData():null,this.user.getData())}s9h(){return this.user.clientId+(this.jXa?this.jXa.paragraphId.toString():Nc.a.nil.toString())}isValid(){const Aa=!!this.user&&this.user.isValid(),Ab=!this.ip||this.ip.isValid();return Aa&&
Ab}clone(){const Aa=new Jj;Aa.user=this.user?this.user.clone():null;Aa.jXa=this.jXa?this.jXa.clone():null;Aa.Wca=this.Wca;Aa.Zec=this.Zec;Aa.hUa=this.hUa;return Aa}static BCb(Aa){return Aa?new Jj(bb.BCb(Aa.user),Aa.ip?ah.BCb(Aa.ip):null):null}}Object(l.a)(Jj,"PresenceInfo",null,[188,46]);class Yi extends Ka.a{constructor(){super();this.iAc={};this.WVa={};this.iUg=!1}get pxn(){return this.iAc}get dzi(){return!!m.AFrameworkApplication.K&&m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}Wph(Aa){this.addHandler("PPC",
Aa)}haj(Aa){this.removeHandler("PPC",Aa)}EQc(Aa){return Aa.ip.paragraphId.toString()}fZe(Aa,Ab=!1){this.iUg||(this.iUg=!0,k.ULS.sendTraceTag(4289312,302,50,"First presence added to data manager"));var nc=({uEn:Kc}=this.xUm(Aa)).returnValue;if(Kc&&!Ab)(nc=this.WVa[Aa.user.clientId])&&0<=nc.length&&(nc[nc.length-1].ip.uHa=Aa.ip.uHa);else{nc||this.X9i(Aa.user.clientId);this.dzi&&nc&&this.sUo(Aa);Ab=this.EQc(Aa);var Kc=Aa.user.clientId;var hd=this.iAc[Ab]||[],Rd=this.WVa[Kc]||[];Rd.length>=Yi.kMi&&(Rd=
Rd.splice(-Yi.Lgn,Yi.kMi));nc||hd.push(Kc);Rd.push(Aa);this.iAc[Ab]=hd;this.WVa[Kc]=Rd;Aa.ip.paragraphId.equals(Nc.a.nil)||this.d4f(Aa.ip.paragraphId,Aa,!0)}}xUm(Aa){var Ab=this.WVa[Aa.user.clientId];const nc=!Ab||0>=Ab.length?null:Ab[Ab.length-1],Kc=!!nc&&this.EQc(nc)===this.EQc(Aa);Ab=Kc&&nc.ip.e$.equals(Aa.ip.e$)&&nc.user.equals(Aa.user);this.dzi&&Ab&&nc.ip.shapeId&&Aa.ip.shapeId&&nc.ip.shapeId!==Aa.ip.shapeId&&(Ab=!1);return{returnValue:Kc,uEn:Ab}}sUo(Aa){const Ab=this.kfl(Aa);Ab&&Ab.ip.shapeId&&
(Aa.ip.shapeId&&Aa.ip.shapeId===Ab.ip.shapeId||this.d4f(Ab.ip.paragraphId,Ab,!1))}kfl(Aa){Aa=this.WVa[Aa.user.clientId];return!Aa||0>=Aa.length?null:Aa[Aa.length-1]}X9i(Aa){const Ab=this.WVa[Aa];if(Ab&&0<Ab.length){const nc=Ab[0].ip.paragraphId,Kc=this.EQc(Ab[0]);delete this.WVa[Aa];this.pYn(Kc,Aa);nc.equals(Nc.a.nil)||this.d4f(nc,Ab[0],!1)}}u5h(Aa){return this.iAc[Aa]}FOc(Aa,Ab,nc,Kc=!1){const hd=[],Rd=this.u5h(Aa);if(!Rd)return hd;for(let kc=0;kc<Rd.length;kc++){const ff=Rd[kc],bd=this.WVa[ff];
let Sf=!1;for(let Te=bd.length-1;0<=Te;Te--){const bi=bd[Te];if(Kc){if(bi.Wca&&bi.ip.paragraphId.equals(Nc.a.Ff(Aa))){Sf=!0;hd.push(bi);break}}else if(Object(ul.a)(Jj,bi)?bi.ip.uHa===Ab:bi.ip.uHa===nc){Sf=!0;bi.Zec=!0;hd.push(bi);this.WVa[ff]=bd.splice(Te,bd.length);break}}!Sf&&0<bd.length&&bd[0].Zec&&bd[0].ip.paragraphId.equals(Nc.a.Ff(Aa))&&hd.push(bd[0])}return hd}oLl(Aa){if(!Aa||!Aa.Pa||!Aa.Pa.node)return null;Aa=this.FOc(Aa.Pa.node.id.toString(),0,0,!0);Aa=this.Qhm(Aa);Aa.sort((Ab,nc)=>{if(!(Ab&&
Ab.userName&&nc&&nc.userName))return k.ULS.sendTraceTag(542165082,302,15,"Missing presence user info for user in PresenceInfos"),0});return Aa}Qhm(Aa){if(!Aa||!Aa.length)return[];const Ab=[],nc=new L.a(J.a.jh());for(let Kc=0;Kc<Aa.length;Kc++){const hd=Aa[Kc].user;hd.isAnonymous&&nc.contains(hd.clientId)||!hd.isAnonymous&&hd.email&&nc.contains(hd.email)||(Ab.push(hd),nc.add(hd.isAnonymous?hd.clientId:hd.email))}return Ab}d4f(Aa,Ab,nc){this.raiseEvent("PPC",new dl(Aa,Ab,nc))}pYn(Aa,Ab){Array.remove(this.iAc[Aa],
Ab)}}Yi.kMi=10;Yi.Lgn=2;Object(l.a)(Yi,"PresenceDataManager",Ka.a,[1203]);class Lm extends Yi{constructor(Aa){super();this.qH=Aa}fZe(Aa,Ab=!1){super.fZe(Aa,Ab)}EQc(Aa){return Aa.ip.Wc.toString()}u5h(Aa){Aa=this.qH.Eb(Nc.a.Ff(Aa));if(!Aa)return null;Aa=Aa.ja(jg.a.Wc,0);return this.pxn[Aa.toString()]}}Object(l.a)(Lm,"WordPresenceDataManager",Yi,[]);var bn=c(1488),zh=c(1076),vg=c(1881),jl=c(17);class Cl{constructor(Aa,Ab,nc,Kc,hd,Rd,kc,ff,bd,Sf,Te,bi,Si,li,yi,lm,bh,ol,zi,fk,eh,Ck,vd,Dd){this.jNa=Array(5);
this.gWe=this._started=this.hRe=!1;this.JNe=null;this.Aah=new L.a(J.a.jh());this.Asd={};this.eGe=!1;this.Uwn=()=>{if(!this.gWe&&!this.tl.Iy){var Ge=new oa.a(0,1,20,()=>{const me=new P.a;var Kj=this.Ccb.Yel;for(var Sl in Kj){const xf=Kj[Sl];xf.XYc&&me.add(xf.yp.ip.paragraphId)}if(this.C5d){Kj=this.Ccb.zNh;for(const xf in Kj)Sl=Kj[xf],Sl.XYc&&!me.contains(Sl.yp.ip.paragraphId)&&me.add(Sl.yp.ip.paragraphId)}this.E3h(me);this.gWe=!1},72);this.Ib.Xb(Ge);this.gWe=!0}};this.QTi=()=>{this.hRe&&(this.Gag(),
this.hRe=!1)};this.j5=(Ge,me)=>{this.Qhj(me.pl.lb)};this.h5=(Ge,me)=>{Ge=me.Ora;for(var Kj in Ge){const Sl=Ge[Kj];this.Ga.$("CashTelemetryIsEnabled")&&this.sMc(Sl,new Date,null);Sl.ip?this.ZYe(Sl):this.X5c(Sl.user.clientId)}me=me.rKd;for(Kj=0;Kj<me.length;++Kj)this.sjl(me[Kj]);this.Xce()};this.KWf=(Ge,me)=>{me.paragraphId?this.vWo(me.paragraphId.toString(),me.cZm,this.Asd):k.ULS.shipAssertTag(8758481,302,!1,"null paraid")};this.V1i=(Ge,me)=>{me.paragraphId&&(Ge=this.MF.Eb(me.paragraphId))&&((Object(ul.a)(Jj,
me.presence)?this.vBe(Ge):this.wBe(Ge))===me.presence.ip.uHa&&this.J9n(me.paragraphId),this.C5d&&this.vEn(me))};this.fw=Aa;this.ib=Kc;this.zD=hd;this.Jxb=Rd;this.tl=bd;this.N_j=Sf;this.Ccb=Te;this.MF=nc;this.fWg=bi;this.vBe=Si;this.wBe=li;this.QSj=kc;this.Q_j=ff;this.dMa=yi;this.Pq=lm;this.Kc=bh;this.Ib=ol;this.Khh=Ck;this.Lek=Dd;this.KNe=fk;this.Ga=eh;this.dsd=Ab;Cl.htd=new vb.a;for(Aa=0;Aa<this.dsd.length;Aa++)this.dsd[Aa].HUn(this);this.Jxb.Wph(this.V1i);this.fw.b_a(this.h5);vd&&this.tl.Cma(this.Uwn);
this.fw.pce(this)}get C5d(){return!!this.Ga&&this.Ga.$("PeoplesWellExtraButtonInfoIsEnabled")}Xce(Aa=!1){this.Khh&&!Aa||this.xaj()}xaj(){const Aa=new P.a,Ab=this.Asd;for(const nc in Ab)Aa.add(Nc.a.Ff(nc));this.E3h(Aa);this.Asd={}}Gag(){this.ib.hb&&this.Qhj(this.ib.hb.lb,!0)}Qhj(Aa,Ab=!1){this.Lek||(this.MF.wm.nia||Ab?Aa?(Ab=this.Fbl(Aa))?this.fw.Oag(Ab):(this.fw.Oag(null),k.ULS.sendTraceTag(4281418,302,50,"Not supported selection context {0}",Aa.Pa.contextId)):this.fw.Oag(null):this.hRe=!0)}Fbl(Aa){if(!this.C5d||
!Aa.slb)if(Aa=jl.SelectionEditor.Fj(Aa,!0,!1),!jl.SelectionEditor.Il(Aa))return null;return this.Jxh(Aa)}Jxh(Aa){const Ab=Aa.Pa.cpBegin,nc=Aa.Pa.node.id;Aa=this.vBe(Aa.Pa.node);return new ah(nc.toString(),Ab,Aa)}sMc(Aa,Ab,nc){if(this.KNe)if(Aa&&Aa.user&&Aa.user.clientId){var Kc=Aa.user.clientId;this.Aah.contains(Kc)||(this.JNe?(this.JNe.sMc(Kc,Ab,null,Cl.oam(nc||Aa.user.client)),this.Aah.add(Kc)):this.KNe.continueWith(()=>{this.JNe=this.KNe.result;this.sMc(Aa,Ab,nc)}))}else k.ULS.sendTraceTag(42262876,
302,15,"invalid presence")}v8l(Aa){const Ab=new P.a;for(let nc=0;nc<Aa.length;nc++)Ab.add(this.Ghm(Aa[nc]));return Ab}ZYe(Aa){var Ab=null;Aa&&Aa.user&&(Ab=Aa.user.client);Aa=Aa.clone();Aa.user=this.zD.DMf(Aa.user.clientId)||Aa.user;this.Ga.$("CashTelemetryIsEnabled")&&this.sMc(Aa,new Date,Ab);Aa.isValid()&&!Aa.user.nL()&&(Ab=Aa.user.clientId,Cl.htd.nb(Ab)||this.tki(Ab),this.jWo(Ab),Aa.user.userName=CommonUIStrings.l_AnonymousUserName);this.Jxb.fZe(Aa,!1)}jWo(Aa){const {value:Ab}=Cl.htd.Fc(Aa,!1);
Ab||(Cl.htd.Z(Aa,!0),k.ULS.sendTraceTag(17954774,302,50,'{ "ClientID" : "'+Aa+'" , "Event" : "CreateAnonymousGrayPawn"}'))}tki(){}X5c(Aa){this.Jxb.X9i(Aa)}sjl(Aa){this.X5c(Aa);const Ab=this.Ccb.G$h(Aa);Ab&&(Ab.C$i(this.KWf),Ab.dispose());this.C5d&&(Aa=this.Ccb.lZl(Aa))&&(Aa.C$i(this.KWf),Aa.dispose())}L9b(Aa){if(12!==Aa.type)return new P.a;Aa=this.Jxb.FOc(Aa.id.toString(),this.vBe(Aa),this.wBe(Aa));return 0>=Aa.length?new P.a:this.v8l(Aa)}vWo(Aa,Ab,nc){!Ab&&Aa in nc&&delete nc[Aa]}dispose(){this.stop();
this.Jxb.haj(this.V1i);this.fw.AOb(this.h5);this.fw.nng(this);for(let Aa=0;Aa<this.dsd.length;Aa++)this.dsd[Aa].fQo(this);Qd.a.t$f([this.QSj,this.Q_j,this.fw]);this.Ccb.Znl()}Ghm(Aa){let Ab=!1;Aa=({Zne:Ab}=this.Ccb.t8l(Aa)).returnValue;Ab||Aa.Zuk(this.KWf);return Aa}zii(Aa){Aa=this.MF.Eb(Aa);if(!Aa)return this.jNa[0]||(k.ULS.sendTraceTag(4281420,302,50,"Could not find the node in object space"),this.jNa[0]=!0),null;if(!Va.ParagraphReader.Wb(Aa))return this.jNa[1]||(k.ULS.sendTraceTag(4281421,302,
50,"Not a paragraph node"),this.jNa[1]=!0),null;if(!Aa.pe(this.tl.$b))return this.jNa[2]||(k.ULS.sendTraceTag(4281422,302,50,"No ViewElement found for this node"),this.jNa[2]=!0),null;if(!Aa.anchor)return this.jNa[3]||(k.ULS.sendTraceTag(4281423,302,50,"node is not anchored"),this.jNa[3]=!0),null;this.jNa[4]||(k.ULS.sendTraceTag(4564931,302,50,"Valid paragraph node found for rendering ip"),this.jNa[4]=!0);return Aa}C9i(Aa){Aa=this.Jxb.FOc(Aa.toString(),-1,-1,!0);if(!Pd.a.Xe(Aa))for(const Ab of Aa)(Aa=
this.Ccb.G$h(Ab.user.clientId))&&Aa.element&&Aa.YY()}E3h(Aa){if(Aa.count){var Ab=new P.a;for(var nc of Aa)(Aa=this.zii(nc))?Ab.add(Aa):this.C9i(nc);if(Ab.count){nc=this.Kc.Pc(2);try{nc.set(this.Pq);for(const Kc of Ab)this.xSh(Kc)}finally{nc&&nc.dispose()}}}}xSh(Aa){Aa.mL(this.tl.$b,32,!0);Aa.mL(this.N_j,32,!0)}J9n(Aa){this.Asd[Aa.toString()]=null;this.Khh&&!this.eGe&&(Aa=new oa.a(0,1,200,()=>{this.eGe=!1;this.xaj()},70),this.Ib.Xb(Aa),this.eGe=!0)}vEn(Aa){if(Aa.presence.ip.shapeId&&!Aa.WBf){var Ab=
this.Ccb.zNh[Aa.presence.ip.shapeId.toString()];Ab&&Ab.K6a(Aa.presence.user.clientId)}}stop(){this._started&&(this._started=!1,this.ib.ZY(this.j5),this.fWg.g_n(this.QTi))}start(){if(!this._started){this._started=!0;this.ib.Sw(this.j5);this.fWg.Gph(this.QTi);var Aa=this.fw.ZEb();delete Aa[this.dMa.clientId];this.h5(null,new vg.a(Aa,[]));this.Gag()}}rie(Aa){if(Aa&&Aa.isValid()&&Aa.ip){var Ab=this.Jxb.FOc(Aa.ip.paragraphId.toString(),-1,-1),nc=!1,Kc=null;for(let hd=0;hd<Ab.length;hd++)if(Kc=Ab[hd],Kc.user.clientId===
Aa.user.clientId){nc=Kc.hUa=!0;break}if(nc)if(Ab=Kc.ip.paragraphId,Aa=this.zii(Ab)){Ab=this.Kc.Pc(2);try{Ab.Db(Aa),this.xSh(Aa)}finally{Ab&&Ab.dispose()}}else this.C9i(Ab)}}static oam(Aa){return Aa?Aa?1===Aa?1:2===Aa?2:0:2:0}}Cl.htd=null;Object(l.a)(Cl,"PresenceManager",null,[1199,10,107,1200,1201,1202]);class um{constructor(Aa,Ab,nc,Kc){this.mVb=null;this._started=this.GEe=!1;this.Kzb=null;this.kqa=(hd,Rd)=>{if(!m.AFrameworkApplication.Lk&&(hd=this.JEj(Rd.pl),this.mVb&&hd)){hd=this.lxe.FOc(this.mVb.toString(),
-1,-1,!0);for(Rd=0;Rd<hd.length;Rd++)this.Kzb[hd[Rd].user.clientId]=hd[Rd];0>=hd.length||(hd=this.g9k(hd),this.Zp.sendNotification(hd,!0))}};this.DVi=(hd,Rd)=>{this.ib.hb&&!m.AFrameworkApplication.Lk&&this.GEe&&this.mVb&&this.mVb.equals(Rd.paragraphId)&&(hd=null,!Rd.WBf||Rd.presence.user.clientId in this.Kzb?Rd.WBf||(hd=this.OLh(Rd.presence.user.userName,!1),delete this.Kzb[Rd.presence.user.clientId]):(hd=this.OLh(Rd.presence.user.userName,!0),this.Kzb[Rd.presence.user.clientId]=Rd.presence),hd&&
this.Zp.sendNotification(hd,!0))};this.fj=Kc;this.ib=Ab;this.lxe=Aa;this.Zp=nc;this.fj.pce(this)}start(){this._started||(this._started=!0,this.Kzb={},this.lxe.Wph(this.DVi),this.ib.Sw(this.kqa),this.JEj(this.ib.hb))}stop(){this._started&&(this._started=!1,this.Kzb=null,this.lxe.haj(this.DVi),this.ib.ZY(this.kqa))}g9k(Aa){if(1===Aa.length)return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphSingle,Aa[0].user.userName);const Ab=[],nc=Aa.length;for(let Kc=0;Kc<nc;Kc++)Ab.push(Aa[Kc].user.userName);
return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphMany,Ab.join(Box4Intl.Box4Strings.l_DisplayNameSeparator))}OLh(Aa,Ab){return String.format(Ab?Box4Intl.Box4Strings.l_UserJoiningParagraph:Box4Intl.Box4Strings.l_UserLeavingParagraph,Aa)}dispose(){this.fj.nng(this);this.stop()}JEj(Aa){if(!Aa)return!1;Aa=Aa.lb;if(!Aa)return!1;Aa=Aa.Pa;if(!Aa)return!1;this.GEe=jl.SelectionEditor.ef(Aa);Aa=Aa.node.id;if(Aa.equals(this.mVb)||!this.GEe)return!1;this.mVb=Aa;this.Kzb={};return!0}}Object(l.a)(um,
"PresenceAccessibilityManager",null,[10,107]);class Qm{constructor(Aa,Ab){this._started=!1;this.sK=null;this.vnd=!1;this.m1c=()=>{this._started&&this.Ahj()};this.fj=Aa;Ab&&(this.sK=Ab,this.sK.qeb(this.m1c));this.fj.pce(this)}start(){this._started||(this._started=!0,this.sK?this.Ahj():this.fj.pN(1,this.sKh()))}Ahj(){const Aa=this.vnd;(this.vnd=!!this.sK.Ux)&&!Aa&&this.fj.pN(1,this.sKh())}sKh(){const Aa={};Aa.Id="{"+m.AFrameworkApplication.userSessionId.toUpperCase()+"}";Aa.HQ=!1;Aa.NT=1;Aa.WEB=!0;
return Aa}stop(){this._started&&(this._started=this.vnd=!1)}dispose(){this.fj.nng(this);this.sK&&this.sK.E$i(this.m1c)}}Object(l.a)(Qm,"EditorsTableNotifier",null,[10,107]);var oj=c(370),ph=c(15);class cd extends Cl{constructor(Aa,Ab,nc,Kc,hd,Rd,kc,ff,bd,Sf,Te,bi,Si,li,yi,lm,bh,ol,zi,fk,eh,Ck,vd,Dd,Ge,me,Kj,Sl,xf,Fl,Wh){super(Aa,Ab,nc,Kc,hd,Rd,kc,ff,bd,Sf,Te,Si,li,yi,lm,zi,fk,eh,Ck,vd,Dd,Ge,me,xf);this.Pk=null;this.esl=we=>{const bo=!!this.Pk.jC.Q8b(we);k.ULS.sendTraceTag(579179741,302,50,"ClientId:{0} isPresentAfterPoll:{1}",
we,bo)};this.dsl=(we,bo)=>{k.ULS.sendTraceTag(579179742,302,15,"EditorsReplicator failed with {0} when looking for ClientId {1}",bo,we)};this.Ria=()=>{if(2===cd.fj.connectionState&&!La.SessionStatusManager.instance.Sca){const we={};we.qs=m.AFrameworkApplication.rootQuerySignature;cd.fj.krb(we)}};bi.fb(ph.a.bvo,Fb.a.application,cd.vsk,64);bi.fb(ph.a.T6f,Fb.a.application,cd.T6f,64);bi.fb(ph.a.C3f,Fb.a.application,cd.C3f,96);bi.fb(Xa.a.rie,Fb.a.application,cd.avo,64);this.MI=bh;this.ud=ol;this.aAb=Kj;
this.dMa.Lhc=Sl;this.dMa.Lhc.hxk(cd.EVi);Fl.continueWith(()=>{this.Pk=Fl.result});k.ULS.sendTraceTag(4006600,302,50,"WordPresenceManager Initialized");(this.m3=Wh)&&this.m3.execute(we=>{we.ZZa(this.Ria)})}Q9b(Aa){if(!Aa||!Aa.anchor)return null;for(Aa=Aa.anchor.Pp;Aa;Aa=Aa.MA)if(Aa.eGa)return Aa.hs.node;return null}Jxh(Aa){var Ab=null;Ab=m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled");var nc=Aa.Pa.cpBegin,Kc=Aa.Pa.node;Ab&&lj.ImageReader.Jt(Kc)&&(Kc=this.Q9b(Kc));if(!Kc)return k.ULS.sendTraceTag(51242309,
302,15,"selectedNode is null"),null;Kc=this.wBe(Kc);const hd=Aa.Pa.node.ja(jg.a.Wc,0);if(!this.MI)return k.ULS.sendTraceTag(35997152,302,15,"paragraphWordIdMapping is null"),null;var Rd=this.MI.value.Pib(hd);const kc=cd.qH.Eb(Rd);if(!kc)return k.ULS.sendTraceTag(16791249,302,15,"Can't find pid "+Rd),null;nc=this.ud.Xoc(this.ud.CSa(kc.characterData,kc.qa),nc);nc.kva=-1===Aa.Pa.Fb?0:Aa.Pa.Fb;Rd=0;Ab&&Aa.slb&&(Rd=this.Xbm(Aa));return Ab=new Se(this.MI.value,hd,Kc,nc,this.ud,()=>cd.qH,this.aAb,Rd)}Xbm(Aa){const Ab=
lj.ImageReader.aFa(Aa.Pa);return Ab?Ab.properties.ja(jg.a.Pgb,0):Aa.Pa.node.properties.ja(jg.a.Pgb,0)}tki(Aa){this.Pk&&this.Pk.Nna&&this.Pk.Nna.fF(this.esl,this.dsl,Aa)}dispose(){this.m3&&this.m3.execute(Aa=>{Aa.zOb(this.Ria)});super.dispose()}static get Tw(){return Na.a.instance.resolve("Common.Utils.IAriaNotifier")}static XD(){return cd.twc.task}static get_instance(){return cd.gtd.task}static A8l(){return cd.aah.task}static get Xqa(){return null!=cd.TEg?cd.TEg:cd.TEg=Na.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){cd.gtd||
(cd.gtd=new x.a);cd.vUg&&(k.ULS.sendTraceTag(4256585,302,50,"WordPresenceManager Init"),cd.vUg=!1);if(Ga.App.za){var Aa=Ga.App.za.jb;Aa?(Aa.fga(cd.Z0c),cd.dAc=Aa.qc,Aa.rpa()?(cd.ZN=Aa.Yc.contentReplicator,cd.ZN?(cd.qH=Aa.Yc.vd,cd.qH?cd.Xqa.XD().continueWith(cd.brn):k.ULS.sendTraceTag(4006599,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to content ObjectSpace of the app")):k.ULS.sendTraceTag(4252228,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to the GraphSpaceReplicator object")):
k.ULS.sendTraceTag(4006598,302,50,"PageView doesn't seem to have been initialized yet. Will try again once we know it's initialized")):k.ULS.sendTraceTag(4006597,302,15,"Can't initialize the WordPresenceManager because workspace is not initialized")}else k.ULS.sendTraceTag(4006596,302,15,"Can't initialize the WordPresenceManager because active AppFrame is not initialized")}static brn(){cd.fj=cd.Xqa.XD().result;if(cd.fj){var Aa=[cd.dAc.g2c,cd.dAc.ve.g2c],Ab=Pb.a.instance,nc=Na.a.instance.resolve("Box4.Presence.WordPresenceDataManager"),
Kc=new um(nc,Ab,cd.Tw,cd.fj),hd=m.AFrameworkApplication.K.$("DoNotAddToEditorsTableOnFrameIsEnabled")?Ga.App.xd.jC:null;hd=new Qm(cd.fj,hd);var Rd=Na.a.instance.Re("WordEditor.IParagraphWordIdMapping"),kc=Na.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),ff=Na.a.instance.resolve("Common.IPeopleInfoProvider");cd._instance=new cd(cd.fj,Aa,cd.qH,Ab,ff,nc,Kc,hd,cd.dAc,cd.dAc.ve.$b,Na.a.instance.resolve("Box4.Presence.PresenceControlProvider"),m.AFrameworkApplication.va,
cd.ZN,Va.ParagraphReader.textLength,Va.ParagraphReader.Ona,Na.a.instance.resolve("Box4.Presence.MyPresenceUser"),Rd,kc,Ga.App.ni.zl,new oj.a,Xb.a.instance,bn.a.get_instance(),Da.a.Bp(Na.a.instance.Ta("Common.App.CoauthTelemetry.IPresenceBootTelemetry")),m.AFrameworkApplication.K,m.AFrameworkApplication.K.$("Box4ThrottleAndBatchPresenceRendering"),m.AFrameworkApplication.K.$("Box4DoNotRenderPresenceOutOfView"),Na.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),Na.a.instance.resolve("Common.IPresenceStatusProvider"),
!Ga.App.ys&&!Ga.App.ym,Ga.App.Foa(),Na.a.instance.Ta("Common.ISessionExpirationManager"));k.ULS.sendTraceTag(23196878,302,50,"WordPresenceManager instance created");cd.gtd.Ag(cd._instance);cd.twc.Ag(cd._instance);cd.aah.Ag(cd._instance);Aa=Na.a.instance;Aa.ia("WordEditor.Presence.WordPresenceManager",()=>cd._instance).as("Common.IPresenceRemover").as("Common.IPresenceSender").ha();Aa.resolve("WordEditor.Presence.WordPresenceManager")}else k.ULS.sendTraceTag(4203468,302,15,"Can't initialize the WordPresenceManager because can't get a handle to RtcProxy")}static Z0c(Aa){cd._instance||
(k.ULS.sendTraceTag(4006601,302,50,"WordPresenceManager.OnAppIsInteractive: Trying to initialize again"),(Aa=Object(y.a)(17,Aa))&&Aa.Dob(cd.Z0c),cd.init())}static EVi(){cd._instance.Gag()}static vsk(Aa,Ab,nc,Kc,hd){nc=hd.split(",");if(!nc||3!==nc.length)return 8;Aa=nc[0].trim();Ab=nc[1].trim();nc=Number.parseInvariant(nc[2].trim());Aa=new Jj(new bb(Aa),new ah(Ab,nc,-1));if(!cd.twc.task.isCompleted)return 8;Ab=cd.XD().result;Ab.ZYe(Aa);Ab.Xce();return 32}static T6f(Aa,Ab,nc,Kc,hd){if(!cd.twc.task.isCompleted)return 8;
Aa=cd.XD().result;Aa.X5c(hd);Aa.Xce();return 32}static avo(Aa,Ab,nc,Kc,hd){if(!cd.twc.task.isCompleted)return 8;Aa=cd.XD().result;if(!Aa)return 8;Aa.rie(hd);return 32}static C3f(Aa,Ab,nc,Kc,hd){if(1===nc)return 32;if(!cd.Xqa.XD().isCompleted)return 8;Aa=cd.Xqa.XD().result;if(!Aa)return k.ULS.sendTraceTag(4301136,302,10,"rtcProxy is null when trying to display RTC connection status"),8;hd[zh.a.Value]=2===Aa.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnected:1===Aa.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnecting:
"";return 32}}cd._instance=null;cd.vUg=!0;cd.gtd=new x.a;cd.twc=new x.a;cd.aah=new x.a;cd.qH=null;cd.dAc=null;cd.ZN=null;cd.fj=null;Object(l.a)(cd,"WordPresenceManager",Cl,[]);class dg{constructor(Aa){this.sa=new Ka.a;this.HZ=Aa;this.HZ.CWR(()=>this.HZ.result.avk(()=>{this.sa.raiseEvent("X")}))}hxk(Aa){this.sa.addHandler("X",Aa)}E_n(Aa){this.sa.removeHandler("X",Aa)}getStatus(){return this.HZ.isCompleted&&this.HZ.result?this.HZ.result.YId.toString():"0"}}Object(l.a)(dg,"WordPresenceStatusProvider",
null,[142]);class vm{constructor(Aa,Ab,nc,Kc){this.fj=null;this.nUg=this.YIe=!1;this.crn=()=>{this.d_.isCompleted&&this.d_.result?(this.fj=this.d_.result,this.fj.b_a(this.h5),k.ULS.sendTraceTag(5604372,302,50,"Presence Update Monitor is ready.")):k.ULS.sendTraceTag(5604373,302,15,"RtcTask did not complete successfully. No monitoring")};this.h5=(hd,Rd)=>{hd=Rd.Ora;for(const kc in hd)if(Rd=hd[kc],!this.YIe&&Rd.user.wP&&Rd.user.wP!==this.e3.wP){k.ULS.sendTraceTag(5604375,302,15,"Presence received from different local cobalt session Mine:{0} Theirs:{1}",
this.e3.wP,Rd.user.wP);this.YIe=!0;break}this.YIe&&this.fj.AOb(this.h5);this.nUg||(k.ULS.sendTraceTag(5604374,302,50,"First presence received"),this.nUg=!0)};this.Pk=Aa;this.e3=Ab;this.d_=nc;nc.continueWith(this.crn);this.F$j=Kc;this.F$j.nLf=this.e3}}Object(l.a)(vm,"WordPresenceUpdateMonitor",null,[]);var Rm=c(413),ce=c(1546),md=c(224),mg=c(1883),Kg=c(1884),Jd=c(1769);class tg{constructor(Aa,Ab,nc,Kc,hd,Rd,kc){this.sa=new Ka.a;this.W_g=this.O1g=this.bHe=this.x4g=!1;this.lWe=this.Xyd=0;this.X0b=null;
this.dMa=Rd;this.dMa.clientId=Aa.clientId;this.Fl=Aa;this.daa=Ab;this.Caa=Kc;this.K1j=hd;this.Ib=nc;this.bab=new md.a;this.Fp=kc;this.daa&&this.daa.continueWith(()=>{this.daa.Eo||this.daa.Ei||this.daa.result.Ooh(Object(f.a)(this,this.VRi,"onAmIAloneChanged"))})}get connectionState(){return this.Fl.connectionState}b_a(Aa){this.sa.addHandler("PU",Aa)}AOb(Aa){this.sa.removeHandler("PU",Aa)}xua(Aa){this.sa.addHandler("CSC",Aa)}Lic(Aa){this.sa.removeHandler("CSC",Aa)}tFc(Aa){this.sa.addHandler("PSU",Aa)}d6c(Aa){this.sa.removeHandler("PSU",
Aa)}mBd(Aa){this.sa.addHandler("PSC",Aa)}Sce(Aa){this.sa.removeHandler("PSC",Aa)}Lhj(){}get clientId(){return this.Fl.clientId}G3(Aa){this.sa.addHandler("UN",Aa)}BOb(Aa){this.sa.removeHandler("UN",Aa)}Hxm(){this.X0b=Array(12);for(let Aa=0;12>Aa;Aa++)this.X0b[Aa]=0;this.O1g=this.Fp?this.Fp.$("UpdateNotificationTaskExperimentIsEnabled"):!0;m.AFrameworkApplication.lI(()=>{this.M5m()})}init(){this.Fl.xua(Object(f.a)(this,this.Mia,"onConnectionStateChanged"));this.Fl.b_a(Object(f.a)(this,this.h5,"onPresenceUpdated"));
this.Fl.tFc(Object(f.a)(this,this.rSa,"onPersistentStateUpdated"));this.Fl.mBd(Object(f.a)(this,this.qgc,"onPersistentStateCleared"));this.Fl.G3(Object(f.a)(this,this.b1,"onUpdateNotificationReceived"));this.GGh();this.Hxm()}pce(Aa){this.bab.contains(Aa,(Ab,nc)=>Ab===nc)||(this.bab.add(Aa),2===this.connectionState&&Aa.start())}nng(Aa){for(let Ab=0;Ab<this.bab.length;Ab++)if(this.bab.J(Ab)===Aa){this.bab.tG(Ab);break}}connect(){this.bHe||this.Fl.connect()}disconnect(){this.Fl.disconnect()}get hee(){return this.Fl}jQh(Aa){return Jj.BCb(Aa)}ebg(Aa,
Ab){return(new Jj(Aa,Ab)).gtf()}Oag(Aa){Aa&&Aa.isValid()&&!this.Caa()?this.Fl.Lhj(this.ebg(this.dMa.q3l(),Aa)):G.Task.o4(null)}Yjc(Aa,Ab){return this.Fl.Yjc(Aa,Ab)}z8b(Aa){return this.Fl.z8b(Aa)}HOc(){return this.Fl.HOc()}pN(Aa,Ab,nc=!1){return this.Fl.pN(Aa,Ab,nc)}ZEb(){return this.jKh(this.Fl.ZEb())}krb(Aa){const Ab=new x.a;Jd.a.getInstance().o5i(Aa,Ab);return Ab.task}get LRa(){return this.Fl.LRa}Mia(Aa,Ab){2===Ab.newState&&this.bab.forEach(nc=>{nc.start();return!0});Ab.newState||this.Fp.$("SendRTCMessagesWhileDisconnectedIsEnabled")&&
!this.bHe||this.bab.forEach(nc=>{nc.stop();return!0});this.sa.raiseEvent("CSC",Ab)}kkf(Aa){return Aa.toLowerCase()}h5(Aa,Ab){if(!this.Caa()){Aa=this.jKh(Ab.Ora);Ab=this.lKh(Ab.rKd);var nc=new vg.a(Aa,Ab);Ab=new oa.a(0,1,0,()=>{this.sa.raiseEvent("PU",nc)},57);this.Ib.Xb(Ab)}}jKh(Aa){const Ab={};for(const Kc in Aa){var nc=Kc;const hd=this.jQh(Aa[Kc]);hd&&hd.isValid()?Ab[this.kkf(nc)]=hd:k.ULS.sendTraceTag(562661590,302,50,"No Valid User {0}",nc)}return Ab}lKh(Aa){const Ab=Array(Aa.length);for(let nc=
0;nc<Aa.length;nc++)Ab[nc]=this.kkf(Aa[nc]);return Ab}rSa(Aa,Ab){if(!this.Caa()){var nc={};Aa=Ab.Ora;for(var Kc in Aa)nc[this.kkf(Kc)]=Aa[Kc];Kc=new oa.a(0,1,0,()=>{this.sa.raiseEvent("PSU",new mg.a(Ab.type,nc))},80);this.Ib.Xb(Kc)}}qgc(Aa,Ab){if(!this.Caa()){Aa=this.lKh(Ab.zFd);var nc=new Kg.a(Aa);Aa=new oa.a(0,1,0,()=>{this.sa.raiseEvent("PSC",nc)},81);this.Ib.Xb(Aa)}}b1(Aa,Ab){this.O1g?this.CXi(Ab):(Aa=new oa.a(0,1,0,()=>{this.CXi(Ab)},58),this.Ib.Xb(Aa))}CXi(Aa){var Ab=Date.now();this.sa.raiseEvent("UN",
Aa);Ab=Date.now()-Ab;500<=Ab&&(this.Xyd++,k.ULS.sendTraceTag(42563487,302,15,"Update Notification Heuristics: UpdateNotification Type {0} took {1} ms",Aa.type,Ab),this.gDl(Aa));this.lWe++}gDl(Aa){0>Aa.type||21<=Aa.type?k.ULS.sendTraceTag(42541602,302,15,"Update Notification Heuristics: UpdateNotification Type out of range {0}",Aa.type):this.X0b[Aa.type]++}M5m(){if(!this.W_g){var Aa={};Aa.TC=this.lWe;Aa.HRC=this.Xyd;this.X0b&&0<this.Xyd&&(Aa.TBC=this.X0b);this.Xyd=this.lWe=0;this.X0b=null;k.ULS.sendTraceTag(42541603,
302,50,"UpdateNotificationHeuristics: {0}",Aa);this.W_g=!0}}dispose(){this.bab=new md.a;this.Fl.Lic(Object(f.a)(this,this.Mia,"onConnectionStateChanged"));this.Fl.AOb(Object(f.a)(this,this.h5,"onPresenceUpdated"));this.Fl.d6c(Object(f.a)(this,this.rSa,"onPersistentStateUpdated"));this.Fl.Sce(Object(f.a)(this,this.qgc,"onPersistentStateCleared"));this.Fl.BOb(Object(f.a)(this,this.b1,"onUpdateNotificationReceived"));this.daa&&this.daa.continueWith(()=>{this.daa.Eo||this.daa.Ei||this.daa.result.zZn(Object(f.a)(this,
this.VRi,"onAmIAloneChanged"))});this.Fl.disconnect();k.ULS.sendTraceTag(4564935,302,50,"Disposing of rtcProxyCompleted")}VRi(){this.GGh()}GGh(){let Aa=!1;this.daa?this.daa.continueWith(()=>{this.daa.Eo||this.daa.Ei||(Aa=!this.daa.result.amIAlone);this.Fl.connectionState||!Aa&&!this.K1j()?2!==this.Fl.connectionState||Aa||(this.disconnect(),k.ULS.sendTraceTag(4564937,302,50,"Disconnecting because there are no other users in the doc")):(this.connect(),k.ULS.sendTraceTag(4564936,302,15,"Connecting because there are other authors in the doc"));
!this.x4g&&Aa&&(k.ULS.sendTraceTag(4203466,302,50,"There are other real-time authors in this session"),this.x4g=!0)}):(this.connect(),k.ULS.sendTraceTag(589321547,302,50,"Connecting to rtc because Rtc Always On is enabled"))}lLc(){this.bHe=!0;this.disconnect();k.ULS.sendTraceTag(4564938,302,50,"DisconnectForever")}}Object(l.a)(tg,"RtcProxy",null,[1183,10,865,1184]);class xd extends tg{constructor(Aa,Ab,nc,Kc,hd,Rd,kc,ff,bd,Sf,Te,bi,Si){super(Aa,Ab,nc,Kc,hd,Rd,Si);this.Pfa=null;this.MI=kc;this.ud=
ff;this.jMa=bd;this.Xzc=Sf;this.YSe=Te;this.aAb=bi}get $J(){return this.Pfa||(this.Pfa=this.YSe())}Mia(Aa,Ab){2===Ab.newState&&k.ULS.sendTraceTag(4315102,302,50,"RTC Connected");this.MWo();super.Mia(Aa,Ab)}MWo(){this.$J&&this.$J.bV("RtcConnectionStatusLabel")}jQh(Aa){return tc.W$e(Wc(Aa),this.MI,this.ud,this.jMa,this.aAb)}ebg(Aa,Ab){return Object(ul.a)(Se,Ab)?(Aa=new tc(this.Xzc.wbi(),Aa,Ab),Zc(Aa.gtf())):super.ebg(Aa,Ab)}}Object(l.a)(xd,"WordRtcProxy",tg,[]);class Oi{constructor(Aa,Ab,nc,Kc,hd,Rd,
kc,ff,bd,Sf,Te,bi,Si){this.fq=new x.a;this.hfh=!0;this.he=Ab;this.Ib=nc;this.Caa=Kc;this.dMa=hd;this.MI=Rd;this.lua=kc;this.jMa=ff;this.Xzc=bd;this.YSe=Sf;this.m3=Te;this.aAb=bi;this.Ga=Si}XD(){this.gMo();return this.fq.task}cQc(){return Rm.a.then(this.XD(),Aa=>Aa)}gMo(){if(this.hfh)if(this.hfh=!1,Ga.App.CGf()&&Ga.App.BEf()){var Aa=m.AFrameworkApplication.He;if(Aa){Aa=ce.RealtimeChannel.createInstance("{"+m.AFrameworkApplication.userSessionId+"}",m.AFrameworkApplication.userSessionId,m.AFrameworkApplication.Fej,
Aa,this.m3,1,this.he,this.Ga.kb("RtcEndpointUrl"),void 0,void 0,null,this.Ga.$("FindSessionOnBootIsEnabled")?Na.a.instance.resolve("Common.IFindSessionUtils"):null,this.Ga.kb("RtcBootToken"));var Ab=this.Ga.$("RtcAlwaysOnEnabled"),nc=new xd(Aa,Ab?null:Ga.App.Foa(),this.Ib,this.Caa,Oi.zGl,this.dMa,this.MI,this.lua,this.jMa,this.Xzc,this.YSe,this.aAb,m.AFrameworkApplication.K);Ga.App.Wjo(nc);this.yUn(nc);nc.init();nl.App.d7a=nc;this.m3.execute(Kc=>{Kc.seb(()=>{nc.lLc()})});this.fq.Ag(nc)}else k.ULS.sendTraceTag(8206365,
302,15,"Can't initialize the RtcProxy because ClientRequestManager is null")}else k.ULS.sendTraceTag(8206362,302,10,"Can't initialize the RtcProxy because dependent scripts are not loaded")}yUn(Aa){const Ab=Na.a.instance;Ab.ia("WordEditor.Presence.WordRtcProxy",()=>Aa).as("Box4.Presence.IRtcProxy").as("Common.IRealtimeChannelBasic").ha();Ab.resolve("Common.IRealtimeChannelBasic")}static zGl(){return!1}}Object(l.a)(Oi,"WordRtcProxyProvider",null,[140,141]);class he{constructor(){this.W=null;this.fm=
!1}get name(){return"WordEditor.Presence"}init(){k.ULS.sendTraceTag(50995799,302,50,"PresencePackage Init");Ga.App.MJj&&(this.W.resolve("WordEditor.Presence.WordRtcProxyProvider").XD(),cd.init(),this.W.resolve("WordEditor.Presence.WordPresenceUpdateMonitor"));Ga.App.bJc&&kg.init();this.W.resolve("Common.App.Presence.AwayManager");this.W.resolve("Common.IPeopleInfoProvider");if(he.J_g){const Aa=this.W.resolve("WordEditor.IMainViewModeManager");Aa.vAb(this.PXf);he.JFe=1===Aa.mu}}dispose(){if(!this.fm){this.fm=
!0;cd.XD().continueWith(()=>{Qd.a.gC(cd.XD().result)});var Aa=this.W.resolve("Box4.Presence.MyPresenceUser");Aa&&Aa.Lhc&&Aa.Lhc.E_n(cd.EVi)}}wc(Aa){this.W=Aa;this.W.ia("Box4.Presence.MyPresenceUser",()=>new mb).as("Box4.Presence.IMyPresenceUser").as("Common.IPresenceUser").as("Common.IPresenceConverter").ha();Aa.ia("WordEditor.Presence.IWordPresenceCpFactory",()=>new Qk(Aa.resolve("Box4.CpConversionManagerImpl"),Aa.resolve("Box4.IContentControlReader"))).ha();Aa.ia("WordEditor.Presence.WordPresenceUpdateMonitor",
()=>new vm(new V.a(()=>Ga.App.xd),zf.a.instance,Aa.resolve("WordEditor.Presence.WordRtcProxyProvider").cQc(),Aa.resolve("Box4.Presence.IMyPresenceUser"))).ha();Aa.ia("WordEditor.Presence.WordRtcProxyProvider",()=>new Oi(m.AFrameworkApplication.buildVersion,Ga.App.za.Iq,Xb.a.instance,()=>m.AFrameworkApplication.Lk,Na.a.instance.resolve("Box4.Presence.IMyPresenceUser"),Na.a.instance.Oa("WordEditor.ParagraphWordIdMapping"),Na.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),
()=>m.AFrameworkApplication.ua&&Ga.App.za.jb&&Ga.App.za.jb.Yc?Ga.App.za.jb.Yc.vd:null,Pg.instance,()=>Na.a.instance.Oa("WordEditor.IStatusBarUser"),Na.a.instance.Ta("Common.ISessionExpirationManager"),Na.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),m.AFrameworkApplication.K)).ha().as("Box4.Presence.IRtcProxyProvider").as("Common.Interface.IRtcBasicProvider");Aa.ia("Box4.Presence.PresenceControlProvider",()=>new tm(he.zdl(),Ad.a.instance,Na.a.instance.Ta("Common.IZoomManager"),
Na.a.instance.resolve("Box4.ICoauthCashTelemetry"),Da.a.Bp(Na.a.instance.Ta("Common.ISystemInitiatedFeedbackWithTimeLapse")),m.AFrameworkApplication.K,Aa.resolve("Common.IPeopleInfoProvider"))).ha();Aa.ia("Common.App.Presence.AwayManager",()=>new Oe(Na.a.instance.resolve("Common.IPresenceUser"),Na.a.instance.resolve("WordEditor.Presence.WordRtcProxyProvider").cQc(),cd.A8l(),Na.a.instance.resolve("Common.IPresenceConverter"),Xb.a.instance,m.AFrameworkApplication.K.$("AwayStatusOneMinuteTimeoutIsEnabled")?
6E4:m.AFrameworkApplication.K.lc("AwayCoauthorThresholdMs",9E5),Object(f.a)(m.AFrameworkApplication.va,m.AFrameworkApplication.va.processAction,"processAction"),Ga.App.za.notificationBar,m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"))).ha();Aa.ia("WordEditor.Presence.WordPresenceStatusProvider",()=>new dg(Da.a.Bp(Na.a.instance.Ta("Common.ICurrentPageCalculator")))).as("Common.IPresenceStatusProvider").ha();Aa.ia("Common.App.Presence.PeopleInfoProvider",()=>new Jh(Aa.resolve("WordEditor.Presence.WordRtcProxyProvider").cQc(),
Ga.App.Foa().CWR(()=>Ga.App.Foa().result.jC),Aa.resolve("Common.App.People.IPeopleColorUtils"),Aa.resolve("Common.IPresenceConverter"),Da.a.Bp(Aa.Ta("Common.App.Presence.AwayManager")))).as("Common.IPeopleInfoProvider").ha();Aa.ia("Box4.Presence.WordPresenceDataManager",()=>new Lm(Ga.App.za.jb.Yc.vd)).as("Box4.IPresenceDataManager").ha()}PXf(Aa,Ab){Ga.App.za&&Ga.App.za.pD&&(he.asd=null,he.JFe=1===Ab.Emb)}static get zYi(){if(!he.asd&&Ga.App.za&&Ga.App.za.pD){const Aa=nl.App.hn.pD;he.asd=he.JFe&&he.J_g?
Aa.getElementsByClassName("PaginatedContentContainerDisplayWrapper")[0]:Aa.getElementsByClassName("OutlineContainerDisplayWrapper")[0]}return he.asd}static zdl(){const Aa=m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"),Ab=m.AFrameworkApplication.K.$("PresenceIgnoreEventOnExpandedTooltip"),nc=m.AFrameworkApplication.K.$("PresenceIpWidthAdjustForFlyout"),Kc=new bc;Kc.add(xg.multipleBrowsersImageClassName,Gd.getImageClassWithCluster(m.AFrameworkApplication.Bca,"MoreUsersGlyph16"));
Kc.add(xg.multipleBrowserImageClusterPath,m.AFrameworkApplication.$s);Kc.add(xg.peopleImageClassName,Gd.getImageClassWithCluster(m.AFrameworkApplication.Bca,Aa?"DoughboyWhiteGlyph_20x20x32":"SingleCollabUserGlyph16"));Kc.add(xg.peopleImageClusterPath,m.AFrameworkApplication.$s);Kc.add(xg.zIndex,1);Kc.add(xg.rtl,m.AFrameworkApplication.isRtl);Kc.add(xg.viewportBoundsCallback,he.sim);Kc.add(xg.ignoreEventOnExpandedTooltip,Ab);Kc.add(xg.ipWidthAdjustForFlyout,nc);return Aa?new Hg(Kc):new Zg(Kc)}static sim(){return he.zYi?
Bg.a.getElementBounds(he.zYi):null}}he.JFe=!0;he.J_g=m.AFrameworkApplication.K.$("FlippedFlyoutForPaginationViewIsEnabled");he.asd=null;Object(l.a)(he,"WordPresencePackage",null,[1,2]);var Ng=c(1055),wk=c(1409),Vj=c(1060),Xg=c(190);class jf{constructor(Aa,Ab){this.$Ye=Aa;this.paragraphId=Ab}get opType(){return 2}get operation(){return this.$Ye}}Object(l.a)(jf,"RttAppliedAddParagraphOp",null,[157]);class sf{constructor(Aa,Ab){this.I1n=Aa;this.paragraphId=Ab}get opType(){return 6}get operation(){return this.I1n}}
Object(l.a)(sf,"RttAppliedReplaceSymbolRangeOp",null,[157]);class Rh{constructor(Aa,Ab){this.M1n=Aa;this.paragraphId=Ab}get opType(){return 1}get operation(){return this.M1n}}Object(l.a)(Rh,"RttAppliedReplaceTextRangeOp",null,[157]);class ij{constructor(Aa,Ab,nc){this.ktj=Aa;this.Xie=Ab;this.gKc=nc}get opType(){return 4}get operation(){return this.ktj}get Fnk(){return this.ktj.n5b()?this.gKc:this.Xie}}Object(l.a)(ij,"RttAppliedSplitParagraphOp",null,[157]);class hn{constructor(){this.W9a=new vb.a}jIf(Aa){return Aa.toString()}YEc(Aa,
Ab){Aa=this.jIf(Aa);this.W9a.nb(Aa)||this.W9a.Z(Aa,new P.a);this.W9a.J(Aa).add(Ab)}sWf(Aa){switch(Aa.opType){case 1:var Ab=Object(y.a)(Rh,Aa);this.YEc(Ab.paragraphId,Aa);break;case 6:Ab=Object(y.a)(sf,Aa);this.YEc(Ab.paragraphId,Aa);break;case 4:Ab=Object(y.a)(ij,Aa);this.YEc(Ab.Xie,Aa);this.YEc(Ab.gKc,Aa);break;case 2:Ab=Object(y.a)(jf,Aa),this.YEc(Ab.paragraphId,Aa)}}xmn(Aa){return this.anb(Aa)}anb(Aa){Aa=this.jIf(Aa);if(!this.W9a.nb(Aa))return new P.a;const Ab=this.W9a.J(Aa);this.W9a.remove(Aa);
for(const nc of Ab)nc.operation&&(nc.operation.Q7=null);return Ab}k5l(Aa){let Ab;return({value:Ab}=this.W9a.Fc(this.jIf(Aa),Ab)).returnValue?Ab:new P.a}zKl(Aa){for(const Ab of this.W9a.values){if(!Ab.count)continue;if(2!==Ab.J(0).opType)continue;const nc=Ab.J(0);if(nc.$Ye.$Rf===Aa)return nc}return null}}Object(l.a)(hn,"RttAppliedOpTracker",null,[125]);var pg=c(248),Rl;(function(Aa){Aa[Aa.Nxl=0]="expired";Aa[Aa.cfp=1]="dried"})(Rl||(Rl={}));Object(l.b)("RemoveChangeReason",Rl);class nh{constructor(){this.jAa=
new pg.a}vpk(Aa){if(!Aa)return k.ULS.sendTraceTag(7685333,355,15,"Cannot add a null change to RTTStore"),!1;const Ab=Aa.Wc,nc=Aa.oj;this.jAa.nb(Ab)||this.jAa.add(Ab,new pg.a);this.jAa.J(Ab).Z(nc,Aa);return this.Gfl(Ab,nc)?(k.ULS.sendTraceTag(7619921,355,15,"Detected an infinite loop in paragraph {0}, dropping the last packet!",Ab),this.jAa.J(Ab).remove(nc),!1):!0}qrf(Aa,Ab){if(!this.jAa.nb(Aa))return null;Aa=this.jAa.J(Aa);return Aa.nb(Ab)?Aa.J(Ab):null}mSd(Aa){const Ab=new P.a;for(const nc of this.jAa.keys){const Kc=
this.jAa.J(nc);for(const hd of Kc.keys){const Rd=Kc.J(hd);Aa(Rd)&&Ab.add(Rd)}}return Ab}P9i(Aa,Ab){let nc=null;({value:nc}=this.jAa.Fc(Aa.Wc,nc)).returnValue?(Aa.activity.qUf(Rl[Ab]),nc.remove(Aa.oj),nc.count||this.jAa.remove(Aa.Wc)):k.ULS.sendTraceTag(50938848,355,15,"Cannot remove an op that not exist in _changes. WordId: {0}; Reason: {1}",Aa.Wc,Ab)}y6f(Aa){this.P9i(Aa,1)}B6f(Aa){this.P9i(Aa,0)}Gfl(Aa,Ab){if(!this.jAa.nb(Aa))return!1;Aa=this.jAa.J(Aa);if(!Aa.nb(Ab))return!1;for(var nc=Aa.J(Ab);nc;){nc=
nc.K1;if(nc===Ab)return!0;if(!Aa.nb(nc))break;nc=Aa.J(nc)}return!1}}Object(l.a)(nh,"RttDataStore",null,[123,124]);var vl=c(287),Dl=c(93),oe=c(274),Yg=c(308),Vh=c(16);class Tf{constructor(Aa,Ab){this.B6d=(nc,Kc)=>{4===this.Hp.opType?k.ULS.shipAssertTag(9204866,355,12===Kc.node.type||11===Kc.node.type,"Unexpected graph modification detected during RTT edit"):k.ULS.shipAssertTag(9204867,355,!1,"Unexpected graph modification detected during RTT edit")};this.anb=()=>{k.ULS.shipAssertTag(9204868,355,!1,
"Unexpected graph modification detected during RTT edit")};this.RTi=()=>{k.ULS.shipAssertTag(9204869,355,!1,"Unexpected graph modification detected during RTT edit")};this.Hp=Aa;if(this.tq=Ab)Aa=this.tq.Te(12),Aa.hu(this.B6d),Aa.Fx(this.anb),Aa.Mo(this.RTi)}dispose(){if(this.tq){const Aa=this.tq.Te(12);Aa.iV(this.B6d);Aa.Pqa(this.anb);Aa.jV(this.RTi)}}}Object(l.a)(Tf,"GraphChangeValidator",null,[10]);class Hf{constructor(Aa,Ab,nc,Kc){this.id=Aa;this.cpBegin=Ab;this.cpEnd=nc;this.lTk=Kc}v_o(Aa){var Ab=
this.id===Aa.id;Ab&&(Ab=this.lTk.replace("\u00a0"," "),Aa=Aa.characterData.substr(this.cpBegin,this.cpEnd-this.cpBegin).replace("\u00a0"," "),Ab=Ab===Aa);return Ab}}Object(l.a)(Hf,"RttOpValidator",null,[208]);class sh{constructor(Aa,Ab){this.Q7=this.Doc=this.activity=null;this.opType=Aa;this.metadata=Ab}fuf(){return""}serialize(){return null}}Object(l.a)(sh,"RttOp",null,[139]);class sj extends sh{constructor(Aa,Ab,nc,Kc,hd,Rd,kc,ff,bd){super(bd,ff);this.Wc=Aa;this.oj=Ab;this.ZR=nc;this.b5=Kc;this.K1=
hd;this.Hqb=Rd;this.IH=kc}lMh(){return this.ZR.isEqual(this.b5,!0)?new te.a(0,this.Wc,this.oj,this.ZR,void 0,void 0,void 0,this.IH):new te.a(1,this.Wc,this.oj,this.ZR,this.Wc,this.oj,this.b5,this.IH)}static yAj(Aa){let Ab,nc;var Kc=Aa.zT;if(1===Kc.Rbe&&(Kc.ASa!==Kc.rHa||Kc.p8a!==Kc.Kmc))return k.ULS.sendTraceTag(8914769,355,15,"We received a ReplaceRange operation spanning multiple paragraphs"),nc=Ab=null,Aa=Kc=-1,{returnValue:!1,ZR:nc,b5:Ab,Wc:Aa,oj:Kc};if(Kc.IH)return nc=Ab=null,Aa=Kc=-1,{returnValue:!1,
ZR:nc,b5:Ab,Wc:Aa,oj:Kc};Ab=nc=Kc.ZR;1===Kc.Rbe&&(Ab=Kc.b5);Aa=Kc.ASa;Kc=Kc.p8a;return{returnValue:!0,ZR:nc,b5:Ab,Wc:Aa,oj:Kc}}}Object(l.a)(sj,"RttReplaceRangeOp",sh,[]);var Tk=c(1407),El=c(461),$g=c(589);class Ef extends $g.a{constructor(){super();this.RttStatusRecords=this.FileId=null}el(){return 110}static Jba(Aa,Ab){const nc=new Ef;nc.FileId=Aa;nc.RttStatusRecords=Ab;return nc}}Object(l.a)(Ef,"RttStatusRequest",$g.a,[]);class em{}Object(l.a)(em,"RttStatusOp",null,[]);class Di{constructor(){this.contentState=
this.contentType=this.timeToRender=this.strictlySequentialId=this.packetVersion=this.clientType=this.clientId=this.packetId=null}}Object(l.a)(Di,"WireRttStatusOpRecord",null,[]);class Zf extends El.a{constructor(){super();const {App:Aa}=c(161);this.h_b=new P.a;this.mQe=new P.a;this.mk=new Tk.a(m.AFrameworkApplication.K.lc("WordEditorRttStatusReplicatorIntervalMs",6E4));this.enabled=1;Aa.L1.register(this)}XPj(){const Aa=Date.now();for(const Ab of this.h_b)Ab.tMb&&1===Ab.tMb&&(Ab.tMb=2,Ab.timeToRender=
Aa-Ab.metadata.Vkg)}xpe(Aa){const Ab=new em;Ab.metadata=Aa.operation.metadata;Ab.opType=Aa.opType;Ab.tMb=1;this.h_b.add(Ab)}get Gia(){return"RttStatusReplicator"}y4(){return this.fe&&2===this.fe.status?!0:1===this.enabled&&this.mk.cY()?this.ZD():!1}ZD(){for(const Aa of this.h_b)if(Aa.tMb&&2===Aa.tMb)return!0;return!1}oTa(){if(1===this._state){this._state=3;const Ab=this.h_b.toArray().filter(nc=>2===nc.tMb);var Aa=this.D8k(Ab);Aa=Ef.Jba(m.AFrameworkApplication.rootQuerySignature,Aa);Ab.forEach(nc=>
this.h_b.remove(nc));Ab.forEach(nc=>this.mQe.add(nc));this.fe.Gq=Aa;this.fe.QG="RttStatusRequest";this.fe.status=1}else 3===this._state&&this.fe&&2===this.fe.status&&(this.mk.X1(),2!==this.fe.statusCode&&this.h_b.aD(0,this.mQe),this.mQe.clear(),this._state=1)}D8k(Aa){const Ab=[];Aa.forEach(nc=>{const Kc=new Di;Kc.clientId=nc.metadata.clientId;Kc.clientType=nc.metadata.clientType;Kc.packetId=nc.metadata.packetId;Kc.packetVersion=nc.metadata.packetVersion;Kc.strictlySequentialId=nc.metadata.strictlySequentialId;
Kc.contentType=nc.opType;Kc.contentState=nc.tMb;Kc.timeToRender=nc.timeToRender;Ab.push(Kc)});return Ab}alc(){return!0}fF(){}forceOutbound(){}}Object(l.a)(Zf,"RttStatusReplicator",El.a,[]);class eb{constructor(Aa,Ab,nc,Kc,hd,Rd){this.packetId=Aa;this.clientId=Ab;this.clientType=nc;this.Vkg=Kc;this.packetVersion=hd;this.strictlySequentialId=Rd}static create(Aa){let Ab=null;null!=Aa.strictlySequentialId&&(Ab=Aa.strictlySequentialId);return new eb(Aa.packetId,Aa.clientId,Aa.client,Date.now(),Aa.version,
Ab)}}Object(l.a)(eb,"RttOpMetadata",null,[]);class Kb extends sh{constructor(Aa,Ab,nc,Kc,hd,Rd,kc,ff,bd){super(4,bd);this.K1=0;this.Wc=Aa;this.oj=Ab;this.offset=nc;this.IH=Kc;this.Yqg=hd;this.Bkg=Rd;this.Yoe=kc;this.Ckg=ff;this.Yqg===this.Wc?this.K1=this.Bkg:this.Yoe===this.Wc?this.K1=this.Ckg:(k.ULS.sendTraceTag(8397766,355,10,"Bad data passed to RttSplitParagraphOp"),this.K1=0)}n5b(){return this.Wc===this.Yoe}get GGo(){return this.K1}get X2o(){return this.n5b()?this.Yqg:this.Yoe}get dxj(){return this.n5b()?
this.Bkg:this.Ckg}serialize(){const Aa=new te.a(3,this.Wc,this.oj,this.offset,null,null,null,this.IH),Ab=new Lc(this.Yqg,this.Bkg,this.Yoe,this.Ckg);return new qc(this.metadata.packetId,this.metadata.clientId,1,4,Aa,null,void 0,void 0,void 0,void 0,Ab,void 0,void 0,this.metadata.strictlySequentialId)}static create(Aa){const Ab=Aa.zT,nc=Aa.PQb;return new Kb(Ab.ASa,Ab.p8a,Ab.ZR,Ab.IH,nc.dZf,nc.Akg,nc.eZf,nc.Dkg,eb.create(Aa))}static xam(Aa,Ab,nc){if(1!==Aa.type)return null;const Kc=nc.CSa(Aa.c5.characterData,
Aa.c5.qa);return new Kb(Aa.c5.Wc,Aa.c5.oj,nc.Xoc(Kc,Aa.Xsj),Aa.IH,Aa.dAb.Wc,Aa.dAb.oj,Aa.xGc.Wc,Aa.xGc.oj,Ab)}}Object(l.a)(Kb,"RttSplitParagraphOp",sh,[120,139]);class fc{constructor(Aa,Ab,nc,Kc){this.xin=()=>{this.uyb.XPj()};this.Rka=Aa;this.szc=Ab;this.ula=nc;this.mzb=Kc;null!=m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.WordEditorRttStatusReplicatorIsEnabled",!1)&&(this.uyb=new Zf,vl.GraphTransactionManager.instance.Noh(this.xin))}IDk(Aa,
Ab,nc,Kc=null){if(Ab.isDirty)return Kc&&Kc.properties.Z(fc.JZi,"1"),!1;const hd=new Tf(Aa,Ab.tj);try{if(1===Aa.opType||6===Aa.opType){const ff=Object(y.a)(sj,Aa),bd=this.m4k(ff,Ab);var Rd=bd.node.characterData;const Sf=10<=bd.cpBegin?bd.cpBegin-10:0;let Te=bd.cpEnd+10<=Rd.length?bd.cpEnd+10:Rd.length;const bi=Rd.substr(Sf,bd.cpBegin-Sf),Si=Rd.substr(bd.cpEnd,Te-bd.cpEnd);Te=Te+ff.Hqb.length-(bd.cpEnd-bd.cpBegin);var kc=new Hf(bd.node.id,Sf,Te,bi+ff.Hqb+Si);const li=6===ff.opType;Rd="";li&&(Rd=ff.font);
if(!this.t1n(bd,ff.Hqb,li,Rd,Kc))return!1;let yi;yi=1===Aa.opType?new Rh(ff,Ab.id):new sf(ff,Ab.id);Ab.Ona=Aa.K1;ff.Doc=kc;Aa.Q7=yi;nc.sWf(yi);null!=this.uyb&&this.uyb.xpe(yi)}else return 4===Aa.opType?this.HDk(Aa,Ab,nc):!1}finally{hd&&hd.dispose()}return!0}HDk(Aa,Ab,nc){const Kc=Object(y.a)(Kb,Aa);var hd=this.mzb.CSa(Ab.characterData,Ab.qa);hd=this.mzb.wCb(hd,Kc.offset);if(!this.PAi(tb.a.createTextRange(Ab,0,Va.ParagraphReader.textLength(Ab))))return!1;var Rd=Rf.GraphIterator.eb(Ab);Rd.zb(10);if(this.t_d(Rd))return!1;
let kc;Rd=this.ula.Pc(3);try{Rd.Db(Ab);const ff=Ab.jZ();try{const bd=Rf.GraphIterator.eb(Ab);bd.zb(10);bd.ld(11);let Sf=bd.currentNode;Kc.n5b()&&(bd.HDf?Sf=null:(bd.AJ(),Sf=bd.currentNode));bd.rc();const Te=this.szc.hgb();bd.QH(Te,Sf,89);bd.wj(Te);kc=Ab.clone();const bi=kc.jZ();try{kc.setValue(jg.a.Wc,Kc.X2o);kc.setValue(jg.a.oj,Kc.dxj);kc.isDirty=!1;bd.xf(kc,2);bd.wj(kc);this.g6k(Ab,kc);const Si=Kc.n5b()?kc:Ab,li=Kc.n5b()?Ab:kc;Si.zO=!0;li.zO=!0;this.Rka.j8f(this.RDa(Si,hd,Va.ParagraphReader.textLength(Si)),
"",!1,"");this.Rka.j8f(this.RDa(li,0,hd),"",!1,"");Ab.Ona=Kc.GGo;kc.Ona=Kc.dxj}finally{bi&&bi.dispose()}}finally{ff&&ff.dispose()}Rd.KTa()}finally{Rd&&Rd.dispose()}Ab=new ij(Kc,Ab.id,kc.id);Aa.Q7=Ab;nc.sWf(Ab);null!=this.uyb&&this.uyb.xpe(Ab);return!0}t_d(Aa){const Ab=new Rf.GraphIterator;Ab.jd(Aa);Ab.ld(11);return Dl.ListItemReader.jg(Ab)?(k.ULS.sendTraceTag(16868566,355,50,"Blocked RTT para operation: in a list"),!0):!1}lCl(Aa,Ab,nc){var Kc=Ab.Pib(Aa.Wc);if(Kc.equals(Nc.a.nil))return null;Kc=nc.Eb(Kc);
if(!Kc||!Va.ParagraphReader.Wb(Kc)||!Kc.isConnected)return null;const hd=Rf.GraphIterator.eb(Kc);if(!hd.zb(23))return null;if(Aa.Xqg){Aa=Ab.Pib(Aa.Xqg);if(Aa.equals(Nc.a.nil))return null;nc=nc.Eb(Aa);if(!nc||!Va.ParagraphReader.Wb(nc)||!nc.isConnected)return null;nc=Rf.GraphIterator.eb(nc);if(!nc.zb(23))return null;nc.ld(11);nc.AJ();nc.Qd();if(nc.currentNode!==Kc)return null}return this.t_d(hd)?null:hd}$Lo(Aa,Ab,nc,Kc){const hd=Ab.currentNode,Rd=this.ula.Pc(3);try{Rd.Db(hd);Ab.ld(11);const kc=Ab.currentNode;
Ab.rc();const ff=this.szc.hgb();Ab.QH(ff,kc,89);Ab.wj(ff);const bd=oe.a.instance.createInstance(393230),Sf=bd.jZ();try{bd.setValue(Vh.a.vo,""),bd.fGa=!0,Kc.vOb(bd),Kc=[0],bd.setValue(jg.a.rq,Kc),bd.setValue(jg.a.kt,Kc),bd.fGa=!1,bd.setValue(jg.a.Wc,Aa.$Rf),bd.setValue(jg.a.oj,Aa.ZRf),bd.isDirty=!1,Ab.xf(bd,2),bd.zO=!0,bd.Ona=Aa.ZRf}finally{Sf&&Sf.dispose()}Rd.KTa();Aa.Q7=new jf(Aa,bd.id);nc.sWf(Aa.Q7);null!=this.uyb&&this.uyb.xpe(Aa.Q7)}finally{Rd&&Rd.dispose()}return!0}RDa(Aa,Ab,nc){return Ab===
nc?tb.a.Oc(Aa,Ab):tb.a.createTextRange(Aa,Ab,nc)}t1n(Aa,Ab,nc,Kc,hd=null){const Rd=Aa.node;if(Aa.cpBegin!==Aa.cpEnd&&!this.PAi(Aa))return hd&&hd.properties.Z(fc.yCj,"1"),!1;hd=this.ula.Pc(3);try{hd.Db(Rd);const kc=Rd.jZ();try{Rd.zO=!0,this.Rka.j8f(Aa,Ab,nc,Kc)}finally{kc&&kc.dispose()}hd.KTa()}finally{hd&&hd.dispose()}return!0}g6k(Aa,Ab){Ab.fGa=!0;Ab.dra(Aa.characterData);Ab.Ona=Aa.Ona;Ab.qa.clear();for(var nc=0;nc<Aa.qa.length;nc++){const Kc=Aa.qa.J(nc).dna(Ab);Ab.qa.add(Kc)}Ab.Zl();if(Ab.we.length)for(Aa=
0;Aa<Ab.qa.length;Aa++){if((nc=Ab.qa.J(Aa).formatting)&&-1!==nc.oe)for(;Ab.we.length<=nc.oe;)Ab.we.mY(Ab.we.length-1,256)}else k.ULS.sendTraceTag(9204881,355,15,"Cannot update WordRunProperties after splitting paragraph");Ab.fGa=!1}IHf(Aa){Aa=Rf.GraphIterator.eb(Aa);Aa.zb(23);Aa.rc();return{returnValue:89===Aa.role,iterator:Aa}}k7f(Aa){const Ab=new Rf.GraphIterator;Ab.jd(Aa);Ab.rc();const nc=this.ula.Pc(3);try{nc.Db(Ab.currentNode),Aa.vg()}finally{nc&&nc.dispose()}}PWn(Aa){if(Aa.anchor)if(({iterator:Ab}=
this.IHf(Aa)).returnValue)this.k7f(Ab);else{var Ab=Aa.Lc.wm;var nc=this.ula.Pc(3);try{nc.Db(Aa),Aa.load(Object(Yg.a)(Ab).Eb(Aa.id)),Aa.anchor.oY(4)}finally{nc&&nc.dispose()}}}I9f(Aa,Ab,nc){for(let Rd=Ab.count-1;0<=Rd;Rd--){var Kc=Ab.J(Rd);switch(Kc.opType){case 4:Kc=Object(y.a)(ij,Kc);if(!Aa.id.equals(Kc.Xie)){k.ULS.shipAssertTag(9204885,355,Aa.id.equals(Kc.gKc));continue}Kc=nc.Eb(Kc.gKc);if(!Kc)break;if(!Kc||!Va.ParagraphReader.Wb(Kc)){k.ULS.shipAssertTag(9204886,355,!1);break}if(!Kc.isConnected)continue;
var hd=({iterator:Kc}=this.IHf(Kc)).returnValue;k.ULS.shipAssertTag(9204887,355,hd);hd&&this.k7f(Kc);break;case 2:(Kc=Object(y.a)(jf,Kc),Aa.id.equals(Kc.paragraphId))?Aa.isConnected&&(hd=({iterator:Kc}=this.IHf(Aa)).returnValue,k.ULS.shipAssertTag(16820002,355,hd),hd&&this.k7f(Kc)):k.ULS.shipAssertTag(16820001,355,!1)}}}m4k(Aa,Ab){const nc=this.mzb.CSa(Ab.characterData,Ab.qa),Kc=this.mzb.wCb(nc,Aa.ZR);Aa=this.mzb.wCb(nc,Aa.b5);return Kc===Aa?tb.a.Oc(Ab,Kc):tb.a.createTextRange(Ab,Kc,Aa)}PAi(Aa){const Ab=
Aa.node.qa,nc=Aa.cpBegin;Aa=Aa.cpEnd;for(let Kc=0;Kc<Ab.length;Kc++){const hd=Ab.J(Kc);if(hd.cp>=Aa)break;if(hd.cp>=nc){if(hd.nf)return k.ULS.sendTraceTag(8242647,355,15,"Rejected unsafe wet change: range contains comment"),!1;if(hd.blob)return k.ULS.sendTraceTag(8242648,355,15,"Rejected unsafe wet change: range contains blob"),!1;if(hd.Vc||hd.ilb||hd.Ybc)return k.ULS.sendTraceTag(8242649,355,15,"Rejected unsafe wet change: range contains field"),!1}}return!0}}fc.JZi="ParagraphAlreadyDirty";fc.yCj=
"UnsafeWetChange";Object(l.a)(fc,"RttEditor",null,[122]);var Hc=c(20),Pc=c(1455),ec=c(253);class Ld{constructor(){this.tfd=new P.a}add(Aa){this.tfd.add(Aa);return!0}mSd(Aa){const Ab=new P.a;for(const nc of this.tfd)Aa(nc)&&Ab.add(nc);return Ab}y6f(Aa){Aa.activity.qUf("dried");this.tfd.remove(Aa)}B6f(Aa){Aa.activity.qUf("expired");this.tfd.remove(Aa)}}Object(l.a)(Ld,"RttAddParagraphDataStore",null,[]);class De extends sh{constructor(Aa,Ab,nc,Kc,hd,Rd,kc,ff){super(2,ff);this.Wc=Aa;this.oj=Ab;this.K1=
nc;this.Xqg=Kc;this.$Rf=hd;this.ZRf=Rd;this.IH=kc}serialize(){const Aa=new te.a(2,this.Wc,this.oj,null,this.Xqg,null,null,this.IH),Ab=new xb(this.K1,this.$Rf,this.ZRf);return new qc(this.metadata.packetId,this.metadata.clientId,1,3,Aa,null,void 0,void 0,Ab,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Aa){const Ab=Aa.zT,nc=Aa.T1b;let Kc=null;null!=Aa.zT.rHa&&(Kc=Aa.zT.rHa);return new De(Ab.ASa,Ab.p8a,nc.Ekg,Kc,nc.gZf,nc.K1,Ab.IH,eb.create(Aa))}static tam(Aa,Ab){return 3!==
Aa.type?null:new De(Aa.gqa.Wc,Aa.gqa.oj,Aa.Zdn.oj,Aa.iSa?Aa.iSa.Wc:null,Aa.Zxa.Wc,Aa.Zxa.oj,Aa.IH,Ab)}}Object(l.a)(De,"RttAddParagraphOp",sh,[]);class cf{constructor(Aa){this.NV=Aa}D6i(){this.NV&&this.NV.properties.Z(cf.gYh,"1")}wOn(Aa){this.NV&&(this.NV.properties.nb(cf.rPf)||this.NV.properties.Z(cf.rPf,(Aa-this.NV.startTime).toString()))}qUf(Aa){this.NV&&(this.NV.properties.Z(cf.laj,Aa),this.NV.end())}WPn(Aa){this.NV&&this.NV.properties.Z(cf.QYi,Aa.toString())}VPn(Aa){this.NV&&this.NV.properties.Z(cf.mYi,
Aa)}static Tzf(Aa){Aa.B5(ph.a.ePb,cf.gYh,Pc.a.mvj);Aa.B5(ph.a.ePb,cf.azl,Pc.a.mvj);Aa.B5(ph.a.ePb,cf.rPf,Pc.a.vHk);Aa.B5(ph.a.ePb,cf.laj,Pc.a.ova);Aa.B5(ph.a.ePb,cf.QYi,Pc.a.ova);Aa.B5(ph.a.ePb,cf.mYi,Pc.a.ova)}static create(Aa){if(!Aa)return null;Aa=Aa.Ap(ph.a.ePb,cf.M1o);return new cf(Aa)}}cf.gYh="FailedToFindInitialParaID";cf.azl="FailedToFindInitialTextID";cf.rPf="MsecUntilApplied";cf.laj="RemovedBecause";cf.QYi="PacketVersions";cf.mYi="OperationType";cf.M1o=48E4;Object(l.a)(cf,"RttOpActivity",
null,[]);var nf;(function(Aa){Aa[Aa.unknown=0]="unknown";Aa[Aa.Anp=1]="replaceTextRangeOp";Aa[Aa.Pbp=2]="addParagraphOp";Aa[Aa.zep=3]="deleteParagraphOp";Aa[Aa.sqp=4]="splitParagraphOp";Aa[Aa.qkp=5]="mergeParagraphOp";Aa[Aa.znp=6]="replaceSymbolRangeOp"})(nf||(nf={}));Object(l.b)("RttOpType",nf);var Wb=c(122);class Ug extends sj{constructor(Aa,Ab,nc,Kc,hd,Rd,kc,ff,bd,Sf,Te){super(Kc,hd,Rd,kc,ff,bd,Sf,Te,6);this.font=Aa;this.legacy=Ab}fuf(){return"OffsetStart: "+this.ZR+"OffsetEnd: "+this.b5}serialize(){const Aa=
this.lMh();return new qc(this.metadata.packetId,this.metadata.clientId,1,7,Aa,null,this.K1,this.Hqb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Aa){let Ab,nc,Kc,hd;if(!({ZR:Ab,b5:nc,Wc:Kc,oj:hd}=sj.yAj(Aa)).returnValue)return null;let Rd,kc;if(1===Aa.text.length)Rd=!1,kc=Wb.AParagraphNode.PC;else if(2===Aa.text.length)if(Jb.a.jxi(Aa.text,0)&&Jb.a.Jz(Aa.text,1))Rd=!0,kc=Aa.text;else return k.ULS.sendTraceTag(8914772,355,15,"RTT symbol packet has text length 2 but is not a valid surrogate pair",
Aa.jt),null;else return k.ULS.sendTraceTag(8914773,355,15,"RTT symbol packet text is of unsupported length (length must be 1 or 2)",Aa.jt),null;const ff=Aa.pad,bd=eb.create(Aa);return new Ug(ff.djg,ff.ejg,Rd,Kc,hd,Ab,nc,Aa.wRb,kc,Aa.zT.IH,bd)}}Object(l.a)(Ug,"RttReplaceSymbolRangeOp",sj,[120,139]);class gi extends sj{constructor(Aa,Ab,nc,Kc,hd,Rd,kc,ff){super(Aa,Ab,nc,Kc,hd,Rd,kc,ff,1)}fuf(){return"OffsetStart: "+this.ZR+"OffsetEnd: "+this.b5+"TextAddedLength: "+this.Hqb.length}serialize(){const Aa=
this.lMh();return new qc(this.metadata.packetId,this.metadata.clientId,1,2,Aa,null,this.K1,this.Hqb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Aa){let Ab,nc,Kc,hd;if(!({ZR:Ab,b5:nc,Wc:Kc,oj:hd}=sj.yAj(Aa)).returnValue)return null;let Rd="";Aa.text&&(Rd=Aa.text);const kc=eb.create(Aa);return new gi(Kc,hd,Ab,nc,Aa.wRb,Rd,Aa.zT.IH,kc)}static s$l(Aa,Ab,nc){if(Aa.type)return null;const Kc=nc.CSa(Aa.c5.characterData,Aa.c5.qa);return new gi(Aa.c5.Wc,Aa.c5.oj,nc.Xoc(Kc,
Aa.cpBegin),nc.Xoc(Kc,Aa.cpEnd),Aa.Zxa.oj,Aa.J9,Aa.IH,Ab)}}Object(l.a)(gi,"RttReplaceTextRangeOp",sj,[120,139]);class rf{constructor(Aa,Ab,nc,Kc,hd,Rd,kc,ff,bd,Sf,Te,bi,Si,li,yi,lm,bh,ol,zi){this.Fl=null;this.fGe=this.Akh=!1;this.zjd=!0;this.z7g=0;this.Ydh=this.iRe=this.$dh=this.Xdh=this.Zdh=!1;this.$Wf=()=>{k.ULS.sendTraceTag(7685328,355,50,"All prerequisite ready for RttManager");this.Fl=this.d_.result;k.ULS.sendTraceTag(7685330,355,50,"Subscribing to presence updates");this.Fl.G3(this.b1)};this.b1=
(fk,eh)=>{if(3===eh.type||10===eh.type)if(10===eh.type)this.z7g="boolean"===typeof eh.LL?eh.LL?1:0:eh.LL;else if(this.BYb.value&&!this.BYb.value.oVd)k.ULS.sendTraceTag(8454939,355,15,"RTT channel did not get disconnected on lock release");else if(eh.LL){if(this.iQn(),(fk=this.Ljl(eh.LL))&&1!==fk.metadata.clientType){this.hQn();if(!(!this.Xo||this.Xo.Yca||Hc.a.FQa||Hc.a.Xca||(m.AFrameworkApplication.le("1i00j689;ba0dg262"),Hc.a.FQa||Hc.a.Xca)))return;if(2!==this.z7g)switch(this.zjd&&(this.g_b.L6i(),
this.zjd=!1),this.Akh||this.Jxm(),fk.opType){case 1:case 6:case 4:if(!({yg:fk}=this.wpk(fk)).returnValue)break;this.Lhh?this.Vfj(fk):this.DBj(fk);break;case 2:this.fqc.add(fk),this.Upi(fk),this.Lhh?this.Vfj(Nc.a.nil):this.CBj(fk)}}}else k.ULS.sendTraceTag(7685331,355,15,"RTT packet was empty")};this.Mxl=()=>{const fk=this.ei.value;if(fk){var eh=this.vD()-rf.aXn,Ck=this.Btb.mSd(Dd=>Dd.metadata.Vkg<eh);0<Ck.count&&this.xOn();var vd=new ec.a;for(const Dd of Ck)if(this.Btb.B6f(Dd),Dd.Q7)switch(Dd.Q7.opType){case 1:vd.add(Dd.Q7.paragraphId.toString());
break;case 6:vd.add(Dd.Q7.paragraphId.toString());break;case 4:vd.add(Dd.Q7.Xie.toString()),vd.add(Dd.Q7.gKc.toString())}Ck=this.fqc.mSd(Dd=>Dd.metadata.Vkg<eh);for(const Dd of Ck)this.fqc.B6f(Dd),Dd.Q7&&vd.add(Dd.Q7.paragraphId.toString());for(const Dd of vd)(vd=fk.Eb(Nc.a.Ff(Dd)))?vd.zO?(this.tyb.PWn(vd),vd.zO||this.gyc.value.A$i(vd)):k.ULS.sendTraceTag(8765829,355,15,"Expiring wet change from paragraph with no applied changes"):k.ULS.sendTraceTag(8765828,355,15,"Expiring wet change with invalid object ID")}else this.ei.Vxf&&
k.ULS.sendTraceTag(7685332,355,10,"Failed to find the IObjectSpace! Wet changes will never expire")};this.tyb=Aa;this.Btb=Ab;this.gyc=nc;this.BYb=Kc;this.MI=hd;this.d_=Rd;this.ei=kc;this.Ib=ff;this.vD=bd;this.mzb=Sf;this.yd=Te;this.NNe=Si;this.Kc=li;this.Lhh=yi;this.g_b=lm;this.Bsb=bh;this.sXe=ol;this.jAc=new L.a(J.a.jh());this.fqc=new Ld;bi.execute(rf.Tzf);this.Xo=zi}Jxm(){const Aa=new oa.a(3,2,rf.eZn,this.Mxl);this.Ib.Xb(Aa);this.Akh=!0}init(){return this.d_?this.d_.continueWith(this.$Wf):G.Task.o4(!1)}Ljl(Aa){Aa=
Wc(Aa);if(!Aa)return null;switch(Aa.jt){case 2:return gi.create(Aa);case 7:return Ug.create(Aa);case 4:return Kb.create(Aa);case 3:return De.create(Aa);default:return k.ULS.sendTraceTag(8459668,355,50,"RTT packet is of unexpected operationType {0}",Aa.jt),null}}wpk(Aa){let Ab=Nc.a.nil;if(!this.Btb.vpk(Aa))return{returnValue:!1,yg:Ab};this.Upi(Aa);if(!this.MI)return{returnValue:!1,yg:Ab};const nc=this.MI.Pib(Aa.Wc);if(nc.equals(Nc.a.nil)||!this.ei.value.Eb(nc))return Aa.activity.D6i(),{returnValue:!1,
yg:Ab};this.N6i();return{returnValue:!0,yg:nc}}Vfj(Aa){Aa.equals(Nc.a.nil)||this.jAc.add(Aa.toString());this.fGe||(Aa=new oa.a(0,1,200,()=>{this.SNo();this.fGe=!1},71),this.Ib.Xb(Aa),this.fGe=!0)}z9n(Aa){Aa=new oa.a(0,1,0,Aa,71);this.Ib.Xb(Aa)}Upi(Aa){Aa.activity=cf.create(this.yd);Aa.activity.WPn(Aa.metadata.packetVersion);Aa.activity.VPn(nf[Aa.opType])}SNo(){var Aa=this.fqc.mSd(nc=>!nc.Q7);for(const nc of Aa)this.CBj(nc);if(this.jAc.count){Aa=null;for(var Ab of this.jAc){Ab=Nc.a.Ff(Ab);Aa=this.ei.value.Eb(Ab);
break}Ab=this.Kc.Pc(3);try{Ab.Db(Aa);for(const nc of this.jAc)this.DBj(Nc.a.Ff(nc))}finally{Ab&&Ab.dispose()}this.jAc.clear()}}DBj(Aa){Aa=this.ei.value.Eb(Aa);let Ab;const nc=this.Kc.Pc(3);try{nc.Db(Aa);Ab=this.yd.Ap(ph.a.ith);const Kc=this.nth(Aa,Ab);Ab.end();Kc&&this.usk(Kc)}finally{nc&&nc.dispose(),this.g_b.R4f(1),this.zjd=!0}}CBj(Aa){var Ab=this.tyb.lCl(Aa,this.MI,this.ei.value);Ab&&(this.N6i(),this.tyb.$Lo(Aa,Ab,this.Bsb,Na.a.instance.resolve("Box4.IParagraphEditor"))&&(Ab=this.ei.value.Eb(Aa.Q7.paragraphId),
this.Gth(Ab,Aa),this.g_b.R4f(1),this.zjd=!0))}usk(Aa){this.NNe.continueWith(()=>{if(1===Aa.opType){var Ab=this.w8l(Aa);Ab&&(this.NNe.result.ZYe(Ab),this.NNe.result.Xce(!0))}})}w8l(Aa){const Ab=Aa.serialize();if(2!==Ab.jt||Ab.zT.rHa&&Ab.zT.ASa!==Ab.zT.rHa)return null;const nc=Aa.ZR.clone();0<Aa.Hqb.length&&(nc.EDh(),nc.cp+=Aa.Hqb.length);Ab.jt=0;Ab.text=null;Ab.zT.Rbe=0;Ab.zT.ZR=nc;Ab.zT.p8a=Ab.wRb;Ab.zT.rHa=null;Ab.zT.Kmc=null;Ab.zT.b5=null;Ab.wRb=null;return tc.W$e(Ab,this.MI,this.mzb,()=>this.ei.value,
this.sXe.instance)}Gth(Aa,Ab){return this.gyc.value?this.gyc.value.hok(Aa,Ab.metadata.clientId).returnValue?!0:(k.ULS.sendTraceTag(7866379,355,15,"Unable to apply a wet change lock"),!1):(k.ULS.shipAssertTag(7866378,355,!!this.gyc.value,"Unable to apply wet changes as LockManager unavailable"),!1)}mth(Aa,Ab){this.nth(Aa,Ab)}nth(Aa,Ab){if(!Aa)return null;if(!Aa.anchor)return Ab&&Ab.properties.Z(rf.eQi,"1"),null;if(!Aa.hasProperty(jg.a.Wc))return k.ULS.sendTraceTag(7619922,355,15,"Paragraph is missing the WordId property"),
null;if(!Aa.hasProperty(jg.a.oj))return k.ULS.sendTraceTag(8197722,355,15,"Paragraph is missing the TextId property"),null;if(Aa.hasProperty(jg.a.zRh)&&Aa.getValue(jg.a.zRh))return k.ULS.sendTraceTag(16815506,355,50,"RTT edit disabled in paragraph"),null;const nc=Aa.getValue(jg.a.Wc);var Kc=Aa.Ona;Ab&&(Ab.properties.Z(rf.Zen,Kc.toString()),Ab.properties.Z(rf.afn,nc.toString()));Kc=this.Btb.qrf(nc,Kc);if(!Kc)return Ab&&Ab.properties.Z(rf.RPi,"1"),null;if(!this.Gth(Aa,Kc))return Ab&&Ab.properties.Z(rf.hJh,
"1"),null;let hd=0,Rd=null;for(;Kc;){if(!this.tyb.IDk(Kc,Aa,this.Bsb,Ab)){Ab&&Ab.properties.Z(rf.$Ij,"1");break}hd++;Kc.activity.wOn(this.vD());Rd=Kc;Kc=Aa.Ona;Kc=this.Btb.qrf(nc,Kc)}0<hd&&this.j6i();Ab&&Ab.properties.add(rf.aJj,hd.toString());return Rd}Dce(Aa){if(Aa.hasProperty(jg.a.Wc)&&Aa.hasProperty(jg.a.oj)){var Ab=Aa.getValue(jg.a.Wc),nc=Aa.ja(jg.a.oj,0),Kc=this.yd.Ap(ph.a.D8i),hd=this.Bsb.xmn(Aa.id);0<hd.count&&(this.tyb.I9f(Aa,hd,this.ei.value),this.yXn(Aa,hd,nc));var Rd=this.Bsb.zKl(Ab);
if(Rd&&!Aa.id.equals(Rd.paragraphId)){const kc=this.ei.value;this.z9n(()=>{const ff=this.Bsb.anb(Rd.paragraphId),bd=kc.Eb(Rd.paragraphId);k.ULS.shipAssertTag(16820032,355,!!bd,"Could not find added graph node");bd&&(this.tyb.I9f(bd,ff,kc),this.fqc.y6f(Rd.$Ye))})}this.Btb.qrf(Ab,nc)||this.gyc.value.A$i(Aa);this.mth(Aa,Kc);Kc.end()}}yXn(Aa,Ab,nc){let Kc=!1;for(let Rd=Ab.count-1;0<=Rd;Rd--){var hd=Ab.J(Rd);switch(hd.opType){case 1:case 6:case 4:hd=Object(y.a)(120,hd.operation);break;default:continue}hd.K1===
nc&&(Kc=!0,hd.Doc&&!hd.Doc.v_o(Aa)&&k.ULS.sendTraceTag(8765831,355,15,"Validating wet change location failed. Type {0} OffsetInfo {1} NodeId {2} ValidatorNodeId {3} ValidatorNodeCpBegin {4} ValidatorNodeCpEnd {5}",hd.opType,hd.fuf(),Aa.id,hd.Doc.id,hd.Doc.cpBegin,hd.Doc.cpEnd));Kc&&this.Btb.y6f(hd)}Kc&&this.j6i()}x1c(Aa){const Ab=this.Bsb.anb(Aa.id);0<Ab.count&&(2===Ab.J(0).opType&&Ab.removeAt(0),this.tyb.I9f(Aa,Ab,this.ei.value))}nhe(Aa){var Ab=this.Bsb.k5l(Aa.id);for(const nc of Ab)if(4===nc.opType&&
(Ab=Object(y.a)(ij,nc),Aa.id.equals(Ab.Fnk)))return!0;return!1}iQn(){this.Zdh||(k.ULS.sendTraceTag(8704354,355,50,"Received a wet change"),this.Zdh=!0)}hQn(){this.Xdh||(k.ULS.sendTraceTag(8185606,355,50,"Received a wet change that we could deserialize"),this.Xdh=!0)}N6i(){this.$dh||(k.ULS.sendTraceTag(17147533,355,50,"Received a usable wet change"),this.$dh=!0)}j6i(){this.iRe||(k.ULS.sendTraceTag(8185607,355,50,"Successfully applied a wet change"),this.iRe=!0)}xOn(){this.iRe||this.Ydh||(k.ULS.sendTraceTag(8185608,
355,15,"Failed to apply any wet changes so far"),this.Ydh=!0)}static Tzf(Aa){const Ab=[ph.a.ith,ph.a.D8i];for(const nc of Ab)Aa.B5(nc,rf.aJj,Pc.a.ova),Aa.B5(nc,rf.RPi,Pc.a.ova),Aa.B5(nc,rf.eQi,Pc.a.ova),Aa.B5(nc,rf.hJh,Pc.a.ova),Aa.B5(nc,rf.$Ij,Pc.a.ova),Aa.B5(nc,fc.JZi,Pc.a.ova),Aa.B5(nc,fc.yCj,Pc.a.ova);cf.Tzf(Aa)}}rf.eZn=6E4;rf.aXn=18E4;rf.aJj="WetChangeCount";rf.RPi="NoChangesToApply";rf.eQi="NodeNotConnected";rf.hJh="CouldNotGetLock";rf.$Ij="WetChangeBlocked";rf.afn="NodeWordId";rf.Zen="NodeTextId";
Object(l.a)(rf,"RttManager",null,[121]);class Uk{constructor(Aa,Ab){this.Hej=0;this.kj=Aa;this.A7n=Ab}L6i(){this.Hej=this.kj()}R4f(Aa){const Ab=this.kj()-this.Hej;0<=Ab&&this.A7n.track(Math.round(Ab),0===Aa?"CTB":"RTP")}}Object(l.a)(Uk,"RttPerfCounter",null,[119]);var ee=c(1986);class Rk{constructor(){this.MBc=new ee.a}Zsk(Aa,Ab){this.MBc.back()&&Ab&&this.MBc.back().Efb(Aa)||this.MBc.enqueue(Aa)}P3l(){return this.MBc.isEmpty?null:this.MBc.dequeue()}}Object(l.a)(Rk,"RttSendDataStore",null,[108]);class wh extends sh{constructor(Aa,
Ab,nc,Kc){super(3,Kc);this.Wc=Aa;this.oj=Ab;this.IH=nc}get K1(){return 0}serialize(){const Aa=new te.a(4,this.Wc,this.oj,null,null,null,null,this.IH);return new qc(this.metadata.packetId,this.metadata.clientId,1,5,Aa,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Aa){const Ab=Aa.zT;return new wh(Ab.ASa,Ab.p8a,Ab.IH,eb.create(Aa))}static uam(Aa,Ab){return 4!==Aa.type?null:new wh(Aa.e6b.Wc,Aa.e6b.oj,Aa.IH,Ab)}}Object(l.a)(wh,"RttDeleteParagraphOp",
sh,[120,139]);class yg extends sh{constructor(Aa,Ab,nc,Kc,hd,Rd,kc,ff){super(5,ff);this.Wqg=Aa;this.cxj=Ab;this.W2o=nc;this.HGo=Kc;this.IH=hd;this.PJj=Rd;this.Lmc=kc}get Wc(){return this.Wqg}get oj(){return this.cxj}get K1(){return this.Wqg===this.PJj?this.Lmc:0}serialize(){const Aa=new te.a(5,this.Wqg,this.cxj,null,this.W2o,this.HGo,null,this.IH),Ab=new ic(this.PJj,this.Lmc);return new qc(this.metadata.packetId,this.metadata.clientId,1,6,Aa,null,void 0,void 0,void 0,Ab,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Aa){const Ab=
Aa.zT,nc=Aa.L_c;return new yg(Ab.ASa,Ab.p8a,Ab.rHa,Ab.Kmc,Ab.IH,nc.fZf,nc.Lmc,eb.create(Aa))}static vam(Aa,Ab){return 2!==Aa.type?null:new yg(Aa.gqa.Wc,Aa.gqa.oj,Aa.iSa.Wc,Aa.iSa.oj,Aa.IH,Aa.Q3d.Wc,Aa.Q3d.oj,Ab)}}Object(l.a)(yg,"RttMergeParagraphOp",sh,[120,139]);class So{constructor(Aa,Ab,nc,Kc,hd,Rd){this.rCc=this.fj=null;this.ofa=!1;this.jVe=this.iih=0;this.axd=this.vjh=!1;this.kQe=0;this.$Wf=()=>{k.ULS.sendTraceTag(8245954,355,50,"All prerequisites ready for RttSendManager");this.fj=this.d_.result;
this.fj.pce(this)};this.qVi=(kc,ff)=>{if(this.fj&&2===this.fj.connectionState&&(kc=ff.mF,kc.length))if(ff.V7)100>this.jVe&&(this.jVe++,k.ULS.sendTraceTag(8270467,355,50,"Blocking send. Reason: {0} OverallSends: {1} OverallBlocked: {2}",ff.dJk,this.iih,this.jVe));else{for(ff=0;ff<kc.length;ff++)if(!this.OUm(kc[ff]))return;for(ff=0;ff<kc.length;ff++){const bd=kc[ff];this.$ch.Zsk(bd,!bd.type&&!ff)}this.rCc||this.UUi(this.rCc,this.fj)}};this.d_=Aa;this.$ch=Ab;this.Obb=nc;this.eu=Kc;this.lua=hd;this.g_b=
Rd}get Om(){return this.Obb.value}init(){return this.d_?this.d_.continueWith(this.$Wf):G.Task.o4(!1)}start(){this.ofa||(this.eu.Yc?(this.eu.Yc.mF.bxk(this.qVi),this.ofa=!0):k.ULS.sendTraceTag(522740420,355,10,"No activePage, RttSendManager not started"))}stop(){this.ofa&&(this.ofa=!1,this.eu.Yc.mF.A_n(this.qVi))}OUm(Aa){return Aa&&-1!==Aa.IH?Aa.type&&3!==Aa.type&&1!==Aa.type?!1:!0:!1}Y4m(){this.axd||(this.vjh||(k.ULS.sendTraceTag(8270468,355,50,"Preparing to send RTT change"),this.vjh=!0),!this.axd&&
5>=this.kQe&&this.kQe++)}l5m(){!this.axd&&5>=this.kQe&&(k.ULS.sendTraceTag(8270469,355,50,"Sent Rtt Message"),this.axd=!0)}UUi(Aa,Ab){this.Y4m();Aa&&(Aa.Ei||Aa.Eo)&&k.ULS.sendTraceTag(8245956,355,15,"Task is faulted or cancelled with exception {0}",Aa.exception);this.g_b.L6i();(Aa=this.wam(this.$ch.P3l()))?(this.iih++,this.rCc=Ab.pN(3,Zc(Aa.serialize())),this.l5m(),this.g_b.R4f(0),this.rCc.continueWith(nc=>{this.UUi(nc,Ab)})):this.rCc=null}wam(Aa){if(!Aa)return null;if(!this.Om)return k.ULS.sendTraceTag(8245957,
355,15,"GetParagraphAnchoredOpFromGraphTransactionOperation: CoAuth manager is null"),null;const Ab=new eb(Pg.instance.wbi(),this.Om.mj,1,0,0,$d.instance.f4l());let nc=null;switch(Aa.type){case 0:nc=gi.s$l(Aa,Ab,this.lua);break;case 4:nc=wh.uam(Aa,Ab);break;case 3:nc=De.tam(Aa,Ab);break;case 2:nc=yg.vam(Aa,Ab);break;case 1:nc=Kb.xam(Aa,Ab,this.lua)}return nc}}Object(l.a)(So,"RttSendManager",null,[107]);class Sm{constructor(){this.W=null;this.M1l=()=>Ga.App.xd&&Ga.App.xd.Yp?Ga.App.xd.Yp:(k.ULS.sendTraceTag(7866377,
304,15,"Unable to get the lock manager"),null)}get name(){return"WordEditor.RealTimeTyping"}wc(Aa){const Ab=Da.a.Bp(Aa.Ta("Box4.IOutlineElementEditor")),nc=Da.a.Bp(Aa.Ta("Box4.IFeatureHelper")),Kc=Da.a.Bp(Aa.Ta("Common.IActivityAggregationInfo")),hd=Da.a.Bp(Aa.Ta("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator")),Rd=Da.a.Bp(Aa.Ta("Box4.CompositionStateManager"));this.W=Aa;const kc=new oj.a;G.Task.WAA.call(null,Ab,nc,Kc,hd,Rd).continueWith(()=>{Aa.ia("WordEditor.RealTimeTyping.IRttEditor",
()=>new fc(Aa.resolve("Box4.ICharacterPropertiesEditor"),Aa.resolve("Box4.IOutlineElementEditor"),kc,Aa.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"))).ha();Aa.register(Uk,"WordEditor.RttPerfCounter").as("WordEditor.IRttPerfCounter").ha().Sd(()=>new Uk(Bg.a.We,Ng.a.hF(17,1,new wk.a(new Vj.a(.25)))));Aa.ia("WordEditor.RealTimeTyping.RttManager",()=>new rf(Aa.resolve("WordEditor.RealTimeTyping.IRttEditor"),new nh(Xg.a.instance),new V.a(this.M1l),new V.a(()=>Ga.App.oS),Aa.resolve("WordEditor.ParagraphWordIdMapping"),
Aa.resolve("Box4.Presence.IRtcProxyProvider").XD(),new V.a(()=>Ga.App.za.jb&&Ga.App.za.jb.Yc?Ga.App.za.jb.Yc.vd:(k.ULS.sendTraceTag(522740419,304,10,"No activePage or workspace."),null)),Xb.a.instance,()=>Date.now(),Aa.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Xg.a.instance,Aa.Ta("Common.IActivityAggregationInfo"),cd.XD(),kc,m.AFrameworkApplication.K.$("WordEditorThrottleAndBatchRTTRendering"),Aa.resolve("WordEditor.IRttPerfCounter"),new hn,Aa.Ta("WordEditor.Presence.IWordPresenceCpFactory"),
Aa.resolve("Box4.CompositionStateManager"))).as("WordEditor.RealTimeTyping.IRttManager").ha();Aa.ia("WordEditor.RealTimeTyping.RttSendManager",()=>new So(Aa.resolve("Box4.Presence.IRtcProxyProvider").XD(),new Rk,new V.a(()=>Ga.App.xd),Ga.App.za.jb,Aa.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Aa.resolve("WordEditor.IRttPerfCounter"))).ha();this.Uzf()})}Uzf(){this.W.resolve("WordEditor.RealTimeTyping.RttManager").init();this.W.resolve("WordEditor.RealTimeTyping.RttSendManager").init()}init(){}dispose(){}static main(){Oa.a.instance.Gc(new Sm)}}
Object(l.a)(Sm,"WordEditorRealTimeTypingPackage",null,[1,2]);Type.registerNamespace("BPr");Type.registerNamespace("Box4.Presence");Type.registerNamespace("RealtimePresenceUI");Type.registerNamespace("WERTT");Type.registerNamespace("WordEditor.PeoplesWellControl");Type.registerNamespace("WordEditor.Presence");Type.registerNamespace("AppRealtimeChannel");Type.registerNamespace("Common.App.CoauthTelemetry");ra.main();Type.registerNamespace("Common.App.CollabControls");bb.prototype.toString=Ca.a.prototype.toString;
mb.prototype.toString=Ca.a.prototype.toString;Oa.a.instance.Gc(new he);Sm.main();Type.registerNamespace("RealtimePresenceUI");Oa.a.instance.Gc(new Ed);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");za.main()}}]);

//# sourceMappingURL=https://res-dev.cdn.officeppe.net/1js/build/20205649/wdjs/WordEditorDSVersionHistoryRemoved.collab.js.map